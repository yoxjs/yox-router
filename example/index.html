<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>touch</title>
</head>
<body>
    <div id="app"></div>
    <script src="./yox.js"></script>
    <script src="../dist/yox-router.js"></script>
    <script>
        Yox.use(YoxRouter)
        Yox.filter('stringify', function (data) {
          return JSON.stringify(data)
        })

        YoxRouter.register({
          index: {
            propTypes: {
              name: {
                type: 'string',
                required: true
              }
            },
            template: `
              <div>
                <h1>index</h1>
                <button o-href="{ name: 'register', query: { age: 10 }}">
                  register
                </button>
                {{stringify(this)}}
              </div>
            `,
          },
          register: {
            template: `
              <div>
                <h1>register</h1>
                <button o-href="/login">
                  login
                </button>
                {{stringify(this)}}
              </div>
            `,
            refreshing: function (to, from, next) {
              this.set(to.query)
              console.log('component beforeEnter', to, from)
            },
            beforeEnter: function (to, from, next) {
              console.log('component beforeEnter', to, from)
              next()
            },
            afterEnter: function (to, from, next) {
              console.log('component afterEnter', to, from)
              next()
            },
            beforeLeave: function (to, from, next) {
              console.log('component beforeLeave', to, from)
              next()
            },
            afterLeave: function (to, from, next) {
              console.log('component afterLeave', to, from)
              next()
            }
          },
          login: function (resolve) {
            setTimeout(
              function () {
                resolve({
                  template: `
                    <div>
                      <h1>login</h1>
                      <button o-href="{ name: 'login', query: { name: 'musicode'} }">
                        index
                      </button>
                      {{stringify(this)}}
                    </div>
                  `,
                  refreshing: function (to, from, next) {
                    console.log('component refreshing', to)
                  }
                })
              },
              1000
            )
          },
          profile: {
            template: `
              <div>
                <h1>profile</h1>
                {{stringify(this)}}
              </div>
            `,
          }
        })

        var router = new YoxRouter.Router({
          routes: [
            {
              path: '',
              component: 'index',
            },
            {
              path: '**',
              component: 'index',
            },
            {
              path: '/index',
              component: 'index',
              refreshing: function (to, from, next) {
                console.log('refreshing index', to)
              }
            },
            {
              path: '/register',
              name: 'register',
              component: 'register',
              beforeEnter: function (to, from, next) {
                console.log('route beforeEnter', to, from)
                next()
              },
              afterEnter: function (to, from, next) {
                console.log('route afterEnter', to, from)
                next()
              },
              beforeLeave: function (to, from, next) {
                console.log('route beforeLeave', to, from)
                next()
              },
              afterLeave: function (to, from, next) {
                console.log('route afterLeave', to, from)
                next()
              }
            },
            {
              path: '/login',
              name: 'login',
              component: 'login'
            },
            {
              path: '/profile/:id',
              name: 'profile',
              component: 'profile'
            }
          ]
        })
        router.beforeEnter = function (to, from, next) {
          console.log('router beforeEnter', to, from)
          next()
        }
        router.afterEnter = function (to, from, next) {
          console.log('router afterEnter', to, from)
          next()
        }
        router.beforeLeave = function (to, from, next) {
          console.log('router beforeLeave', to, from)
          next()
        }
        router.afterLeave = function (to, from, next) {
          console.log('router afterLeave', to, from)
          next()
        }

        router.start('#app')

    </script>
</body>
</html>
