<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>touch</title>
</head>
<body>
    <div id="app"></div>
    <script src="./yox.js"></script>
    <script src="../dist/yox-router.js"></script>
    <script>
        Yox.use(YoxRouter)

        Yox.filter('stringify', function (data) {
          return JSON.stringify(data)
        })

        YoxRouter.register({
          index: {
            propTypes: {
              name: {
                type: 'string',
                required: true
              }
            },
            template: `
              <div>
                <h1>index</h1>
                {{name}}
                <router-view />
              </div>
            `,
          },
          user: {
            propTypes: {
              userId: {
                type: ['string', 'number']
              }
            },
            template: `
              <div>
                <h2>user</h2>
                <span>{{userId}}</span>
                <router-view />
              </div>
            `,
          },
          userIndex: {
            propTypes: {
              userId: {
                type: ['string', 'number']
              }
            },
            template: `
              <div>
                <h3>user index</h3>
                <span>{{userId}}</span>
                <router-view />
              </div>
            `,
          },
          userDetail: {
            propTypes: {
              userId: {
                type: ['string', 'number']
              }
            },
            template: `
              <div>
                <h4>user detail</h4>
                <span>{{userId}}</span>
              </div>
            `,
          },
          userProfile: {
            propTypes: {
              userId: {
                type: ['string', 'number']
              }
            },
            template: `
              <div>
                <h4>user profile</h4>
                <span>{{userId}}</span>
              </div>
            `,
          },
          register: {
            template: `
              <div>
                <h1>register</h1>
                <button o-href="/login">
                  login
                </button>
                {{stringify(this)}}
              </div>
            `,
            refreshing: function (to, from, next) {
              this.set(to.query)
              console.log('component beforeEnter', to, from)
            },
            beforeEnter: function (to, from, next) {
              console.log('component beforeEnter', to, from)
              next()
            },
            afterEnter: function (to, from, next) {
              console.log('component afterEnter', to, from)
              next()
            },
            beforeLeave: function (to, from, next) {
              console.log('component beforeLeave', to, from)
              next()
            },
            afterLeave: function (to, from, next) {
              console.log('component afterLeave', to, from)
              next()
            }
          },
          login: function (resolve) {
            setTimeout(
              function () {
                resolve({
                  template: `
                    <div>
                      <h1>login</h1>
                      <button o-href="{ name: 'login', query: { name: 'musicode'} }">
                        index
                      </button>
                      {{stringify(this)}}
                    </div>
                  `,
                  refreshing: function (to, from, next) {
                    console.log('component refreshing', to)
                  }
                })
              },
              1000
            )
          },
          profile: {
            template: `
              <div>
                <h1>profile</h1>
                {{stringify(this)}}
              </div>
            `,
          }
        })

        var router = new YoxRouter.Router({
          el: Yox.dom.find('#app'),
          routes: [
            {
              path: '',
              component: 'index',
              children: [
                {
                  path: '',
                  component: 'index'
                },
                {
                  path: 'user',
                  component: 'user',
                  children: [
                    {
                      path: '',
                      component: 'userIndex'
                    },
                    {
                      path: 'detail/:userId',
                      component: 'userDetail'
                    },
                    {
                      path: 'profile/:userId',
                      component: 'userProfile'
                    },
                  ]
                },
                {
                  path: 'setting',
                  component: 'index',
                },
                {
                  path: 'project',
                  component: 'index',
                },
              ]
            },
            {
              path: '**',
              component: 'index',
            },
            {
              path: 'home',
              component: 'index',
              children: [
                {
                  path: '',
                  component: 'index'
                },
                {
                  path: 'user',
                  component: 'index',
                },
                {
                  path: 'setting',
                  component: 'index',
                },
                {
                  path: 'project',
                  component: 'index',
                },
              ]
            },
            {
              path: '/index',
              component: 'index',
              refreshing: function (to, from, next) {
                console.log('refreshing index', to)
              },
              children: [
                {
                  path: 'register',
                  name: 'register',
                  component: 'register',
                  beforeEnter: function (to, from, next) {
                    console.log('route beforeEnter', to, from)
                    next()
                  },
                  afterEnter: function (to, from, next) {
                    console.log('route afterEnter', to, from)
                    next()
                  },
                  beforeLeave: function (to, from, next) {
                    console.log('route beforeLeave', to, from)
                    next()
                  },
                  afterLeave: function (to, from, next) {
                    console.log('route afterLeave', to, from)
                    next()
                  }
                },
                {
                  path: 'login',
                  name: 'login',
                  component: 'login'
                },
                {
                  path: 'profile/:id',
                  name: 'profile',
                  component: 'profile'
                }
              ]
            },

          ]
        })
        router.beforeEnter = function (to, from, next) {
          console.log('router beforeEnter', to, from)
          next()
        }
        router.afterEnter = function (to, from, next) {
          console.log('router afterEnter', to, from)
          next()
        }
        router.beforeLeave = function (to, from, next) {
          console.log('router beforeLeave', to, from)
          next()
        }
        router.afterLeave = function (to, from, next) {
          console.log('router afterLeave', to, from)
          next()
        }

        router.start()

    </script>
</body>
</html>
