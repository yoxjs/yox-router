const t=window,e=t.location,o=t.history;class n{setLocation(t,e){return this.to=t,this.from=e,this}clear(){return this.list=[],this}add(t,e){const{list:o}=this;return t&&o.push({fn:t,ctx:e}),this}next(t,e,o){const n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()}}function r(t,e){let o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o="true"===e||"false"!==e&&("null"===e?null:decodeURIComponent(e))),o}function i(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():null===e?"null":void 0}const s="pushState"in o;function c(t,n){try{o.replaceState({},"",t),n()}catch(o){e.replace(t)}}var a=Object.freeze({__proto__:null,isSupported:s,start:function(e,o){e.on(t,"popstate",o),o()},stop:function(e,o){e.off(t,"popstate",o)},push:function(t,e){o.pushState({},"",t.url),e()},replace:function(t,e){c(t.url,e)},go:function(t){o.go(t)},current:function(){return e.pathname+e.search},replaceState:c});var u=Object.freeze({__proto__:null,start:function(e,o){e.on(t,"hashchange",o),o()},stop:function(e,o){e.off(t,"hashchange",o)},push:function(t,o){e.hash="#!"+t.url},replace:function(t,o){const n=e.protocol+"//"+e.host+e.pathname+"#!"+t.url;s?c(n,o):e.replace(n)},go:function(t){o.go(t)},current:function(){const t=e.href,o=t.indexOf("#!");return o>0?t.substr(o+"#!".length):"/"}});let p,h,f=0;function l(t,e){return p.string.startsWith(t,"/")||(e?p.string.endsWith(e,"/")||(e+="/"):e="/",t=e+t),"/"!==t&&p.string.endsWith(t,"/")&&(t=p.string.slice(t,0,-"/".length)),t}function d(t,e,o){if(/\/\:\w+/.test(t)){const o=[];p.array.each(t.split("/"),(function(t){o.push(p.string.startsWith(t,":")&&e?e[t.substr(":".length)]:t)})),t=o.join("/")}if(o){const e=function(t,e){const o=[];for(let n in e){const r=e[n];if(t.is.array(r))t.array.each(r,(function(e){const r=i(t,e);t.is.string(r)&&o.push(n+"[]="+r)}));else{const e=i(t,r);t.is.string(e)&&o.push(n+"="+e)}}return o.join("&")}(p,o);e&&(t+="?"+e)}return t}function m(t,e,o){const n={},r=o.propTypes;if(r){let o=e.query,i=t.params,s=e.params;if(i&&s){o=o?p.object.copy(o):{};for(let t=0,e=i.length;t<e;t++)o[i[t]]=s[i[t]]}if(o)for(let t in r){let e=o[t];void 0!==e&&(n[t]=e)}}return n}function g(t,e,o,n){const r=t.$route;if(r&&(r.context=n?t:void 0,function(t){const e=t.child;return!e||!e.context}(r))){const i=t.$router;if(e&&o&&i.hook(r,e,o,!1),n){const{pending:t}=i;t&&(t.onComplete(),i.pending=void 0)}}}class v{constructor(t){const e=this,o=t.el,r=t.route404||x;e.options=t,e.el=p.is.string(o)?p.dom.find(o):o,e.mode="history"===t.mode&&s?a:u,e.handler=function(){e.parseLocation(e.mode.current(),(function(t){t?e.setRoute(t):e.push(e.route404)}))},e.routes=[],e.name2Path={},e.path2Route={},e.hooks=new n,p.array.each(t.routes,(function(t){e.add(t)})),e.route404=e.add(r)[0]}add(t,e){const o=this,n=[],r=[],i=[],s=function(t){let{name:e,component:c,children:a,load:u}=t,h=p.array.last(r),f=p.array.last(i),d=l(t.path,h),m={path:d,route:t},g=[];p.array.each(d.split("/"),(function(t){p.string.startsWith(t,":")&&g.push(t.substr(":".length))})),g.length&&(m.params=g),e&&(m.name=e),u?m.load=u:m.component=c||b,f&&(m.parent=f),a?(r.push(d),i.push(m),p.array.each(a,s),i.pop(),r.pop()):(n.push(m),o.routes.push(m),e&&(o.name2Path[e]=d),o.path2Route[d]=m)};return e&&(r.push(e.path),i.push(e)),s(t),n}remove(t){const e=this;p.array.remove(e.routes,t),t.name&&delete e.name2Path[t.name],delete e.path2Route[t.path]}push(t){const e=this,{mode:o}=e;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.push(t,e.handler)}))}replace(t){const e=this,{mode:o}=e;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.replace(t,e.handler)}))}go(t){this.mode.go(t)}start(){this.mode.start(p.dom,this.handler)}stop(){this.mode.stop(p.dom,this.handler)}hook(t,e,o,n,r){const i=this,{location:s,hooks:c,pending:a}=i,{context:u}=t,p=function(){u&&u.fire(e+".hook",{from:c.from,to:c.to}),r&&r()},h=function(t){void 0===t?c.next(n,h,p):(a&&(a.onAbort(),i.pending=void 0),!1===t?s&&i.push(s):i.push(t))};c.clear().add(t.component[e],u).add(t.route[o],t.route).add(i.options[o],i),h()}toUrl(t){if(p.is.string(t))return l(t);let e,o=this,n=o.location,r=t,i=r.params;return r.name?e=o.name2Path[r.name]:r.path?e=l(r.path):n&&(e=n.path,i||(i=n.params)),d(e,i,r.query)}setUrl(t,e){this.parseLocation(t,(function(t){t&&e(t)}))}parseLocation(t,e){let o,n,i=t.indexOf("?");i>=0?(o=t.slice(0,i),n=t.slice(i+1)):o=t;const s=this,c=o.split("/"),a=c.length,u=function(t,e){let n,i=0;t:for(;n=t[i++];){const t=n.path;if(n.params){const o=t.split("/");if(a===o.length){const t={};for(let e=0;e<a;e++)if(p.string.startsWith(o[e],":"))t[o[e].substr(":".length)]=r(p,c[e]);else if(o[e]!==c[e])continue t;return void e(n,t)}}else{if(n.load&&p.string.startsWith(o,t)){const t=function(t){s.remove(n),u(s.add(t.default||t,n.parent),e)},o=n.load(t);return void(o&&o.then(t))}if(t===o)return void e(n)}}e()};u(s.routes,(function(o,i){if(o){const s={url:t,path:o.path};if(i&&(s.params=i),n){const t=function(t,e){let o;return t.array.each(e.split("&"),(function(e){let n=e.split("="),i=t.string.trim(n[0]),s=n[1];i&&(o||(o={}),s=r(t,s),t.string.endsWith(i,"[]")?(i=t.string.slice(i,0,-"[]".length),t.array.push(o[i]||(o[i]=[]),s)):o[i]=s)})),o}(p,n);t&&(s.query=t)}e(s)}else e()}))}diffRoute(t,e,o,n,r,i){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(p.object.copy(t.parent),e?e.parent:void 0,o,n,t,e||i);else{if(n===t){let t;if(e)for(;e;)t=e.context,e=e.parent;else i&&(t=i.context);t&&(n.context=t)}o(t,n)}}patchRoute(t,e){const o=this,n=o.location;for(;t;){let{parent:r,context:i,component:s}=t;if(t===e)if(r){if(i=r.context,i.forceUpdate(m(r,n,r.component)),i=i.$routeView,i){const t={},e="RouteComponent"+ ++f;t.RouteComponent=e,i.component(e,s),i.forceUpdate(t)}}else{i&&i.destroy();const e={$router:o,$route:t},r=p.object.extend({el:o.el,props:m(t,n,s),extensions:e},s);r.events=r.events?p.object.extend(r.events,h):h,t.context=new p(r)}else if(i&&(i.$vnode?(i.$route=t,i.forceUpdate(m(t,n,s))):t.context=void 0,t.child)){t=t.child;continue}break}}setRoute(t){let e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(p.is.func(n)&&(n=n(t)),n))return void e.push(n);const r=p.object.copy(o),i=e.route,s=e.location,c=function(){e.diffRoute(r,i,(function(o,n){e.hook(r,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",!0,(function(){e.route=r,e.location=t,e.patchRoute(o,n)}))}))};e.hooks.setLocation(t,s),i&&s&&t.path!==s.path?e.hook(i,"beforeRouteLeave","beforeLeave",!0,c):c()}}const x={path:"/404",component:{template:function(t,e,o,n,r,i,s,c,a,u,p,h,f,l,d,m,g,v,x,b,y,R,k,$){return g("div",void 0,(function(){r('This is a default 404 page, please set "route404" for your own 404 page.')}),!0)}}},b={template:function(t,e,o,n,r,i,s,c,a,u,p,h,f,l,d,m,g,v,x,b,y,R,k,$){return v("router-view")}},y={bind(t,e,o){const n=(o.context.$root||o.context).$router,r=o.data[e.key]=function(t){let{value:o,getter:r}=e,i=o;o&&r&&p.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):p.dom.on(t,"click",r)},unbind(t,e,o){const n=o.data[e.key];o.isComponent?t.off("click",n):p.dom.off(t,"click",n)}},R={template:function(t,e,o,n,r,i,s,c,a,u,p,h,f,l,d,m,g,v,x,b,y,R,k,$){return v(t("RouteComponent",!0))},beforeCreate(t){const e=t.context,o=e.$route.child;if(o){e.$routeView=this;const n=t.props={},r=t.components={},i="RouteComponent"+ ++f;n.RouteComponent=i,r[i]=o.component}},beforeDestroy(){this.$context.$routeView=void 0}},k="1.0.0-alpha.55";function $(t){p=t,p.directive({push:y,replace:y,go:y}),p.component("router-view",R),h={},h["beforeCreate.hook"]=function(t,e){if(e){let t=e,{context:o}=t;if(o&&o.$options.beforeCreate===R.beforeCreate){o=o.$context;const e=o.$router,n=o.$route.child;n&&(t.extensions={$router:e,$route:n},e.location&&(t.props=m(n,e.location,t)))}}},h["afterMount.hook"]=function(t){g(t.target,"afterRouteEnter","afterEnter",!0)},h["afterUpdate.hook"]=function(t){g(t.target,"afterRouteUpdate","afterUpdate",!0)},h["afterDestroy.hook"]=function(t){g(t.target,"afterRouteLeave","afterLeave")}}export{v as Router,$ as install,k as version};
//# sourceMappingURL=yox-router.esm.min.js.map
