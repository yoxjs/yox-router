const t=window,e=t.location,o=t.history,n=":",r="/",s="?",i="&",c="=",a="[]",u="beforeEnter",h="afterEnter",f="beforeUpdate",p="afterUpdate",l="beforeLeave",d="afterLeave",m="beforeRouteEnter",g="afterRouteEnter",y="beforeRouteUpdate",b="afterRouteUpdate",x="beforeRouteLeave",v="afterRouteLeave",R=!0,k=!1,U=null,j=void 0,C="true",L="false",$="null",w=function(){};Object.freeze({}),Object.freeze([]);class W{setLocation(t,e){return this.to=t,this.from=e,this}clear(){return this.list=[],this}add(t,e){const{list:o}=this;return t&&o.push({fn:t,ctx:e}),this}next(t,e,o){const n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()}}function H(t,e){let o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===C?R:e===L?k:e===$?U:decodeURIComponent(e)),o}function O(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===U?$:void 0}const P="#!",q="hashchange";var z=Object.freeze({start:function(e,o){e.on(t,q,o),o()},stop:function(e,o){e.off(t,q,o)},push:function(t,o){e.hash=P+t.url},go:function(t){o.go(t)},current:function(){const t=e.href,o=t.indexOf(P);return o>0?t.substr(o+P.length):r}});const E="popstate",S="pushState"in o;var A=Object.freeze({isSupported:S,start:function(e,o){e.on(t,E,o),o()},stop:function(e,o){e.off(t,E,o)},push:function(t,e){o.pushState({},"",t.url),e()},go:function(t){o.go(t)},current:function(){return e.pathname+e.search}});let D,I,T=0;const M="$router",V="$route",B="$routeView",F="RouteComponent";function G(t,e){return D.string.startsWith(t,r)||(e?D.string.endsWith(e,r)||(e+=r):e=r,t=e+t),t!==r&&D.string.endsWith(t,r)&&(t=D.string.slice(t,0,-r.length)),t}function J(t,e,o){if(/\/\:\w+/.test(t)){const o=[];D.array.each(t.split(r),function(t){o.push(D.string.startsWith(t,n)&&e?e[t.substr(n.length)]:t)}),t=o.join(r)}if(o){const e=function(t,e){const o=[];for(let n in e){const r=e[n];if(t.is.array(r))t.array.each(r,function(e){const r=O(t,e);t.is.string(r)&&o.push(n+a+c+r)});else{const e=O(t,r);t.is.string(e)&&o.push(n+c+e)}}return o.join(i)}(D,o);e&&(t+=s+e)}return t}function K(t,e){if(D.is.string(t))return G(t);let o,n=t,r=n.name;return J(o=r?e[r]:G(n.path),n.params,n.query)}function N(t,e,o){const n={},r=o.propTypes;if(r){let o=e.query,s=t.params,i=e.params;if(s&&i){o=o?D.object.copy(o):{};for(let t=0,e=s.length;t<e;t++)o[s[t]]=i[s[t]]}if(o)for(let t in r){let e=o[t];e!==j&&(n[t]=e)}}return n}function Q(t,e,o,n){const r=t[V];if(r&&(r.context=n?t:j,function(t){const e=t.child;return!e||!e.context}(r))){const s=t[M];if(e&&o&&s.hook(r,e,o),n){const{pending:t}=s;t&&(t.onComplete(),s.pending=j)}}}class X{constructor(t){const e=this,o=t.el,n=t.route404||Y;e.options=t,e.el=D.is.string(o)?D.dom.find(o):o,e.mode="history"===t.mode&&S?A:z,e.handler=function(){const t=e.mode.current(),{pending:o}=e;if(o){const{location:n}=o;if(n.url===t)return e.setHistory(n,o.cursor),void e.setRoute(n);e.pending=j}e.parseLocation(t,function(t){t?(e.setHistory(t),e.setRoute(t)):e.push(e.route404)})},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new W,D.array.each(t.routes,function(t){e.add(t)}),e.route404=e.add(n)[0]}add(t){const e=this,o=[],s=[],i=[],c=function(t){let{name:a,component:u,children:h,load:f}=t,p=D.array.last(s),l=D.array.last(i),d=G(t.path,p),m={path:d,route:t},g=[];D.array.each(d.split(r),function(t){D.string.startsWith(t,n)&&g.push(t.substr(n.length))}),g.length&&(m.params=g),a&&(m.name=a),u?m.component=u:f&&(m.load=f),l&&(m.parent=l),h?(s.push(d),i.push(m),D.array.each(h,c),i.pop(),s.pop()):(o.push(m),e.routes.push(m),a&&(e.name2Path[a]=d),e.path2Route[d]=m)};return c(t),o}remove(t){const e=this;D.array.remove(e.routes,t),t.name&&delete e.name2Path[t.name],delete e.path2Route[t.path]}push(t){const e=this,{mode:o}=e;e.setUrl(K(t,e.name2Path),w,w,function(t,n){e.pending=n,o.current()!==t.url?o.push(t,e.handler):e.setRoute(t)})}replace(t){const e=this;e.setUrl(K(t,e.name2Path),function(){e.replaceHistory(e.location)},w,function(t,o){e.pending=o,e.setRoute(t)})}go(t){const e=this,{mode:o}=e,n=e.cursor+t,r=e.history[n];r&&e.setUrl(J(r.path,r.params,r.query),w,w,function(r,s){s.cursor=n,e.pending=s,o.current()!==r.url?o.go(t):(e.setHistory(r,n),e.setRoute(r))})}start(){this.mode.start(D.dom,this.handler)}stop(){this.mode.stop(D.dom,this.handler)}hook(t,e,o,n,r){const s=this,{location:i,hooks:c,pending:a}=s;c.clear().add(t.component[e],t.context).add(t.route[o],t.route).add(s.options[o],s);const u=function(t){t===j?c.next(u,n,r):(a&&(a.onAbort(),s.pending=j),t===k?i&&s.push(i):s.push(t))};u()}setHistory(t,e){const{history:o,cursor:n}=this;D.is.number(e)||o[e=n+1]&&(o.length=e),o[e]=t,this.cursor=e}replaceHistory(t){const{history:e,cursor:o}=this;e[o]&&(e[o]=t)}setUrl(t,e,o,n){this.parseLocation(t,function(t){t&&n(t,{location:t,onComplete:e,onAbort:o})})}parseLocation(t,e){let o,u,h=t.indexOf(s);h>=0?(o=t.slice(0,h),u=t.slice(h+1)):o=t;const f=this,p=o.split(r),l=p.length,d=function(t,e){let s,i=0;t:for(;s=t[i++];){const t=s.path;if(s.params){const o=t.split(r);if(l===o.length){const t={};for(let e=0;e<l;e++)if(D.string.startsWith(o[e],n))t[o[e].substr(n.length)]=H(D,p[e]);else if(o[e]!==p[e])continue t;return void e(s,t)}}else{if(s.load&&D.string.startsWith(o,t)){const t=function(t){f.remove(s),d(f.add(t.default||t),e)},o=s.load(t);return void(o&&o.then(t))}if(t===o)return void e(s)}}e()};d(f.routes,function(o,n){if(o){const r={url:t,path:o.path};if(n&&(r.params=n),u){const t=function(t,e){let o;return t.array.each(e.split(i),function(e){let n=e.split(c),r=t.string.trim(n[0]),s=n[1];r&&(o||(o={}),s=H(t,s),t.string.endsWith(r,a)?(r=t.string.slice(r,0,-a.length),t.array.push(o[r]||(o[r]=[]),s)):o[r]=s)}),o}(D,u);t&&(r.query=t)}e(r)}else e()})}diffRoute(t,e,o,n,r,s){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(D.object.copy(t.parent),e?e.parent:j,o,n,t,e||s);else{if(n===t){let t;if(e)for(;e;)t=e.context,e=e.parent;else s&&(t=s.context);t&&(n.context=t)}o(t,n)}}patchRoute(t,e){const o=this,n=o.location;for(;t;){let{parent:r,context:s,component:i}=t;if(t===e)if(r){if((s=r.context).forceUpdate(N(r,n,r.component)),s=s[B]){const t={},e=F+ ++T;t[F]=e,s.component(e,i),s.forceUpdate(t)}}else{s&&s.destroy();const e={};e[M]=o,e[V]=t;const r=D.object.extend({el:o.el,props:N(t,n,i),extensions:e},i);r.events=r.events?D.object.extend(r.events,I):I,t.context=new D(r)}else if(s&&(s.$vnode?(s[V]=t,s.forceUpdate(N(t,n,i))):t.context=j,t.child)){t=t.child;continue}break}}setRoute(t){let e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(D.is.func(n)&&(n=n(t)),n))return void e.push(n);const r=D.object.copy(o),s=e.route,i=e.location,c=function(){e.diffRoute(r,s,function(o,n){e.hook(r,n?m:y,n?u:f,R,function(){e.route=r,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,i),s&&i&&t.path!==i.path?e.hook(s,x,l,R,c):c()}}const Y={path:"/404",component:{template:'<div>This is a default 404 page, please set "route404" for your own 404 page.</div>'}},Z={bind(t,e,o){const n=(o.context.$root||o.context)[M],r=o.data[e.key]=function(t){let{value:o,getter:r}=e,s=o;o&&r&&D.string.has(o,"{")&&(s=r()),n[e.name](s)};o.isComponent?t.on("click",r):D.dom.on(t,"click",r)},unbind(t,e,o){const n=o.data[e.key];o.isComponent?t.off("click",n):D.dom.off(t,"click",n)}},_={template:"<$"+F+"/>",beforeCreate(t){const e=t.context,o=e[V].child;if(o){e[B]=this;const n=t.props={},r=t.components={},s=F+ ++T;n[F]=s,r[s]=o.component}},beforeDestroy(){this.$context[B]=j}},tt="1.0.0-alpha.34";function et(t){D=t,t.directive({push:Z,replace:Z,go:Z}),t.component("router-view",_),I={"beforeCreate.hook":function(t,e){if(e){let t=e,{context:o}=t;if(o&&o.$options.beforeCreate===_.beforeCreate){const e=(o=o.$context)[M],n=o[V].child;if(n){const o=t.extensions={};o[M]=e,o[V]=n,e.location&&(t.props=N(n,e.location,t))}}}},"afterMount.hook":function(t){Q(t.target,g,h,R)},"afterUpdate.hook":function(t){Q(t.target,b,p,R)},"afterDestroy.hook":function(t){Q(t.target,v,d)}}}export{X as Router,et as install,tt as version};
//# sourceMappingURL=yox-router.esm.min.js.map
