const t=window,e=t.location,o=t.history,n=void 0,r=null,s=!0,i=!1,c="null",a="true",u="false",p=":",f="/",h="?",l="&",d="=",m="[]",g="history",x="beforeEnter",b="afterEnter",v="beforeUpdate",y="afterUpdate",R="beforeLeave",$="afterLeave",U="beforeRouteEnter",k="afterRouteEnter",w="beforeRouteUpdate",C="afterRouteUpdate",j="beforeRouteLeave",L="afterRouteLeave";class W{setLocation(t,e){return this.to=t,this.from=e,this}clear(){return this.list=[],this}add(t,e){const{list:o}=this;return t&&o.push({fn:t,ctx:e}),this}next(t,e,o){const n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()}}function S(t,e){let o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===a?s:e===u?i:e===c?r:decodeURIComponent(e)),o}function E(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===r?c:void 0}const O="popstate",P="pushState"in o;function q(t,n){try{o.replaceState({},"",t),n()}catch(o){e.replace(t)}}var V=Object.freeze({isSupported:P,start:function(e,o){e.on(t,O,o),o()},stop:function(e,o){e.off(t,O,o)},push:function(t,e){o.pushState({},"",t.url),e()},replace:function(t,e){q(t.url,e)},go:function(t){o.go(t)},current:function(){return e.pathname+e.search},replaceState:q});const z="#!",D="hashchange";var I=Object.freeze({start:function(e,o){e.on(t,D,o),o()},stop:function(e,o){e.off(t,D,o)},push:function(t,o){e.hash=z+t.url},replace:function(t,o){const n=e.protocol+"//"+e.host+e.pathname+z+t.url;P?q(n,o):e.replace(n)},go:function(t){o.go(t)},current:function(){const t=e.href,o=t.indexOf(z);return o>0?t.substr(o+z.length):f}});let T,A,M=0;const B="RouteComponent",F=".hook";function G(t,e){return T.string.startsWith(t,f)||(e?T.string.endsWith(e,f)||(e+=f):e=f,t=e+t),t!==f&&T.string.endsWith(t,f)&&(t=T.string.slice(t,0,-f.length)),t}function H(t,e,o){if(/\/\:\w+/.test(t)){const o=[];T.array.each(t.split(f),function(t){o.push(T.string.startsWith(t,p)&&e?e[t.substr(p.length)]:t)}),t=o.join(f)}if(o){const e=function(t,e){const o=[];for(let n in e){const r=e[n];if(t.is.array(r))t.array.each(r,function(e){const r=E(t,e);t.is.string(r)&&o.push(n+m+d+r)});else{const e=E(t,r);t.is.string(e)&&o.push(n+d+e)}}return o.join(l)}(T,o);e&&(t+=h+e)}return t}function J(t,e,o){const r={},s=o.propTypes;if(s){let o=e.query,i=t.params,c=e.params;if(i&&c){o=o?T.object.copy(o):{};for(let t=0,e=i.length;t<e;t++)o[i[t]]=c[i[t]]}if(o)for(let t in s){let e=o[t];e!==n&&(r[t]=e)}}return r}function K(t,e,o,r){const s=t.$route;if(s&&(s.context=r?t:n,function(t){const e=t.child;return!e||!e.context}(s))){const c=t.$router;if(e&&o&&c.hook(s,e,o,i),r){const{pending:t}=c;t&&(t.onComplete(),c.pending=n)}}}class N{constructor(t){const e=this,o=t.el,n=t.route404||Q;e.options=t,e.el=T.is.string(o)?T.dom.find(o):o,e.mode=t.mode===g&&P?V:I,e.handler=function(){e.parseLocation(e.mode.current(),function(t){t?e.setRoute(t):e.push(e.route404)})},e.routes=[],e.name2Path={},e.path2Route={},e.hooks=new W,T.array.each(t.routes,function(t){e.add(t)}),e.route404=e.add(n)[0]}add(t,e){const o=this,n=[],r=[],s=[],i=function(t){let{name:e,component:c,children:a,load:u}=t,h=T.array.last(r),l=T.array.last(s),d=G(t.path,h),m={path:d,route:t},g=[];T.array.each(d.split(f),function(t){T.string.startsWith(t,p)&&g.push(t.substr(p.length))}),g.length&&(m.params=g),e&&(m.name=e),u?m.load=u:m.component=c||X,l&&(m.parent=l),a?(r.push(d),s.push(m),T.array.each(a,i),s.pop(),r.pop()):(n.push(m),o.routes.push(m),e&&(o.name2Path[e]=d),o.path2Route[d]=m)};return e&&(r.push(e.path),s.push(e)),i(t),n}remove(t){const e=this;T.array.remove(e.routes,t),t.name&&delete e.name2Path[t.name],delete e.path2Route[t.path]}push(t){const e=this,{mode:o}=e;e.setUrl(e.toUrl(t),function(t){o.current()!==t.url&&o.push(t,e.handler)})}replace(t){const e=this,{mode:o}=e;e.setUrl(e.toUrl(t),function(t){o.current()!==t.url&&o.replace(t,e.handler)})}go(t){this.mode.go(t)}start(){this.mode.start(T.dom,this.handler)}stop(){this.mode.stop(T.dom,this.handler)}hook(t,e,o,r,s){const c=this,{location:a,hooks:u,pending:p}=c,{context:f}=t,h=function(){f&&f.fire(e+F,{from:u.from,to:u.to}),s&&s()},l=function(t){t===n?u.next(r,l,h):(p&&(p.onAbort(),c.pending=n),t===i?a&&c.push(a):c.push(t))};u.clear().add(t.component[e],f).add(t.route[o],t.route).add(c.options[o],c),l()}toUrl(t){if(T.is.string(t))return G(t);let e,o=this,n=o.location,r=t,s=r.params;return r.name?e=o.name2Path[r.name]:r.path?e=G(r.path):n&&(e=n.path,s||(s=n.params)),H(e,s,r.query)}setUrl(t,e){this.parseLocation(t,function(t){t&&e(t)})}parseLocation(t,e){let o,n,r=t.indexOf(h);r>=0?(o=t.slice(0,r),n=t.slice(r+1)):o=t;const s=this,i=o.split(f),c=i.length,a=function(t,e){let n,r=0;t:for(;n=t[r++];){const t=n.path;if(n.params){const o=t.split(f);if(c===o.length){const t={};for(let e=0;e<c;e++)if(T.string.startsWith(o[e],p))t[o[e].substr(p.length)]=S(T,i[e]);else if(o[e]!==i[e])continue t;return void e(n,t)}}else{if(n.load&&T.string.startsWith(o,t)){const t=function(t){s.remove(n),a(s.add(t.default||t,n.parent),e)},o=n.load(t);return void(o&&o.then(t))}if(t===o)return void e(n)}}e()};a(s.routes,function(o,r){if(o){const s={url:t,path:o.path};if(r&&(s.params=r),n){const t=function(t,e){let o;return t.array.each(e.split(l),function(e){let n=e.split(d),r=t.string.trim(n[0]),s=n[1];r&&(o||(o={}),s=S(t,s),t.string.endsWith(r,m)?(r=t.string.slice(r,0,-m.length),t.array.push(o[r]||(o[r]=[]),s)):o[r]=s)}),o}(T,n);t&&(s.query=t)}e(s)}else e()})}diffRoute(t,e,o,r,s,i){if(s&&(t.child=s,s.parent=t),e?e.component!==t.component?r=t:t.context=e.context:r=t,t.parent)this.diffRoute(T.object.copy(t.parent),e?e.parent:n,o,r,t,e||i);else{if(r===t){let t;if(e)for(;e;)t=e.context,e=e.parent;else i&&(t=i.context);t&&(r.context=t)}o(t,r)}}patchRoute(t,e){const o=this,r=o.location;for(;t;){let{parent:s,context:i,component:c}=t;if(t===e)if(s){if((i=s.context).forceUpdate(J(s,r,s.component)),i=i.$routeView){const t={},e=B+ ++M;t[B]=e,i.component(e,c),i.forceUpdate(t)}}else{i&&i.destroy();const e={$router:o,$route:t},n=T.object.extend({el:o.el,props:J(t,r,c),extensions:e},c);n.events=n.events?T.object.extend(n.events,A):A,t.context=new T(n)}else if(i&&(i.$vnode?(i.$route=t,i.forceUpdate(J(t,r,c))):t.context=n,t.child)){t=t.child;continue}break}}setRoute(t){let e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(T.is.func(n)&&(n=n(t)),n))return void e.push(n);const r=T.object.copy(o),i=e.route,c=e.location,a=function(){e.diffRoute(r,i,function(o,n){e.hook(r,n?U:w,n?x:v,s,function(){e.route=r,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,c),i&&c&&t.path!==c.path?e.hook(i,j,R,s,a):a()}}const Q={path:"/404",component:{template:function(t,e,o,n,r,s,i,c,a,u,p,f,h,l,d,m,g,x,b,v,y,R,$,U){return g("div",void 0,function(){r('This is a default 404 page, please set "route404" for your own 404 page.')},!0)}}},X={template:function(t,e,o,n,r,s,i,c,a,u,p,f,h,l,d,m,g,x,b,v,y,R,$,U){return x("router-view")}},Y={bind(t,e,o){const n=(o.context.$root||o.context).$router,r=o.data[e.key]=function(t){let{value:o,getter:r}=e,s=o;o&&r&&T.string.has(o,"{")&&(s=r()),n[e.name](s)};o.isComponent?t.on("click",r):T.dom.on(t,"click",r)},unbind(t,e,o){const n=o.data[e.key];o.isComponent?t.off("click",n):T.dom.off(t,"click",n)}},Z={template:function(t,e,o,n,r,s,i,c,a,u,p,f,h,l,d,m,g,x,b,v,y,R,$,U){var k=void 0;return x(k,k,k,k,k,"RouteComponent")},beforeCreate(t){const e=t.context,o=e.$route.child;if(o){e.$routeView=this;const n=t.props={},r=t.components={},s=B+ ++M;n[B]=s,r[s]=o.component}},beforeDestroy(){this.$context.$routeView=n}},_="1.0.0-alpha.53";function tt(t){(T=t).directive({push:Y,replace:Y,go:Y}),T.component("router-view",Z),(A={})["beforeCreate"+F]=function(t,e){if(e){let t=e,{context:o}=t;if(o&&o.$options.beforeCreate===Z.beforeCreate){const e=(o=o.$context).$router,n=o.$route.child;n&&(t.extensions={$router:e,$route:n},e.location&&(t.props=J(n,e.location,t)))}}},A["afterMount"+F]=function(t){K(t.target,k,b,s)},A["afterUpdate"+F]=function(t){K(t.target,C,y,s)},A["afterDestroy"+F]=function(t){K(t.target,L,$)}}export{N as Router,tt as install,_ as version};
//# sourceMappingURL=yox-router.esm.min.js.map
