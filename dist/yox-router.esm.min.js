const t=window,e=t.location,o=t.history,n=void 0,s=null,r=!0,i=!1,c="null",a="true",u="false",h=":",f="/",p="?",l="&",d="=",m="[]",g="history",y="beforeEnter",b="afterEnter",x="beforeUpdate",v="afterUpdate",R="beforeLeave",k="afterLeave",U="beforeRouteEnter",C="afterRouteEnter",j="beforeRouteUpdate",w="afterRouteUpdate",L="beforeRouteLeave",$="afterRouteLeave";class W{setLocation(t,e){return this.to=t,this.from=e,this}clear(){return this.list=[],this}add(t,e){const{list:o}=this;return t&&o.push({fn:t,ctx:e}),this}next(t,e,o){const n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()}}function H(t,e){let o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===a?r:e===u?i:e===c?s:decodeURIComponent(e)),o}function P(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===s?c:void 0}const q="#!",E="hashchange";var O=Object.freeze({start:function(e,o){e.on(t,E,o),o()},stop:function(e,o){e.off(t,E,o)},push:function(t,o){e.hash=q+t.url},go:function(t){o.go(t)},current:function(){const t=e.href,o=t.indexOf(q);return o>0?t.substr(o+q.length):f}});const S="popstate",z="pushState"in o;var A=Object.freeze({isSupported:z,start:function(e,o){e.on(t,S,o),o()},stop:function(e,o){e.off(t,S,o)},push:function(t,e){o.pushState({},"",t.url),e()},go:function(t){o.go(t)},current:function(){return e.pathname+e.search}});let D,I,T=0;const F="$router",M="$route",V="$routeView",B="RouteComponent",G=new Function;function J(t,e){return D.string.startsWith(t,f)||(e?D.string.endsWith(e,f)||(e+=f):e=f,t=e+t),t!==f&&D.string.endsWith(t,f)&&(t=D.string.slice(t,0,-f.length)),t}function K(t,e,o){if(/\/\:\w+/.test(t)){const o=[];D.array.each(t.split(f),function(t){o.push(D.string.startsWith(t,h)&&e?e[t.substr(h.length)]:t)}),t=o.join(f)}if(o){const e=function(t,e){const o=[];for(let n in e){const s=e[n];if(t.is.array(s))t.array.each(s,function(e){const s=P(t,e);t.is.string(s)&&o.push(n+m+d+s)});else{const e=P(t,s);t.is.string(e)&&o.push(n+d+e)}}return o.join(l)}(D,o);e&&(t+=p+e)}return t}function N(t,e){if(D.is.string(t))return J(t);let o,n=t,s=n.name;return K(o=s?e[s]:J(n.path),n.params,n.query)}function Q(t,e,o){const s={},r=o.propTypes;if(r){let o=e.query,i=t.params,c=e.params;if(i&&c){o=o?D.object.copy(o):{};for(let t=0,e=i.length;t<e;t++)o[i[t]]=c[i[t]]}if(o)for(let t in r){let e=o[t];e!==n&&(s[t]=e)}}return s}function X(t,e,o,s){const r=t[M];if(r&&(r.context=s?t:n,function(t){const e=t.child;return!e||!e.context}(r))){const i=t[F];if(e&&o&&i.hook(r,e,o),s){const{pending:t}=i;t&&(t.onComplete(),i.pending=n)}}}class Y{constructor(t){const e=this,o=t.el,s=t.route404||Z;e.options=t,e.el=D.is.string(o)?D.dom.find(o):o,e.mode=t.mode===g&&z?A:O,e.handler=function(){const t=e.mode.current(),{pending:o}=e;if(o){const{location:s}=o;if(s.url===t)return e.setHistory(s,o.cursor),void e.setRoute(s);e.pending=n}e.parseLocation(t,function(t){t?(e.setHistory(t),e.setRoute(t)):e.push(e.route404)})},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new W,D.array.each(t.routes,function(t){e.add(t)}),e.route404=e.add(s)[0]}add(t){const e=this,o=[],n=[],s=[],r=function(t){let{name:i,component:c,children:a,load:u}=t,p=D.array.last(n),l=D.array.last(s),d=J(t.path,p),m={path:d,route:t},g=[];D.array.each(d.split(f),function(t){D.string.startsWith(t,h)&&g.push(t.substr(h.length))}),g.length&&(m.params=g),i&&(m.name=i),c?m.component=c:u&&(m.load=u),l&&(m.parent=l),a?(n.push(d),s.push(m),D.array.each(a,r),s.pop(),n.pop()):(o.push(m),e.routes.push(m),i&&(e.name2Path[i]=d),e.path2Route[d]=m)};return r(t),o}remove(t){const e=this;D.array.remove(e.routes,t),t.name&&delete e.name2Path[t.name],delete e.path2Route[t.path]}push(t){const e=this,{mode:o}=e;e.setUrl(N(t,e.name2Path),G,G,function(t,n){e.pending=n,o.current()!==t.url?o.push(t,e.handler):e.setRoute(t)})}replace(t){const e=this;e.setUrl(N(t,e.name2Path),function(){e.replaceHistory(e.location)},G,function(t,o){e.pending=o,e.setRoute(t)})}go(t){const e=this,{mode:o}=e,n=e.cursor+t,s=e.history[n];s&&e.setUrl(K(s.path,s.params,s.query),G,G,function(s,r){r.cursor=n,e.pending=r,o.current()!==s.url?o.go(t):(e.setHistory(s,n),e.setRoute(s))})}start(){this.mode.start(D.dom,this.handler)}stop(){this.mode.stop(D.dom,this.handler)}hook(t,e,o,s,r){const c=this,{location:a,hooks:u,pending:h}=c;u.clear().add(t.component[e],t.context).add(t.route[o],t.route).add(c.options[o],c);const f=function(t){t===n?u.next(f,s,r):(h&&(h.onAbort(),c.pending=n),t===i?a&&c.push(a):c.push(t))};f()}setHistory(t,e){const{history:o,cursor:n}=this;D.is.number(e)||o[e=n+1]&&(o.length=e),o[e]=t,this.cursor=e}replaceHistory(t){const{history:e,cursor:o}=this;e[o]&&(e[o]=t)}setUrl(t,e,o,n){this.parseLocation(t,function(t){t&&n(t,{location:t,onComplete:e,onAbort:o})})}parseLocation(t,e){let o,n,s=t.indexOf(p);s>=0?(o=t.slice(0,s),n=t.slice(s+1)):o=t;const r=this,i=o.split(f),c=i.length,a=function(t,e){let n,s=0;t:for(;n=t[s++];){const t=n.path;if(n.params){const o=t.split(f);if(c===o.length){const t={};for(let e=0;e<c;e++)if(D.string.startsWith(o[e],h))t[o[e].substr(h.length)]=H(D,i[e]);else if(o[e]!==i[e])continue t;return void e(n,t)}}else{if(n.load&&D.string.startsWith(o,t)){const t=function(t){r.remove(n),a(r.add(t.default||t),e)},o=n.load(t);return void(o&&o.then(t))}if(t===o)return void e(n)}}e()};a(r.routes,function(o,s){if(o){const r={url:t,path:o.path};if(s&&(r.params=s),n){const t=function(t,e){let o;return t.array.each(e.split(l),function(e){let n=e.split(d),s=t.string.trim(n[0]),r=n[1];s&&(o||(o={}),r=H(t,r),t.string.endsWith(s,m)?(s=t.string.slice(s,0,-m.length),t.array.push(o[s]||(o[s]=[]),r)):o[s]=r)}),o}(D,n);t&&(r.query=t)}e(r)}else e()})}diffRoute(t,e,o,s,r,i){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?s=t:t.context=e.context:s=t,t.parent)this.diffRoute(D.object.copy(t.parent),e?e.parent:n,o,s,t,e||i);else{if(s===t){let t;if(e)for(;e;)t=e.context,e=e.parent;else i&&(t=i.context);t&&(s.context=t)}o(t,s)}}patchRoute(t,e){const o=this,s=o.location;for(;t;){let{parent:r,context:i,component:c}=t;if(t===e)if(r){if((i=r.context).forceUpdate(Q(r,s,r.component)),i=i[V]){const t={},e=B+ ++T;t[B]=e,i.component(e,c),i.forceUpdate(t)}}else{i&&i.destroy();const e={};e[F]=o,e[M]=t;const n=D.object.extend({el:o.el,props:Q(t,s,c),extensions:e},c);n.events=n.events?D.object.extend(n.events,I):I,t.context=new D(n)}else if(i&&(i.$vnode?(i[M]=t,i.forceUpdate(Q(t,s,c))):t.context=n,t.child)){t=t.child;continue}break}}setRoute(t){let e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(D.is.func(n)&&(n=n(t)),n))return void e.push(n);const s=D.object.copy(o),i=e.route,c=e.location,a=function(){e.diffRoute(s,i,function(o,n){e.hook(s,n?U:j,n?y:x,r,function(){e.route=s,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,c),i&&c&&t.path!==c.path?e.hook(i,L,R,r,a):a()}}const Z={path:"/404",component:{template:'<div>This is a default 404 page, please set "route404" for your own 404 page.</div>'}},_={bind(t,e,o){const n=(o.context.$root||o.context)[F],s=o.data[e.key]=function(t){let{value:o,getter:s}=e,r=o;o&&s&&D.string.has(o,"{")&&(r=s()),n[e.name](r)};o.isComponent?t.on("click",s):D.dom.on(t,"click",s)},unbind(t,e,o){const n=o.data[e.key];o.isComponent?t.off("click",n):D.dom.off(t,"click",n)}},tt={template:"<$"+B+"/>",beforeCreate(t){const e=t.context,o=e[M].child;if(o){e[V]=this;const n=t.props={},s=t.components={},r=B+ ++T;n[B]=r,s[r]=o.component}},beforeDestroy(){this.$context[V]=n}},et="1.0.0-alpha.36";function ot(t){D=t,t.directive({push:_,replace:_,go:_}),t.component("router-view",tt),I={"beforeCreate.hook":function(t,e){if(e){let t=e,{context:o}=t;if(o&&o.$options.beforeCreate===tt.beforeCreate){const e=(o=o.$context)[F],n=o[M].child;if(n){const o=t.extensions={};o[F]=e,o[M]=n,e.location&&(t.props=Q(n,e.location,t))}}}},"afterMount.hook":function(t){X(t.target,C,b,r)},"afterUpdate.hook":function(t){X(t.target,w,v,r)},"afterDestroy.hook":function(t){X(t.target,$,k)}}}export{Y as Router,ot as install,et as version};
//# sourceMappingURL=yox-router.esm.min.js.map
