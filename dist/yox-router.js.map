{"version":3,"file":"yox-router.js","sources":["../src/constant.ts","../src/Hooks.ts","../src/util/value.ts","../src/util/query.ts","../src/mode/hash.ts","../src/mode/history.ts","../src/Router.ts"],"sourcesContent":["export const WINDOW = window\n\nexport const LOCATION = WINDOW.location\n\nexport const HISTORY = WINDOW.history\n\nexport const UNDEFINED = void 0\n\nexport const NULL = null\n\nexport const TRUE = true\n\nexport const FALSE = false\n\nexport const RAW_NULL = 'null'\n\nexport const RAW_TRUE = 'true'\n\nexport const RAW_FALSE = 'false'\n\n// path 中的参数前缀，如 /user/:userId\nexport const PREFIX_PARAM = ':'\n\n// path 分隔符\nexport const SEPARATOR_PATH = '/'\n\n// path 和 search 的分隔符\nexport const SEPARATOR_SEARCH = '?'\n\n// query 分隔符\nexport const SEPARATOR_QUERY = '&'\n\n// 键值对分隔符\nexport const SEPARATOR_PAIR = '='\n\n// 参数中的数组标识\nexport const FLAG_ARRAY = '[]'\n\n// history 模式\nexport const MODE_HISTORY = 'history'\n\n// 导航钩子 - 路由进入之前\nexport const ROUTER_HOOK_BEFORE_ENTER = 'beforeEnter'\n\n// 导航钩子 - 路由进入之后\nexport const ROUTER_HOOK_AFTER_ENTER = 'afterEnter'\n\n// 导航钩子 - 路由更新之前\nexport const ROUTER_HOOK_BEFORE_UPDATE = 'beforeUpdate'\n\n// 导航钩子 - 路由更新之后\nexport const ROUTER_HOOK_AFTER_UPDATE = 'afterUpdate'\n\n// 导航钩子 - 路由离开之前\nexport const ROUTER_HOOK_BEFORE_LEAVE = 'beforeLeave'\n\n// 导航钩子 - 路由离开之后\nexport const ROUTER_HOOK_AFTER_LEAVE = 'afterLeave'\n\n// 组件 Options 上的导航钩子\nexport const COMPONENT_HOOK_BEFORE_ENTER = 'beforeRouteEnter'\nexport const COMPONENT_HOOK_AFTER_ENTER = 'afterRouteEnter'\nexport const COMPONENT_HOOK_BEFORE_UPDATE = 'beforeRouteUpdate'\nexport const COMPONENT_HOOK_AFTER_UPDATE = 'afterRouteUpdate'\nexport const COMPONENT_HOOK_BEFORE_LEAVE = 'beforeRouteLeave'\nexport const COMPONENT_HOOK_AFTER_LEAVE = 'afterRouteLeave'","import {\n  Task,\n} from 'yox'\n\nimport {\n  Location,\n} from './type'\n\nexport default class Hooks {\n\n  list: Task[]\n\n  to: Location\n\n  from: Location | void\n\n  setLocation(to: Location, from: Location | void) {\n    this.to = to\n    this.from = from\n    return this\n  }\n\n  clear() {\n    this.list = []\n    return this\n  }\n\n  add(hook: Function | void, ctx: any) {\n    const { list } = this\n    if (hook) {\n      list.push({\n        fn: hook,\n        ctx,\n      })\n    }\n    return this\n  }\n\n  next(next: Function, isGuard?: boolean, callback?: Function) {\n    const task = this.list.shift()\n    if (task) {\n      if (isGuard) {\n        task.fn.call(task.ctx, this.to, this.from, next)\n      }\n      else {\n        task.fn.call(task.ctx, this.to, this.from)\n        next()\n      }\n    }\n    else if (callback) {\n      callback()\n    }\n  }\n\n}","import Yox from 'yox'\n\nimport {\n  NULL,\n  TRUE,\n  FALSE,\n  RAW_NULL,\n  RAW_TRUE,\n  RAW_FALSE,\n} from '../constant'\n\n/**\n * 把字符串 value 解析成最合适的类型\n */\nexport function parse(API: typeof Yox, value: string) {\n  let result: any\n  if (API.is.numeric(value)) {\n    result = +value\n  }\n  else if (API.is.string(value)) {\n    if (value === RAW_TRUE) {\n      result = TRUE\n    }\n    else if (value === RAW_FALSE) {\n      result = FALSE\n    }\n    else if (value === RAW_NULL) {\n      result = NULL\n    }\n    else {\n      result = decodeURIComponent(value)\n    }\n  }\n  return result\n}\n\nexport function stringify(API: typeof Yox, value: any): string | void {\n  if (API.is.string(value)) {\n    return encodeURIComponent(value)\n  }\n  else if (API.is.number(value) || API.is.boolean(value)) {\n    return value.toString()\n  }\n  else if (value === NULL) {\n    return RAW_NULL\n  }\n}","import Yox from 'yox'\n\nimport {\n  SEPARATOR_QUERY,\n  SEPARATOR_PAIR,\n  FLAG_ARRAY,\n} from '../constant'\n\nimport * as valueUtil from './value'\n\n/**\n * 把 GET 参数解析成对象\n */\nexport function parse(API: typeof Yox, query: string) {\n  let result: object | undefined\n  API.array.each(\n    query.split(SEPARATOR_QUERY),\n    function (term) {\n\n      let terms = term.split(SEPARATOR_PAIR),\n\n      key = API.string.trim(terms[0]),\n\n      value = terms[1]\n\n      if (key) {\n        if (!result) {\n          result = {}\n        }\n        value = valueUtil.parse(API, value)\n        if (API.string.endsWith(key, FLAG_ARRAY)) {\n          key = API.string.slice(key, 0, -FLAG_ARRAY.length)\n          API.array.push(\n            result[key] || (result[key] = []),\n            value\n          )\n        }\n        else {\n          result[key] = value\n        }\n      }\n\n    }\n  )\n  return result\n}\n\n/**\n * 把对象解析成 key1=value1&key2=value2\n */\nexport function stringify(API: typeof Yox, query: object) {\n  const result: string[] = []\n  for (let key in query) {\n    const value = query[key]\n    if (API.is.array(value)) {\n      API.array.each(\n        value,\n        function (value) {\n          const str = valueUtil.stringify(API, value)\n          if (API.is.string(str)) {\n            result.push(\n              key + FLAG_ARRAY + SEPARATOR_PAIR + str\n            )\n          }\n        }\n      )\n    }\n    else {\n      const str = valueUtil.stringify(API, value)\n      if (API.is.string(str)) {\n        result.push(\n          key + SEPARATOR_PAIR + str\n        )\n      }\n    }\n  }\n  return result.join(SEPARATOR_QUERY)\n}\n","import {\n  DomApi,\n  Listener,\n} from 'yox'\n\nimport {\n  Location,\n} from '../type'\n\nimport {\n  WINDOW,\n  HISTORY,\n  LOCATION,\n  SEPARATOR_PATH,\n} from '../constant'\n\n// hash 前缀，Google 的规范是 #! 开头，如 #!/path/sub?key=value\nconst HASH_PREFIX = '#!',\n\nHASH_CHANGE = 'hashchange'\n\nexport function start(api: DomApi, handler: Function) {\n  api.on(WINDOW, HASH_CHANGE, handler as Listener)\n  handler()\n}\n\nexport function stop(api: DomApi, handler: Function) {\n  api.off(WINDOW, HASH_CHANGE, handler)\n}\n\nexport function push(location: Location, handler: Function) {\n  LOCATION.hash = HASH_PREFIX + location.url\n}\n\nexport function go(n: number) {\n  HISTORY.go(n)\n}\n\nexport function current() {\n\n  // 不能直接读取 window.location.hash\n  // 因为 Firefox 会做 pre-decode\n  const href = LOCATION.href, index = href.indexOf(HASH_PREFIX)\n\n  return index > 0\n    ? href.substr(index + HASH_PREFIX.length)\n    : SEPARATOR_PATH\n\n}\n","import {\n  DomApi,\n  Listener,\n} from 'yox'\n\nimport {\n  Location,\n} from '../type'\n\nimport {\n  WINDOW,\n  HISTORY,\n  LOCATION,\n} from '../constant'\n\nconst POP_STATE = 'popstate'\n\nexport const isSupported = 'pushState' in HISTORY\n\nexport function start(api: DomApi, handler: Function) {\n  api.on(WINDOW, POP_STATE, handler as Listener)\n  handler()\n}\n\nexport function stop(api: DomApi, handler: Function) {\n  api.off(WINDOW, POP_STATE, handler)\n}\n\nexport function push(location: Location, handler: Function) {\n  // 调用 pushState 不会触发 popstate 事件\n  // 因此这里需要手动调用一次 handler\n  HISTORY.pushState({}, '', location.url)\n  handler()\n}\n\nexport function go(n: number) {\n  HISTORY.go(n)\n}\n\nexport function current() {\n  return LOCATION.pathname + LOCATION.search\n}\n","import Yox, {\n  Data,\n  Listener,\n  VNode,\n  Directive,\n  ComponentOptions,\n  CustomEvent,\n  YoxInterface,\n} from 'yox'\n\nimport {\n  TRUE,\n  FALSE,\n  UNDEFINED,\n\n  MODE_HISTORY,\n  PREFIX_PARAM,\n  SEPARATOR_PATH,\n  SEPARATOR_SEARCH,\n\n  ROUTER_HOOK_BEFORE_ENTER,\n  ROUTER_HOOK_AFTER_ENTER,\n  ROUTER_HOOK_BEFORE_UPDATE,\n  ROUTER_HOOK_AFTER_UPDATE,\n  ROUTER_HOOK_BEFORE_LEAVE,\n  ROUTER_HOOK_AFTER_LEAVE,\n\n  COMPONENT_HOOK_BEFORE_ENTER,\n  COMPONENT_HOOK_AFTER_ENTER,\n  COMPONENT_HOOK_BEFORE_UPDATE,\n  COMPONENT_HOOK_AFTER_UPDATE,\n  COMPONENT_HOOK_BEFORE_LEAVE,\n  COMPONENT_HOOK_AFTER_LEAVE,\n} from './constant'\n\nimport {\n  Target,\n  Location,\n  RouteTarget,\n  RouterOptions,\n  RouteOptions,\n  LinkedRoute,\n  RoutePending,\n  Redirect,\n  RouteCallback,\n  RouterMode,\n  RouteBeforeHook,\n  RouteAfterHook,\n} from './type'\n\nimport Hooks from './Hooks'\n\nimport * as queryUtil from './util/query'\nimport * as valueUtil from './util/value'\n\nimport * as hashMode from './mode/hash'\nimport * as historyMode from './mode/history'\n\nlet API: typeof Yox, hookEvents: Record<string, Listener>, guid = 0\n\nconst ROUTE_COMPONENT = 'RouteComponent',\n\nEVENT_CLICK = 'click',\n\nEMPTY_FUNCTION = new Function()\n\n/**\n * 格式化路径，确保它以 / 开头，不以 / 结尾\n */\nfunction formatPath(path: string, parentPath: string | void) {\n\n  // 如果不是 / 开头，表示是相对路径\n  if (!API.string.startsWith(path, SEPARATOR_PATH)) {\n    // 确保 parentPath 以 / 结尾\n    if (parentPath) {\n      if (!API.string.endsWith(parentPath, SEPARATOR_PATH)) {\n        parentPath += SEPARATOR_PATH\n      }\n    }\n    else {\n      parentPath = SEPARATOR_PATH\n    }\n    path = parentPath + path\n  }\n\n  // 如果 path 以 / 结尾，删掉它\n  if (path !== SEPARATOR_PATH\n    && API.string.endsWith(path, SEPARATOR_PATH)\n  ) {\n    path = API.string.slice(path, 0, -SEPARATOR_PATH.length)\n  }\n\n  return path\n\n}\n\n/**\n * 把结构化数据序列化成 url\n */\nfunction stringifyUrl(path: string, params: Data | void, query: Data | void) {\n\n  if (/\\/\\:\\w+/.test(path)) {\n\n    const terms: string[] = []\n\n    API.array.each(\n      path.split(SEPARATOR_PATH),\n      function (item) {\n        terms.push(\n          API.string.startsWith(item, PREFIX_PARAM) && params\n            ? params[item.substr(PREFIX_PARAM.length)]\n            : item\n        )\n      }\n    )\n\n    path = terms.join(SEPARATOR_PATH)\n\n  }\n\n  if (query) {\n    const queryStr = queryUtil.stringify(API, query)\n    if (queryStr) {\n      path += SEPARATOR_SEARCH + queryStr\n    }\n  }\n\n  return path\n\n}\n\nfunction toUrl(target: Target, name2Path: Data): string {\n\n  if (API.is.string(target)) {\n    return formatPath(target as string)\n  }\n\n  let route = target as RouteTarget, name = route.name, path: string\n  if (name) {\n    path = name2Path[name]\n    if (process.env.NODE_ENV === 'development') {\n      if (!API.is.string(path)) {\n        API.logger.error(`The route of name \"${name}\" is not found.`)\n      }\n    }\n  }\n  else {\n    path = formatPath(route.path as string)\n  }\n\n  return stringifyUrl(path, route.params, route.query)\n\n}\n\n/**\n * 按照 propTypes 定义的外部数据格式过滤路由参数，这样有两个好处：\n *\n * 1. 避免传入不符预期的数据\n * 2. 避免覆盖 data 定义的数据\n */\nfunction filterProps(route: LinkedRoute, location: Location, options: ComponentOptions) {\n  const result: Data = {}, propTypes = options.propTypes\n  if (propTypes) {\n\n    let props = location.query,\n\n    routeParams = route.params,\n\n    locationParams = location.params\n\n    // 从 location.params 挑出 route.params 定义过的参数\n    if (routeParams && locationParams) {\n      props = props ? API.object.copy(props) : {}\n      for (let i = 0, length = routeParams.length; i < length; i++) {\n        (props as Data)[routeParams[i]] = locationParams[routeParams[i]]\n      }\n    }\n\n    if (props) {\n      for (let key in propTypes) {\n        let value = props[key]\n        if (value !== UNDEFINED) {\n          result[key] = value\n        }\n      }\n    }\n\n  }\n  return result\n}\n\n/**\n * 是否是叶子节点\n * 如果把叶子节点放在 if 中，会出现即使不是定义时的叶子节点，却是运行时的叶子节点\n */\nfunction isLeafRoute(route: LinkedRoute) {\n  const child = route.child\n  return !child || !child.context\n}\n\nfunction updateRoute(instance: YoxInterface, componentHookName: string | void, hookName: string | undefined, upsert?: boolean) {\n  const route = instance.$route as LinkedRoute\n  if (route) {\n    route.context = upsert ? instance : UNDEFINED\n    if (isLeafRoute(route)) {\n      const router = instance.$router as Router\n      if (componentHookName && hookName) {\n        router.hook(route, componentHookName, hookName)\n      }\n      if (upsert) {\n        const { pending } = router\n        if (pending) {\n          pending.onComplete()\n          router.pending = UNDEFINED\n        }\n      }\n    }\n  }\n}\n\nexport class Router {\n\n  el: Element\n\n  options: RouterOptions\n\n  routes: LinkedRoute[]\n\n  route404: LinkedRoute\n\n  name2Path: Record<string, string>\n\n  path2Route: Record<string, LinkedRoute>\n\n  mode: RouterMode\n\n  history: Location[]\n\n  cursor: number\n\n  pending?: RoutePending\n\n  // 路由钩子\n  hooks: Hooks\n\n  // 路由或参数发生了变化会触发此函数\n  handler: Function\n\n  // 当前渲染的路由\n  route?: LinkedRoute\n\n  // 当前地址栏的路径和参数\n  location?: Location\n\n  constructor(options: RouterOptions) {\n\n    const instance = this, el = options.el, route404 = options.route404 || default404\n\n    instance.options = options\n\n    instance.el = API.is.string(el)\n      ? API.dom.find(el as string) as Element\n      : el as Element\n\n    if (process.env.NODE_ENV === 'development') {\n      if (!instance.el) {\n        API.logger.error(`The \"el\" option must be an element or a selector.`)\n        return\n      }\n    }\n\n    instance.mode = options.mode === MODE_HISTORY && historyMode.isSupported\n      ? historyMode\n      : hashMode\n\n    instance.handler = function () {\n\n      const url = instance.mode.current(), { pending } = instance\n\n      if (pending) {\n        const { location } = pending\n        // 通过 push 或 go 触发\n        if (location.url === url) {\n          instance.setHistory(location, pending.cursor)\n          instance.setRoute(location)\n          return\n        }\n        instance.pending = UNDEFINED\n      }\n\n      // 直接修改地址栏触发\n      instance.parseLocation(\n        url,\n        function (location) {\n          if (location) {\n            instance.setHistory(location)\n            instance.setRoute(location)\n          }\n          else {\n            instance.push(instance.route404)\n          }\n        }\n      )\n    }\n\n    instance.routes = []\n    instance.name2Path = {}\n    instance.path2Route = {}\n\n    instance.history = []\n    instance.cursor = -1\n\n    instance.hooks = new Hooks()\n\n    API.array.each(\n      options.routes,\n      function (route) {\n        instance.add(route)\n      }\n    )\n\n    instance.route404 = instance.add(route404)[0]\n\n  }\n\n  /**\n   * 添加一个新的路由\n   */\n  add(routeOptions: RouteOptions) {\n\n    const instance = this,\n\n    newRoutes: LinkedRoute[] = [],\n\n    pathStack: string[] = [],\n\n    routeStack: LinkedRoute[] = [],\n\n    addRoute = function (routeOptions: RouteOptions) {\n\n      let { name, component, children, load } = routeOptions,\n\n      parentPath = API.array.last(pathStack),\n\n      parentRoute = API.array.last(routeStack),\n\n      path = formatPath(routeOptions.path, parentPath),\n\n      route: LinkedRoute = { path, route: routeOptions },\n\n      params: string[] = []\n\n      API.array.each(\n        path.split(SEPARATOR_PATH),\n        function (item) {\n          if (API.string.startsWith(item, PREFIX_PARAM)) {\n            params.push(\n              item.substr(PREFIX_PARAM.length)\n            )\n          }\n        }\n      )\n\n      if (params.length) {\n        route.params = params\n      }\n\n      if (name) {\n        route.name = name\n      }\n\n      // component 和 load 二选一\n      if (component) {\n        route.component = component\n      }\n      else if (load) {\n        route.load = load\n      }\n\n      if (parentRoute) {\n        route.parent = parentRoute\n      }\n\n      if (children) {\n        pathStack.push(path)\n        routeStack.push(route)\n        API.array.each(\n          children,\n          addRoute\n        )\n        routeStack.pop()\n        pathStack.pop()\n      }\n      else {\n\n        newRoutes.push(route)\n        instance.routes.push(route)\n\n        if (name) {\n          if (process.env.NODE_ENV === 'development') {\n            if (API.object.has(instance.name2Path, name)) {\n              API.logger.error(`The name \"${name}\" of the route is existed.`)\n              return\n            }\n          }\n          instance.name2Path[name] = path\n        }\n\n        if (process.env.NODE_ENV === 'development') {\n          if (API.object.has(instance.path2Route, path)) {\n            API.logger.error(`The path \"${path}\" of the route is existed.`)\n            return\n          }\n        }\n\n        instance.path2Route[path] = route\n\n      }\n\n    }\n\n    addRoute(routeOptions)\n\n    return newRoutes\n\n  }\n\n  /**\n   * 删除一个已注册的路由\n   */\n  remove(route: LinkedRoute) {\n\n    const instance = this\n\n    API.array.remove(instance.routes, route)\n\n    if (route.name) {\n      delete instance.name2Path[route.name]\n    }\n\n    delete instance.path2Route[route.path]\n\n  }\n\n  /**\n   * target 有 3 种格式：\n   *\n   * 如果只是简单的 path，直接传字符串\n   *\n   * push('/index')\n   *\n   * 如果需要带参数，可传对象\n   *\n   * push({\n   *   path: '/index',\n   *   params: { },\n   *   query: { }\n   * })\n   *\n   * 如果路由配置了 name，可用 name 代替 path，如下：\n   *\n   * push({\n   *   name: 'index'\n   * })\n   *\n   */\n  push(target: Target) {\n\n    const instance = this, { mode } = instance\n\n    instance.setUrl(\n      toUrl(target, instance.name2Path),\n      EMPTY_FUNCTION,\n      EMPTY_FUNCTION,\n      function (location, pending) {\n        instance.pending = pending\n        if (mode.current() !== location.url) {\n          mode.push(location, instance.handler)\n        }\n        else {\n          instance.setRoute(location)\n        }\n      }\n    )\n\n  }\n\n  /**\n   * 不改变 URL，只修改路由组件\n   */\n  replace(target: Target) {\n\n    const instance = this\n\n    instance.setUrl(\n      toUrl(target, instance.name2Path),\n      function () {\n        instance.replaceHistory(instance.location as Location)\n      },\n      EMPTY_FUNCTION,\n      function (location, pending) {\n        instance.pending = pending\n        instance.setRoute(location)\n      }\n    )\n\n  }\n\n  /**\n   * 前进或后退 n 步\n   */\n  go(n: number) {\n\n    const instance = this,\n\n    { mode } = instance,\n\n    cursor = instance.cursor + n,\n\n    location = instance.history[cursor]\n\n    if (location) {\n      instance.setUrl(\n        stringifyUrl(location.path, location.params, location.query),\n        EMPTY_FUNCTION,\n        EMPTY_FUNCTION,\n        function (location, pending) {\n          pending.cursor = cursor\n          instance.pending = pending\n\n          if (mode.current() !== location.url) {\n            mode.go(n)\n          }\n          else {\n            instance.setHistory(location, cursor)\n            instance.setRoute(location)\n          }\n        }\n      )\n    }\n\n  }\n\n  /**\n   * 启动路由\n   */\n  start() {\n    this.mode.start(API.dom, this.handler)\n  }\n\n  /**\n   * 停止路由\n   */\n  stop() {\n    this.mode.stop(API.dom, this.handler)\n  }\n\n  /**\n   * 钩子函数\n   */\n  hook(route: LinkedRoute, componentHook: string, hook: string, isGuard?: boolean, callback?: Function) {\n\n    const instance = this, { location, hooks, pending } = instance\n\n    hooks\n      .clear()\n      // 先调用组件的钩子\n      .add((route.component as ComponentOptions)[componentHook], route.context)\n      // 再调用路由配置的钩子\n      .add(route.route[hook], route.route)\n      // 最后调用路由实例的钩子\n      .add(instance.options[hook], instance)\n\n    const next = function (value?: false | Target) {\n      if (value === UNDEFINED) {\n        hooks.next(next, isGuard, callback)\n      }\n      else {\n        // 只有前置守卫才有可能走进这里\n        // 此时 instance.location 还是旧地址\n        if (pending) {\n          pending.onAbort()\n          instance.pending = UNDEFINED\n        }\n        if (value === FALSE) {\n          if (location) {\n            instance.push(location)\n          }\n        }\n        else {\n          // 跳转到别的路由\n          instance.push(value)\n        }\n      }\n    }\n\n    next()\n\n  }\n\n  private setHistory(location: Location, index: number | void) {\n\n    const { history, cursor } = this\n\n    // 如果没传 cursor，表示 push\n    if (!API.is.number(index)) {\n      index = cursor + 1\n      // 确保下一个为空\n      // 如果不为空，肯定是调用过 go()，此时直接清掉后面的就行了\n      if (history[index]) {\n        history.length = index\n      }\n    }\n\n    history[index as number] = location\n\n    this.cursor = index as number\n\n  }\n\n  private replaceHistory(location: Location) {\n    const { history, cursor } = this\n    if (history[cursor]) {\n      history[cursor] = location\n    }\n  }\n\n  private setUrl(\n    url: string,\n    onComplete: Function,\n    onAbort: Function,\n    callback: (locaiton: Location, pending: RoutePending) => void\n  ) {\n\n    // 这里无需判断新旧 url 是否相同，因为存在 replace，即使它们相同也不等价于不用跳转\n    const instance = this\n\n    instance.parseLocation(\n      url,\n      function (location) {\n\n        if (location) {\n          callback(\n            location,\n            {\n              location,\n              onComplete,\n              onAbort,\n            }\n          )\n        }\n        else if (process.env.NODE_ENV === 'development') {\n          API.logger.error(`The url \"${url}\" can't match a route.`)\n        }\n\n      }\n    )\n\n  }\n\n  private parseLocation(url: string, callback: (location?: Location) => void) {\n\n    let realpath: string, search: string | void, index = url.indexOf(SEPARATOR_SEARCH)\n\n    if (index >= 0) {\n      realpath = url.slice(0, index)\n      search = url.slice(index + 1)\n    }\n    else {\n      realpath = url\n    }\n\n    // 匹配已注册的 route\n    const instance = this,\n\n    realpathTerms = realpath.split(SEPARATOR_PATH),\n\n    length = realpathTerms.length,\n\n    matchRoute = function (\n      routes: LinkedRoute[],\n      callback: (route?: LinkedRoute, params?: Data) => void\n    ) {\n\n      let index = 0, route: LinkedRoute | void\n\n      loop: while (route = routes[index++]) {\n        const path = route.path\n\n        // 动态路由\n        if (route.params) {\n          const pathTerms = path.split(SEPARATOR_PATH)\n          // path 段数量必须一致，否则没有比较的意义\n          if (length === pathTerms.length) {\n            const params: Data = {}\n            for (let i = 0; i < length; i++) {\n              if (API.string.startsWith(pathTerms[i], PREFIX_PARAM)) {\n                params[pathTerms[i].substr(PREFIX_PARAM.length)] = valueUtil.parse(API, realpathTerms[i])\n              }\n              // 非参数段不相同\n              else if (pathTerms[i] !== realpathTerms[i]) {\n                continue loop\n              }\n            }\n            callback(route, params)\n            return\n          }\n        }\n        // 懒加载路由，前缀匹配成功后，意味着懒加载回来的路由一定有我们想要的\n        else if (route.load && API.string.startsWith(realpath, path)) {\n          const routeCallback: RouteCallback = function (lazyRoute) {\n            instance.remove(route as LinkedRoute)\n            matchRoute(\n              instance.add(lazyRoute['default'] || lazyRoute),\n              callback\n            )\n          }\n          const promise = route.load(routeCallback)\n          if (promise) {\n            promise.then(routeCallback)\n          }\n          return\n        }\n        else if (path === realpath) {\n          callback(route)\n          return\n        }\n      }\n\n      callback()\n\n    }\n\n    matchRoute(\n      instance.routes,\n      function (route, params) {\n        if (route) {\n          const location: Location = {\n            url,\n            path: route.path\n          }\n          if (params) {\n            location.params = params\n          }\n          if (search) {\n            const query = queryUtil.parse(API, search)\n            if (query) {\n              location.query = query\n            }\n          }\n          callback(location)\n        }\n        else {\n          callback()\n        }\n      }\n    )\n\n  }\n\n  private diffRoute(\n    route: LinkedRoute,\n    oldRoute: LinkedRoute | void,\n    onComplete: (route: LinkedRoute, startRoute: LinkedRoute | void) => void,\n    startRoute: LinkedRoute | void,\n    childRoute: LinkedRoute | void,\n    oldTopRoute: LinkedRoute | void\n  ) {\n\n    // 更新链路\n    if (childRoute) {\n      route.child = childRoute\n      childRoute.parent = route\n    }\n\n    if (oldRoute) {\n      // 同级的两个组件不同，疑似起始更新的路由\n      if (oldRoute.component !== route.component) {\n        startRoute = route\n      }\n      else {\n        // 把上次的组件实例搞过来\n        route.context = oldRoute.context\n      }\n    }\n    else {\n      startRoute = route\n    }\n\n    if (route.parent) {\n      this.diffRoute(\n        API.object.copy(route.parent),\n        oldRoute ? oldRoute.parent : UNDEFINED,\n        onComplete,\n        startRoute,\n        route,\n        oldRoute || oldTopRoute\n      )\n      return\n    }\n\n    // 整个组件树全换掉\n    if (startRoute === route) {\n      let context: YoxInterface | void\n      // 当层级较多的路由切换到层级较少的路由\n      if (oldRoute) {\n        while (oldRoute) {\n          context = oldRoute.context\n          oldRoute = oldRoute.parent\n        }\n      }\n      // 当层级较少的路由切换到层级较多的路由\n      else if (oldTopRoute) {\n        context = oldTopRoute.context\n      }\n      if (context) {\n        startRoute.context = context\n      }\n    }\n\n    // 到达根组件，结束\n    onComplete(route, startRoute)\n\n  }\n\n  private patchRoute(\n    route: LinkedRoute,\n    startRoute: LinkedRoute | void\n  ) {\n\n    const instance = this, location = instance.location as Location\n\n    // 从上往下更新 props\n    while (route) {\n\n      let { parent, context, component } = route\n\n      if (route === startRoute) {\n\n        if (parent) {\n\n          context = parent.context as YoxInterface\n          context.forceUpdate(\n            filterProps(\n              parent,\n              location,\n              parent.component as ComponentOptions\n            )\n          )\n\n          context = context.$routeView\n          if (context) {\n            const props = {}, name = ROUTE_COMPONENT + (++guid)\n            props[ROUTE_COMPONENT] = name\n            context.component(name, component)\n            context.forceUpdate(props)\n          }\n\n        }\n        else {\n\n          if (context) {\n            context.destroy()\n          }\n\n          // 每层路由组件都有 $route 和 $router 属性\n          const extensions = {\n            $router: instance,\n            $route: route\n          }\n\n          const options: ComponentOptions = API.object.extend(\n            {\n              el: instance.el,\n              props: filterProps(route, location, component as ComponentOptions),\n              extensions,\n            },\n            component as ComponentOptions\n          )\n\n          options.events = options.events\n            ? API.object.extend(options.events, hookEvents)\n            : hookEvents\n\n          route.context = new API(options)\n\n        }\n\n      }\n\n      else if (context) {\n        if (context.$vnode) {\n          context.$route = route\n          context.forceUpdate(\n            filterProps(route, location, component as ComponentOptions)\n          )\n        }\n        else {\n          route.context = UNDEFINED\n        }\n        if (route.child) {\n          route = route.child as LinkedRoute\n          continue\n        }\n      }\n      break\n    }\n  }\n\n  private setRoute(location: Location) {\n\n    let instance = this,\n\n    linkedRoute = instance.path2Route[location.path],\n\n    redirect = linkedRoute.route.redirect\n\n    if (redirect) {\n      if (API.is.func(redirect)) {\n        redirect = (redirect as Redirect)(location)\n      }\n      if (redirect) {\n        instance.push(redirect as Target)\n        return\n      }\n    }\n\n    const newRoute = API.object.copy(linkedRoute),\n\n    oldRoute = instance.route,\n\n    oldLocation = instance.location,\n\n    enterRoute = function () {\n      instance.diffRoute(\n        newRoute,\n        oldRoute,\n        function (route, startRoute) {\n          instance.hook(\n            newRoute,\n            startRoute ? COMPONENT_HOOK_BEFORE_ENTER : COMPONENT_HOOK_BEFORE_UPDATE,\n            startRoute ? ROUTER_HOOK_BEFORE_ENTER : ROUTER_HOOK_BEFORE_UPDATE,\n            TRUE,\n            function () {\n\n              instance.route = newRoute\n              instance.location = location\n\n              instance.patchRoute(route, startRoute)\n\n            }\n          )\n        }\n      )\n    }\n\n    instance.hooks.setLocation(location, oldLocation)\n\n    if (oldRoute && oldLocation && location.path !== oldLocation.path) {\n      instance.hook(\n        oldRoute,\n        COMPONENT_HOOK_BEFORE_LEAVE,\n        ROUTER_HOOK_BEFORE_LEAVE,\n        TRUE,\n        enterRoute\n      )\n      return\n    }\n\n    enterRoute()\n\n  }\n\n}\n\nconst default404 = {\n  path: '/404',\n  component: {\n    template: '<div>This is a default 404 page, please set \"route404\" for your own 404 page.</div>'\n  }\n},\n\ndirective = {\n  bind(node: HTMLElement | YoxInterface, directive: Directive, vnode: VNode) {\n\n    // 当前组件如果是根组件，则没有 $root 属性\n    const $root = vnode.context.$root || vnode.context,\n\n    router = $root.$router as Router,\n\n    listener = vnode.data[directive.key] = function (_: CustomEvent) {\n      let { value, getter } = directive, target: any = value\n      if (value && getter && API.string.has(value as string, '{')) {\n        target = getter()\n      }\n      router[directive.name](target)\n    }\n\n    if (vnode.isComponent) {\n      (node as YoxInterface).on(EVENT_CLICK, listener)\n    }\n    else {\n      API.dom.on(node as HTMLElement, EVENT_CLICK, listener)\n    }\n\n  },\n  unbind(node: HTMLElement | YoxInterface, directive: Directive, vnode: VNode) {\n    const listener = vnode.data[directive.key]\n    if (vnode.isComponent) {\n      (node as YoxInterface).off(EVENT_CLICK, listener)\n    }\n    else {\n      API.dom.off(node as HTMLElement, EVENT_CLICK, listener)\n    }\n  },\n},\n\nRouterView: ComponentOptions = {\n  template: '<$' + ROUTE_COMPONENT + '/>',\n  beforeCreate(options) {\n\n    const context = options.context as YoxInterface,\n\n    // context 一定有 $route 属性\n    route = (context.$route as LinkedRoute).child as LinkedRoute\n\n    if (route) {\n\n      context.$routeView = this\n\n      const props = options.props = {}, components = options.components = {},\n\n      name = ROUTE_COMPONENT + (++guid)\n\n      props[ROUTE_COMPONENT] = name\n      components[name] = route.component\n\n    }\n\n  },\n  beforeDestroy() {\n    this.$context.$routeView = UNDEFINED\n  }\n}\n\n/**\n * 版本\n */\nexport const version = process.env.NODE_VERSION\n\n/**\n * 安装插件\n */\nexport function install(YoxClass: typeof Yox): void {\n\n  API = YoxClass\n\n  API.directive({\n    push: directive,\n    replace: directive,\n    go: directive,\n  })\n\n  API.component('router-view', RouterView)\n\n  hookEvents = {\n    'beforeCreate.hook': function (event: CustomEvent, data?: Data) {\n      if (data) {\n        let options = data as ComponentOptions, { context } = options\n        // 当前组件是 <router-view> 中的动态组件\n        if (context && context.$options.beforeCreate === RouterView.beforeCreate) {\n          // 找到渲染 <router-view> 的父级组件，它是一定存在的\n          context = context.$context as YoxInterface\n\n          const router = context.$router as Router,\n\n          // context 一定有 $route 属性\n          route = (context.$route as LinkedRoute).child as LinkedRoute\n\n          if (route) {\n            options.extensions = {\n              $router: router,\n              $route: route,\n            }\n            if (router.location) {\n              options.props = filterProps(route, router.location, options)\n            }\n          }\n        }\n      }\n    },\n    'afterMount.hook': function (event: CustomEvent) {\n      updateRoute(\n        event.target as YoxInterface,\n        COMPONENT_HOOK_AFTER_ENTER,\n        ROUTER_HOOK_AFTER_ENTER,\n        TRUE\n      )\n    },\n    'afterUpdate.hook': function (event: CustomEvent) {\n      updateRoute(\n        event.target as YoxInterface,\n        COMPONENT_HOOK_AFTER_UPDATE,\n        ROUTER_HOOK_AFTER_UPDATE,\n        TRUE\n      )\n    },\n    'afterDestroy.hook': function (event: CustomEvent) {\n      updateRoute(\n        event.target as YoxInterface,\n        COMPONENT_HOOK_AFTER_LEAVE,\n        ROUTER_HOOK_AFTER_LEAVE\n      )\n    }\n  }\n\n}\n\ndeclare module 'yox' {\n\n  interface ComponentOptions {\n    [COMPONENT_HOOK_BEFORE_ENTER]?: RouteBeforeHook\n    [COMPONENT_HOOK_AFTER_ENTER]?: RouteAfterHook\n    [COMPONENT_HOOK_BEFORE_UPDATE]?: RouteBeforeHook\n    [COMPONENT_HOOK_AFTER_UPDATE]?: RouteAfterHook\n    [COMPONENT_HOOK_BEFORE_LEAVE]?: RouteBeforeHook\n    [COMPONENT_HOOK_AFTER_LEAVE]?: RouteAfterHook\n  }\n\n  interface YoxInterface {\n    $routeView?: YoxInterface\n    $route?: LinkedRoute\n    $router?: Router\n  }\n\n}\n"],"names":["const","next","let","parse","valueUtil.parse","stringify","valueUtil.stringify","start","stop","push","go","current","queryUtil.stringify","historyMode.isSupported","hook","queryUtil.parse"],"mappings":"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"}