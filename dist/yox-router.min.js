!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).YoxRouter={})}(this,function(t){"use strict";var n,e,o,r=void 0,i="#!",s=":",a="/",u="&",c="=",h="[]",p="",f="*";function l(t){var e;return n.is.numeric(t)?e=+t:n.is.string(t)&&(e="true"===t||"false"!==t&&("null"===t?null:"undefined"===t?r:decodeURIComponent(t))),e}function m(t,e){var o=[t];return n.is.string(e)?o.push(encodeURIComponent(e)):n.is.number(e)||n.is.boolean(e)?o.push(e.toString()):null===e?o.push("null"):e===r&&o.push("undefined"),o.join(c)}function g(t,e){var o,r,i=e.indexOf("?");i>=0?(o=e.substring(0,i),r=e.substring(i+1)):o=e;var p={realpath:o},f=function(t,e){var o,r=e.split(a),i=r.length;return n.object.each(t,function(t,e){var u=e.split(a);if(i===u.length){for(var c=0;c<i;c++)if(!n.string.startsWith(u[c],s)&&u[c]!==r[c])return;return o=e,!1}}),o}(t,o);if(f){p.path=f;var m=function(t,e){var o,r=t.split(a),i=e.split(a);return r.length===i.length&&n.array.each(i,function(t,e){n.string.startsWith(t,s)&&(o||(o={}),o[t.substr(s.length)]=l(r[e]))}),o}(o,f);if(m&&(p.params=m),r){var g=function(t){var e;return n.array.each(t.split(u),function(t){var o=t.split(c),r=n.string.trim(o[0]),i=o[1];r&&(e||(e={}),i=l(i),n.string.endsWith(r,h)?(r=n.string.slice(r,0,-h.length),n.array.push(e[r]||(e[r]=[]),i)):e[r]=i)}),e}(r);g&&(p.query=g)}}return p}function v(t,e,o){var r,c=[],p="";if(n.array.each(t.split(a),function(t){c.push(n.string.startsWith(t,s)?e[t.substr(s.length)]:t)}),r=c.join(a),o){var f=function(t){var e=[];return n.object.each(t,function(t,o){n.is.array(t)?n.array.each(t,function(t){e.push(m(o+h,t))}):e.push(m(o,t))}),e.join(u)}(o);f&&(p="?"+f)}return i+r+p}var d=function(){function t(t){this.name=t,this.list=[]}return t.prototype.append=function(t,e){var o=this.name,r=this.list;return t&&n.is.func(t[o])&&r.push({fn:t[o],ctx:e}),this},t.prototype.run=function(t,n,e,o){var r=this.list,i=function(s){if(null==s){var a=r.shift();a?a.fn.call(a.ctx,t,n,i):e&&e()}else o&&o(s)};i()},t}(),y=function(){function t(t){var e=this;e.name2Path={},e.path2Route={},e.onHashChange=function(){var t=location.hash;t=n.string.startsWith(t,i)?t.substr(i.length):"";var o=g(e.path2Route,t),r=o.path||(t?f:p),s=e.path2Route[r];e.setRoute({component:s.component,path:r,params:o.params,query:o.query},s)},n.object.each(t,function(t,n){t.name&&(e.name2Path[t.name]=n),e.path2Route[n]=t})}return t.prototype.go=function(t){if(n.is.string(t))location.hash=v(t);else if(n.is.object(t))if(n.object.has(t,"component")){var e=t,o=e.component,r=e.props;this.setRoute({component:o,props:r})}else if(n.object.has(t,"name")){var i=t,s=i.name,a=i.params,u=i.query,c=this.name2Path[s];location.hash=v(c,a,u)}},t.prototype.setRoute=function(t,o){var i=this,s=i.currentRoute,a=t.params,u=t.query,c=t.component,h=t.props,p=i.currentComponent||(i.currentComponent={name:c}),f=function(t){!1===t?s&&s.path&&(location.hash=v(s.path,s.params,s.query)):i.go(t)},l=function(n,e,r){new d(n).append(p.options,p.root).append(o,o).append(i,i).run(t,s,e,r)},m=function(e){p.options=e,l("beforeEnter",function(){(a||u)&&(h={},a&&n.object.extend(h,a),u&&n.object.extend(h,u)),p.root=new n(n.object.extend({el:i.el,props:h,extensions:{$router:i}},e)),i.currentRoute=t,l("afterEnter")},f)},g=function(t){l("beforeLeave",function(){p.root&&(p.root.destroy(),p.root=r),l("afterLeave"),m(t)},f)};p.name!==c&&(p.name=c),e.component(c,function(t){c===p.name&&(p.root?p.options===t?l("refreshing",function(){g(t)},f):g(t):m(t))})},t.prototype.start=function(t){if(n.is.string(t)){var e=o.find(t);e&&(this.el=e)}else this.el=t;o.on(window,"hashchange",this.onHashChange),this.onHashChange()},t.prototype.stop=function(){this.el=r,o.off(window,"hashchange",this.onHashChange)},t}();t.Router=y,t.install=function(t){n=t,e=new t,o=t.dom},t.register=function(t,n){e.component(t,n)},t.version="0.30.0",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
