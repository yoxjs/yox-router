!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e=!0,o=!1,n=null,r=void 0,i="true",a="false",s="null",c="undefined",u=function(){},p=(Object.freeze({}),Object.freeze([]),""),f=function(){function t(){}return t.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},t.prototype.clear=function(){return this.list=[],this},t.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},t.prototype.next=function(t,e,o){var n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()},t}(),h="#!",l="/",d="&",v="=",y="[]",m="afterEnter",g="afterRouteEnter",b="afterUpdate",R="afterRouteUpdate",x="afterLeave",C="afterRouteLeave";function L(t,u){var p;return t.is.numeric(u)?p=+u:t.is.string(u)&&(p=u===i?e:u===a?o:u===s?n:u===c?r:decodeURIComponent(u)),p}function k(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===n?s:c}var H,U,j=0,$=window,W=$.location,w="$router",q="$route";function P(t,e){return H.string.startsWith(t,l)||(e?H.string.endsWith(e,l)||(e+=l):e=l,t=e+t),t!==l&&H.string.endsWith(t,l)&&(t=H.string.slice(t,0,-l.length)),t}function E(t,e){var o={hash:p,path:p};if(H.is.string(t))o.path=P(t);else{var n=t,r=n.name;o.path=r?e[r]:P(n.path),n.params&&(o.params=n.params),n.query&&(o.query=n.query)}return o}function O(t,e,o){var n={},r=o.propTypes;if(r){var i=e.query,a=t.params,s=e.params;if(a&&s){i=i?H.object.copy(i):{};for(var c=0,u=void 0;u=a[c];c++)i[u]=s[u]}if(i)for(var u in r)n[u]=H.checkProp(u,i[u],r[u])}return n}function D(t,e,o,n){var i=t[q];if(i&&(i.context=n?t:r,function(t){var e=t.child;return!e||!e.context}(i))){var a=t[w];if(e&&o&&a.hook(i,e,o),n){var s=a.pending;s&&(s.onComplete(),a.pending=r)}}}var M=function(){function t(t){var e=this,o=t.el,n=t.route404;e.el=H.is.string(o)?U.find(o):o,e.onHashChange=function(){var t=W.hash,o=e.pending,n=e.route404;if(t=t!==h&&H.string.startsWith(t,h)?t.substr(h.length):l,o){var i=o.location;if(i.hash===t)return e.setHistory(i,o.cursor),void e.setRoute(i);e.pending=r}e.parseLocation(t,function(t){t?(e.setHistory(t),e.setRoute(t)):e.push(n)})},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new f,e.add(t.routes),e.route404=e.add([n])[0]}return t.prototype.add=function(t){var e=this,o=[],n=[],r=[],i=function(t){var a=t.name,s=t.component,c=t.children,u=H.array.last(n),p=H.array.last(r),f=P(t.path,u),h={path:f,component:s,route:t},d=[];H.array.each(f.split(l),function(t){H.string.startsWith(t,":")&&d.push(t.substr(":".length))}),d.length&&(h.params=d),p&&(h.parent=p),c?(n.push(f),r.push(h),H.array.each(c,i),r.pop(),n.pop()):(o.push(h),e.routes.push(h),a&&(e.name2Path[a]=f),e.path2Route[f]=h)};return H.array.each(t,i),o},t.prototype.push=function(t){var e=this;e.setLocation(E(t,e.name2Path),r,u,u,function(t){e.setHash(t)})},t.prototype.replace=function(t){var e=this;e.setLocation(E(t,e.name2Path),r,function(){e.replaceHistory(e.location)},u,function(t){e.setRoute(t)})},t.prototype.go=function(t){var e=this,o=e.cursor+t,n=e.history[o];n&&e.setLocation(n,o,u,u,function(t){e.setHash(t)})},t.prototype.start=function(){U.on($,"hashchange",this.onHashChange),this.onHashChange()},t.prototype.stop=function(){U.off($,"hashchange",this.onHashChange)},t.prototype.hook=function(t,e,n,i,a){var s=this,c=s.location,u=s.hooks,p=s.pending;u.clear().add(t.component[e],t.context).add(t.route[n],t.route).add(s[n],s);var f=function(t){t===r?u.next(f,i,a):(p&&(p.onAbort(),s.pending=r),t===o?c&&s.push(c):s.push(t))};f()},t.prototype.setHistory=function(t,e){var o=this.history,n=this.cursor;H.is.number(e)||o[e=n+1]&&(o.length=e),o[e]=t,this.cursor=e},t.prototype.replaceHistory=function(t){var e=this.history,o=this.cursor;e[o]&&(e[o]=t)},t.prototype.setHash=function(t){var e=h+t.hash;W.hash!==e?W.hash=e:this.setRoute(t)},t.prototype.setLocation=function(t,e,o,n,i){var a=this,s=a.stringifyLocation(t),c=a.location,u=c?a.stringifyLocation(c):r;a.parseLocation(s,function(t){t||(t={hash:s=a.route404.path,path:s}),s!==u&&(a.pending={cursor:e,location:t,onComplete:o,onAbort:n},i(t))})},t.prototype.parseLocation=function(t,e){var o,n,r=t.indexOf("?");r>=0?(o=t.slice(0,r),n=t.slice(r+1)):o=t,r=0;var i=this,a=o.split(l),s=a.length,c=function(t,e){var n;t:for(;n=t[r++];){var u=n.path;if(n.params){var p=u.split(l);if(s===p.length){for(var f={},h=0;h<s;h++)if(H.string.startsWith(p[h],":"))f[p[h].substr(":".length)]=L(H,a[h]);else if(p[h]!==a[h])continue t;return void e(n,f)}}else{if(n.load&&H.string.startsWith(o,u))return void n.load(function(t){c(i.add([t]),e)});if(u===o)return void e(n)}}e()};c(i.routes,function(o,r){if(o){var i={hash:t,path:o.path};if(r&&(i.params=r),n){var a=function(t,e){var o;return t.array.each(e.split(d),function(e){var n=e.split(v),r=t.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=L(t,i),t.string.endsWith(r,y)?(r=t.string.slice(r,0,-y.length),t.array.push(o[r]||(o[r]=[]),i)):o[r]=i)}),o}(H,n);a&&(i.query=a)}e(i)}else e()})},t.prototype.stringifyLocation=function(t){var e=t.path,o=t.params,n=t.query,r=[];H.array.each(e.split(l),function(t){r.push(H.string.startsWith(t,":")&&o?o[t.substr(":".length)]:t)});var i=r.join(l);if(n){var a=function(t,e){var o=[],n=function(n){var r=e[n];t.is.array(r)?t.array.each(r,function(e){o.push(n+y+v+k(t,e))}):o.push(n+v+k(t,r))};for(var r in e)n(r);return o.join(d)}(H,n);a&&(i+="?"+a)}return i},t.prototype.diffRoute=function(t,e,o,n,i,a){if(i&&(t.child=i,i.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(H.object.copy(t.parent),e?e.parent:r,o,n,t,e||a);else{if(n===t){var s=void 0;if(e)for(;e;)s=e.context,e=e.parent;else a&&(s=a.context);s&&(n.context=s)}o(t,n)}},t.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,i=t.context,a=t.component;if(t===e)if(n){if((i=n.context).forceUpdate(O(n,o,n.component)),i=i.$routeView){var s={},c="RouteComponent"+ ++j;s.RouteComponent=c,i.component(c,a),i.forceUpdate(s)}}else{i&&i.destroy();var u={};u[w]=this,u[q]=t,t.context=new H(H.object.extend({el:this.el,props:O(t,o,a),extensions:u},a))}else if(i&&(i.$vnode?(i[q]=t,i.forceUpdate(O(t,o,a))):t.context=r,t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t){var o=this,n=o.path2Route[t.path],r=n.route.redirect;if(r&&(H.is.func(r)&&(r=r(t)),r))o.push(r);else{var i=H.object.copy(n),a=o.route,s=o.location,c=function(){o.diffRoute(i,a,function(n,r){o.hook(i,r?"beforeRouteEnter":"beforeRouteUpdate",r?"beforeEnter":"beforeUpdate",e,function(){o.route=i,o.location=t,o.patchRoute(n,r)})})};o.hooks.setLocation(t,s),a&&s&&t.path!==s.path?o.hook(a,"beforeRouteLeave","beforeLeave",e,c):c()}},t}(),V={bind:function(t,e,o){var n=(o.context.$root||o.context)[w],r=o.data[e.key]=function(t){var o=e.value,r=e.getter,i=o;o&&r&&H.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):U.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):U.off(t,"click",n)}},z={template:"<$RouteComponent/>",beforeCreate:function(t){var e=t.parent,o=e[q].child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++j;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$parent.$routeView=r}};t.Router=M,t.install=function(t){H=t,U=t.dom,H.directive({push:V,replace:V,go:V}),H.component("router-view",z);var o=H.beforeCreate,n=H.afterMount,r=H.afterUpdate,i=H.afterDestroy;H.beforeCreate=function(t){o&&o(t);var e=t.parent;if(e&&t.beforeCreate!==z.beforeCreate&&(e=e.$parent)){var n=e[w],r=e[q].child;if(n&&r){var i=t.extensions={};i[w]=n,i[q]=r,n.location&&(t.props=O(r,n.location,t))}}},H.afterMount=function(t){n&&n(t),D(t,g,m,e)},H.afterUpdate=function(t){r&&r(t),D(t,R,b,e)},H.afterDestroy=function(t){i&&i(t),D(t,C,x)}},t.version="1.0.0-alpha5",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
