!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((t=t||self).YoxRouter={})}(this,function(t){"use strict";var o=!0,e=!1,n=null,r=void 0,a="true",i="false",s="null",u="undefined",c=function(){},p=(Object.freeze({}),Object.freeze([]),""),h=function(){function t(){}return t.prototype.setLocation=function(t,o){return this.to=t,this.from=o,this},t.prototype.clear=function(){return this.list=[],this},t.prototype.add=function(t,o){var e=this.list;return t&&e.push({fn:t,ctx:o}),this},t.prototype.next=function(t,o,e){var n=this.list.shift();n?o?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):e&&e()},t}(),f="#!",l=":",v="/",d="?",y="&",m="=",g="[]",b="afterEnter",R="afterRouteEnter",x="afterUpdate",C="afterRouteUpdate",k="afterLeave",U="afterRouteLeave";function j(t,c){var p;return t.is.numeric(c)?p=+c:t.is.string(c)&&(p=c===a?o:c===i?e:c===s?n:c===u?r:decodeURIComponent(c)),p}function H(t,o){return t.is.string(o)?encodeURIComponent(o):t.is.number(o)||t.is.boolean(o)?o.toString():o===n?s:u}function L(t,o,e){var n,r,a=e.indexOf(d);a>=0?(n=e.slice(0,a),r=e.slice(a+1)):n=e;var i=function(t,o,e){var n,r=e.split(v),a=r.length,i=0;t:for(;n=o[i++];)if(n.params){var s=n.path.split(v);if(a===s.length){for(var u=0;u<a;u++)if(!t.string.startsWith(s[u],l)&&s[u]!==r[u])continue t;return n}}else if(n.path===e)return n}(t,o,n);if(i){var s={hash:e,path:i.path};if(i.params){var u=function(t,o,e){var n,r=e.split(v),a=o.split(v);return r.length===a.length&&t.array.each(a,function(o,e){t.string.startsWith(o,l)&&(n||(n={}),n[o.substr(l.length)]=j(t,r[e]))}),n}(t,i.path,n);u&&(s.params=u)}if(r){var c=function(t,o){var e;return t.array.each(o.split(y),function(o){var n=o.split(m),r=t.string.trim(n[0]),a=n[1];r&&(e||(e={}),a=j(t,a),t.string.endsWith(r,g)?(r=t.string.slice(r,0,-g.length),t.array.push(e[r]||(e[r]=[]),a)):e[r]=a)}),e}(t,r);c&&(s.query=c)}return s}}function $(t,o){var e=o.path,n=o.params,r=o.query,a=[];t.array.each(e.split(v),function(o){a.push(t.string.startsWith(o,l)&&n?n[o.substr(l.length)]:o)});var i=a.join(v);if(r){var s=function(t,o){var e=[],n=function(n){var r=o[n];t.is.array(r)?t.array.each(r,function(o){e.push(n+g+m+H(t,o))}):e.push(n+m+H(t,r))};for(var r in o)n(r);return e.join(y)}(t,r);s&&(i+=d+s)}return i}var w,W,q=0,P=window,E=P.location,O="$router",D="$route";function M(t,o){return t!==v&&w.string.endsWith(t,v)&&(t=w.string.slice(t,0,-1)),w.string.startsWith(t,v)||(t?t=w.string.falsy(o)?v+t:o+v+t:o&&(t=o)),t}function V(t,o){var e={hash:p,path:p};if(w.is.string(t))e.path=M(t);else{var n=t,r=n.name;e.path=r?o[r]:M(n.path),n.params&&(e.params=n.params),n.query&&(e.query=n.query)}return e}function z(t,o,e){var n={},r=e.propTypes;if(r){var a=o.query,i=t.params,s=o.params;if(i&&s){a=a?w.object.copy(a):{};for(var u=0,c=void 0;c=i[u];u++)a[c]=s[c]}if(a)for(var c in r)n[c]=w.checkProp(c,a[c],r[c])}return n}function A(t,o,e,n){var a=t[D];if(a&&(a.context=n?t:r,function(t){var o=t.child;return!o||!o.context}(a))){var i=t[O];o&&e&&i.hook(a,o,e),n&&i.loading&&(i.loading.onComplete(),i.loading=r)}}var I=function(){function t(t){var o=this,e=t.el,n=t.route404;o.el=w.is.string(e)?W.find(e):e,o.onHashChange=function(){var t=E.hash,e=o.loading,n=o.routes,a=o.route404;if(t=t!==f&&w.string.startsWith(t,f)?t.substr(f.length):v,e){if(e.location.hash===t)return void o.setRoute(e.location);o.loading=r}var i=L(w,n,t);if(i)return o.pushHistory(i),void o.setRoute(i);o.push(a)},o.routes=[],o.name2Path={},o.path2Route={},o.history=[],o.cursor=-1,o.hooks=new h,o.add(t.routes),o.add([n]),o.route404=w.array.last(o.routes)}return t.prototype.add=function(t){var o=this,e=[],n=[],r=function(t){var a=t.name,i=t.component,s=t.children,u=w.array.last(e),c=w.array.last(n),p=M(t.path,u),h={path:p,component:i,route:t},f=[];w.array.each(p.split(v),function(t){w.string.startsWith(t,l)&&f.push(t.substr(l.length))}),f.length&&(h.params=f),c&&(h.parent=c),s?(e.push(p),n.push(h),w.array.each(s,r),n.pop(),e.pop()):(o.routes.push(h),a&&(o.name2Path[a]=p),o.path2Route[p]=h)};w.array.each(t,r)},t.prototype.push=function(t){var o=this,e=o.setLocation(V(t,o.name2Path),function(){o.pushHistory(e)},c);e&&o.setHash(e)},t.prototype.replace=function(t){var o=this,e=o.setLocation(V(t,o.name2Path),function(){var t=o.history,n=o.cursor;t[n]&&(t[n]=e)},c);e&&o.setRoute(e)},t.prototype.go=function(t){var o=this,e=o.cursor+t,n=o.history[e];n&&(n=o.setLocation(n,function(){o.cursor=e},c))&&o.setHash(n)},t.prototype.start=function(){W.on(P,"hashchange",this.onHashChange),this.onHashChange()},t.prototype.stop=function(){W.off(P,"hashchange",this.onHashChange)},t.prototype.hook=function(t,o,n,a,i){var s=this,u=s.location,c=s.hooks,p=s.loading;c.clear().add(t.component[o],t.context).add(t.route[n],t.route).add(s[n],s);var h=function(t){t===r?c.next(h,a,i):(p&&(p.onAbort(),s.loading=r),t===e?u&&s.push(u):s.push(t))};h()},t.prototype.pushHistory=function(t){var o=this.history,e=this.cursor;o[++e]&&(o.length=e),o[e]=t,this.cursor=e},t.prototype.setHash=function(t){var o=f+t.hash;E.hash!==o?E.hash=o:this.setRoute(t)},t.prototype.setLocation=function(t,o,e){var n=$(w,t),a=this.location,i=a?$(w,a):r,s=L(w,this.routes,n);if(t=s||{hash:n=this.route404.path,path:n},n!==i)return this.loading={location:t,onComplete:o,onAbort:e},t},t.prototype.diffRoute=function(t,o,e,n,a,i){if(a&&(t.child=a,a.parent=t),o?o.component!==t.component?n=t:t.context=o.context:n=t,t.parent)this.diffRoute(w.object.copy(t.parent),o?o.parent:r,e,n,t,o||i);else{if(n===t){var s=void 0;if(o)for(;o;)s=o.context,o=o.parent;else i&&(s=i.context);s&&(n.context=s)}e(t,n)}},t.prototype.patchRoute=function(t,o){for(var e=this.location;t;){var n=t.parent,a=t.context,i=t.component;if(t===o)if(n){if((a=n.context).forceUpdate(z(n,e,n.component)),a=a.$routeView){var s={},u="RouteComponent"+ ++q;s.RouteComponent=u,a.component(u,i),a.forceUpdate(s)}}else{a&&a.destroy();var c={};c[O]=this,c[D]=t,t.context=new w(w.object.extend({el:this.el,props:z(t,e,i),extensions:c},i))}else if(a&&(a.$vnode?(a[D]=t,a.forceUpdate(z(t,e,i))):t.context=r,t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t){var e=this,n=w.object.copy(e.path2Route[t.path]),r=e.route,a=e.location,i=function(){e.diffRoute(n,r,function(r,a){e.hook(n,a?"beforeRouteEnter":"beforeRouteUpdate",a?"beforeEnter":"beforeUpdate",o,function(){e.route=n,e.location=t,e.patchRoute(r,a)})})};e.hooks.setLocation(t,a),r&&a&&t.path!==a.path?e.hook(r,"beforeRouteLeave","beforeLeave",o,i):i()},t}(),_={bind:function(t,o,e){var n=(e.context.$root||e.context)[O],r=e.data[o.key]=function(t){var e=o.value,r=o.getter,a=e;e&&r&&w.string.has(e,"{")&&(a=r()),n[o.name](a)};e.isComponent?t.on("click",r):W.on(t,"click",r)},unbind:function(t,o,e){var n=e.data[o.key];e.isComponent?t.off("click",n):W.off(t,"click",n)}},S={template:"<$RouteComponent/>",beforeCreate:function(t){var o=t.parent,e=o[D].child;if(e){o.$routeView=this;var n={},r={},a="RouteComponent"+ ++q;n.RouteComponent=a,r[a]=e.component,t.props=n,t.components=r}},beforeDestroy:function(){this.$parent.$routeView=r}};t.Router=I,t.install=function(t){w=t,W=t.dom,w.directive({push:_,replace:_}),w.component("router-view",S);var e=w.beforeCreate,n=w.afterMount,r=w.afterUpdate,a=w.afterDestroy;w.beforeCreate=function(t){e&&e(t);var o=t.parent;if(o&&t.beforeCreate!==S.beforeCreate&&(o=o.$parent)){var n=o[O],r=o[D].child;if(n&&r){var a=t.extensions={};a[O]=n,a[D]=r,n.location&&(t.props=z(r,n.location,t))}}},w.afterMount=function(t){n&&n(t),A(t,R,b,o)},w.afterUpdate=function(t){r&&r(t),A(t,C,x,o)},w.afterDestroy=function(t){a&&a(t),A(t,U,k)}},t.version="1.0.0-alpha2",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
