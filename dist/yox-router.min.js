!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e=!0,o=!1,n=null,r=void 0,a="true",i="false",s="null",u="undefined",c=function(){},p=(Object.freeze({}),Object.freeze([]),""),h=function(){function t(){}return t.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},t.prototype.clear=function(){return this.list=[],this},t.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},t.prototype.next=function(t,e,o){var n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()},t}(),f="#!",l=":",v="/",d="?",y="&",m="=",g="[]",b="afterEnter",R="afterRouteEnter",x="afterUpdate",C="afterRouteUpdate",k="afterLeave",H="afterRouteLeave";function U(t,c){var p;return t.is.numeric(c)?p=+c:t.is.string(c)&&(p=c===a?e:c===i?o:c===s?n:c===u?r:decodeURIComponent(c)),p}function j(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===n?s:u}function L(t,e,o){var n,r,a=o.indexOf(d);a>=0?(n=o.slice(0,a),r=o.slice(a+1)):n=o;var i=function(t,e,o){var n,r=o.split(v),a=r.length,i=0;t:for(;n=e[i++];)if(n.params){var s=n.path.split(v);if(a===s.length){for(var u=0;u<a;u++)if(!t.string.startsWith(s[u],l)&&s[u]!==r[u])continue t;return n}}else if(n.path===o)return n}(t,e,n);if(i){var s={hash:o,path:i.path};if(i.params){var u=function(t,e,o){var n,r=o.split(v),a=e.split(v);return r.length===a.length&&t.array.each(a,function(e,o){t.string.startsWith(e,l)&&(n||(n={}),n[e.substr(l.length)]=U(t,r[o]))}),n}(t,i.path,n);u&&(s.params=u)}if(r){var c=function(t,e){var o;return t.array.each(e.split(y),function(e){var n=e.split(m),r=t.string.trim(n[0]),a=n[1];r&&(o||(o={}),a=U(t,a),t.string.endsWith(r,g)?(r=t.string.slice(r,0,-g.length),t.array.push(o[r]||(o[r]=[]),a)):o[r]=a)}),o}(t,r);c&&(s.query=c)}return s}}function $(t,e){var o=e.path,n=e.params,r=e.query,a=[];t.array.each(o.split(v),function(e){a.push(t.string.startsWith(e,l)&&n?n[e.substr(l.length)]:e)});var i=a.join(v);if(r){var s=function(t,e){var o=[],n=function(n){var r=e[n];t.is.array(r)?t.array.each(r,function(e){o.push(n+g+m+j(t,e))}):o.push(n+m+j(t,r))};for(var r in e)n(r);return o.join(y)}(t,r);s&&(i+=d+s)}return i}var W,w,q=0,P=window,E=P.location,O="$router",D="$route";function M(t,e){return W.string.startsWith(t,v)||(e?W.string.endsWith(e,v)||(e+=v):e=v,t=e+t),t!==v&&W.string.endsWith(t,v)&&(t=W.string.slice(t,0,-v.length)),t}function V(t,e){var o={hash:p,path:p};if(W.is.string(t))o.path=M(t);else{var n=t,r=n.name;o.path=r?e[r]:M(n.path),n.params&&(o.params=n.params),n.query&&(o.query=n.query)}return o}function z(t,e,o){var n={},r=o.propTypes;if(r){var a=e.query,i=t.params,s=e.params;if(i&&s){a=a?W.object.copy(a):{};for(var u=0,c=void 0;c=i[u];u++)a[c]=s[c]}if(a)for(var c in r)n[c]=W.checkProp(c,a[c],r[c])}return n}function A(t,e,o,n){var a=t[D];if(a&&(a.context=n?t:r,function(t){var e=t.child;return!e||!e.context}(a))){var i=t[O];e&&o&&i.hook(a,e,o),n&&i.loading&&(i.loading.onComplete(),i.loading=r)}}var I=function(){function t(t){var e=this,o=t.el,n=t.route404;e.el=W.is.string(o)?w.find(o):o,e.onHashChange=function(){var t=E.hash,o=e.loading,n=e.routes,a=e.route404;if(t=t!==f&&W.string.startsWith(t,f)?t.substr(f.length):v,o){if(o.location.hash===t)return void e.setRoute(o.location);e.loading=r}var i=L(W,n,t);if(i)return e.pushHistory(i),void e.setRoute(i);e.push(a)},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new h,e.add(t.routes),e.add([n]),e.route404=W.array.last(e.routes)}return t.prototype.add=function(t){var e=this,o=[],n=[],r=function(t){var a=t.name,i=t.component,s=t.children,u=W.array.last(o),c=W.array.last(n),p=M(t.path,u),h={path:p,component:i,route:t},f=[];W.array.each(p.split(v),function(t){W.string.startsWith(t,l)&&f.push(t.substr(l.length))}),f.length&&(h.params=f),c&&(h.parent=c),s?(o.push(p),n.push(h),W.array.each(s,r),n.pop(),o.pop()):(e.routes.push(h),a&&(e.name2Path[a]=p),e.path2Route[p]=h)};W.array.each(t,r)},t.prototype.push=function(t){var e=this,o=e.setLocation(V(t,e.name2Path),function(){e.pushHistory(o)},c);o&&e.setHash(o)},t.prototype.replace=function(t){var e=this,o=e.setLocation(V(t,e.name2Path),function(){e.replaceHistory(o)},c);o&&e.setRoute(o)},t.prototype.go=function(t){var e=this,o=e.cursor+t,n=e.history[o];n&&(n=e.setLocation(n,function(){e.cursor=o},c))&&e.setHash(n)},t.prototype.start=function(){w.on(P,"hashchange",this.onHashChange),this.onHashChange()},t.prototype.stop=function(){w.off(P,"hashchange",this.onHashChange)},t.prototype.hook=function(t,e,n,a,i){var s=this,u=s.location,c=s.hooks,p=s.loading;c.clear().add(t.component[e],t.context).add(t.route[n],t.route).add(s[n],s);var h=function(t){t===r?c.next(h,a,i):(p&&(p.onAbort(),s.loading=r),t===o?u&&s.push(u):s.push(t))};h()},t.prototype.pushHistory=function(t){var e=this.history,o=this.cursor;e[++o]&&(e.length=o),e[o]=t,this.cursor=o},t.prototype.replaceHistory=function(t){var e=this.history,o=this.cursor;e[o]&&(e[o]=t)},t.prototype.setHash=function(t){var e=f+t.hash;E.hash!==e?E.hash=e:this.setRoute(t)},t.prototype.setLocation=function(t,e,o){var n=$(W,t),a=this.location,i=a?$(W,a):r,s=L(W,this.routes,n);if(t=s||{hash:n=this.route404.path,path:n},n!==i)return this.loading={location:t,onComplete:e,onAbort:o},t},t.prototype.diffRoute=function(t,e,o,n,a,i){if(a&&(t.child=a,a.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(W.object.copy(t.parent),e?e.parent:r,o,n,t,e||i);else{if(n===t){var s=void 0;if(e)for(;e;)s=e.context,e=e.parent;else i&&(s=i.context);s&&(n.context=s)}o(t,n)}},t.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,a=t.context,i=t.component;if(t===e)if(n){if((a=n.context).forceUpdate(z(n,o,n.component)),a=a.$routeView){var s={},u="RouteComponent"+ ++q;s.RouteComponent=u,a.component(u,i),a.forceUpdate(s)}}else{a&&a.destroy();var c={};c[O]=this,c[D]=t,t.context=new W(W.object.extend({el:this.el,props:z(t,o,i),extensions:c},i))}else if(a&&(a.$vnode?(a[D]=t,a.forceUpdate(z(t,o,i))):t.context=r,t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t){var o=this,n=o.path2Route[t.path],r=n.route.redirect;if(r&&(W.is.func(r)&&(r=r(t)),r))o.push(r);else{var a=W.object.copy(n),i=o.route,s=o.location,u=function(){o.diffRoute(a,i,function(n,r){o.hook(a,r?"beforeRouteEnter":"beforeRouteUpdate",r?"beforeEnter":"beforeUpdate",e,function(){o.route=a,o.location=t,o.patchRoute(n,r)})})};o.hooks.setLocation(t,s),i&&s&&t.path!==s.path?o.hook(i,"beforeRouteLeave","beforeLeave",e,u):u()}},t}(),_={bind:function(t,e,o){var n=(o.context.$root||o.context)[O],r=o.data[e.key]=function(t){var o=e.value,r=e.getter,a=o;o&&r&&W.string.has(o,"{")&&(a=r()),n[e.name](a)};o.isComponent?t.on("click",r):w.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):w.off(t,"click",n)}},S={template:"<$RouteComponent/>",beforeCreate:function(t){var e=t.parent,o=e[D].child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},a="RouteComponent"+ ++q;n.RouteComponent=a,r[a]=o.component}},beforeDestroy:function(){this.$parent.$routeView=r}};t.Router=I,t.install=function(t){W=t,w=t.dom,W.directive({push:_,replace:_,go:_}),W.component("router-view",S);var o=W.beforeCreate,n=W.afterMount,r=W.afterUpdate,a=W.afterDestroy;W.beforeCreate=function(t){o&&o(t);var e=t.parent;if(e&&t.beforeCreate!==S.beforeCreate&&(e=e.$parent)){var n=e[O],r=e[D].child;if(n&&r){var a=t.extensions={};a[O]=n,a[D]=r,n.location&&(t.props=z(r,n.location,t))}}},W.afterMount=function(t){n&&n(t),A(t,R,b,e)},W.afterUpdate=function(t){r&&r(t),A(t,C,x,e)},W.afterDestroy=function(t){a&&a(t),A(t,H,k)}},t.version="1.0.0-alpha4",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
