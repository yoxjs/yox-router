!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,(function(t){"use strict";var e=window,o=e.location,n=e.history,r=function(){};function i(t,e){var o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o="true"===e||"false"!==e&&("null"===e?null:decodeURIComponent(e))),o}function a(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():null===e?"null":void 0}r.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},r.prototype.clear=function(){return this.list=[],this},r.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},r.prototype.next=function(t,e,o){var n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()};var u="pushState"in n;function s(t,e){try{n.replaceState({},"",t),e()}catch(e){o.replace(t)}}var c=Object.freeze({__proto__:null,isSupported:u,start:function(t,o){t.on(e,"popstate",o),o()},stop:function(t,o){t.off(e,"popstate",o)},push:function(t,e){n.pushState({},"",t.url),e()},replace:function(t,e){s(t.url,e)},go:function(t){n.go(t)},current:function(){return o.pathname+o.search},replaceState:s});var p=Object.freeze({__proto__:null,start:function(t,o){t.on(e,"hashchange",o),o()},stop:function(t,o){t.off(e,"hashchange",o)},push:function(t,e){o.hash="#!"+t.url},replace:function(t,e){var n=o.protocol+"//"+o.host+o.pathname+"#!"+t.url;u?s(n,e):o.replace(n)},go:function(t){n.go(t)},current:function(){var t=o.href,e=t.indexOf("#!");return e>0?t.substr(e+"#!".length):"/"}});var f,h,l=0;function d(t,e){return f.string.startsWith(t,"/")||(e?f.string.endsWith(e,"/")||(e+="/"):e="/",t=e+t),"/"!==t&&f.string.endsWith(t,"/")&&(t=f.string.slice(t,0,-"/".length)),t}function v(t,e,o){if(/\/\:\w+/.test(t)){var n=[];f.array.each(t.split("/"),(function(t){n.push(f.string.startsWith(t,":")&&e?e[t.substr(":".length)]:t)})),t=n.join("/")}if(o){var r=function(t,e){var o=[],n=function(n){var r=e[n];if(t.is.array(r))t.array.each(r,(function(e){var r=a(t,e);t.is.string(r)&&o.push(n+"[]="+r)}));else{var i=a(t,r);t.is.string(i)&&o.push(n+"="+i)}};for(var r in e)n(r);return o.join("&")}(f,o);r&&(t+="?"+r)}return t}function m(t,e,o){var n={},r=o.propTypes;if(r){var i=e.query,a=t.params,u=e.params;if(a&&u){i=i?f.object.copy(i):{};for(var s=0,c=a.length;s<c;s++)i[a[s]]=u[a[s]]}if(i)for(var p in r){var h=i[p];void 0!==h&&(n[p]=h)}}return n}function y(t,e,o,n){var r=t.$route;if(r&&(r.context=n?t:void 0,function(t){var e=t.child;return!e||!e.context}(r))){var i=t.$router;if(e&&o&&i.hook(r,e,o,!1),n){var a=i.pending;a&&(a.onComplete(),i.pending=void 0)}}}var g=function(t){var e=this,o=t.el,n=t.route404||x;e.options=t,e.el=f.is.string(o)?f.dom.find(o):o,e.mode="history"===t.mode&&u?c:p,e.handler=function(){e.parseLocation(e.mode.current(),(function(t){t?e.setRoute(t):e.push(e.route404)}))},e.routes=[],e.name2Path={},e.path2Route={},e.hooks=new r,f.array.each(t.routes,(function(t){e.add(t)})),e.route404=e.add(n)[0]};g.prototype.add=function(t,e){var o=this,n=[],r=[],i=[],a=function(t){var e=t.name,u=t.component,s=t.children,c=t.load,p=f.array.last(r),h=f.array.last(i),l=d(t.path,p),v={path:l,route:t},m=[];f.array.each(l.split("/"),(function(t){f.string.startsWith(t,":")&&m.push(t.substr(":".length))})),m.length&&(v.params=m),e&&(v.name=e),c?v.load=c:v.component=u||b,h&&(v.parent=h),s?(r.push(l),i.push(v),f.array.each(s,a),i.pop(),r.pop()):(n.push(v),o.routes.push(v),e&&(o.name2Path[e]=l),o.path2Route[l]=v)};return e&&(r.push(e.path),i.push(e)),a(t),n},g.prototype.remove=function(t){f.array.remove(this.routes,t),t.name&&delete this.name2Path[t.name],delete this.path2Route[t.path]},g.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.push(t,e.handler)}))},g.prototype.replace=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.replace(t,e.handler)}))},g.prototype.go=function(t){this.mode.go(t)},g.prototype.start=function(){this.mode.start(f.dom,this.handler)},g.prototype.stop=function(){this.mode.stop(f.dom,this.handler)},g.prototype.hook=function(t,e,o,n,r){var i=this,a=i.location,u=i.hooks,s=i.pending,c=t.context,p=function(){c&&c.fire(e+".hook",{from:u.from,to:u.to}),r&&r()},f=function(t){void 0===t?u.next(n,f,p):(s&&(s.onAbort(),i.pending=void 0),!1===t?a&&i.push(a):i.push(t))};u.clear().add(t.component[e],c).add(t.route[o],t.route).add(i.options[o],i),f()},g.prototype.toUrl=function(t){if(f.is.string(t))return d(t);var e,o=this.location,n=t,r=n.params;return n.name?e=this.name2Path[n.name]:n.path?e=d(n.path):o&&(e=o.path,r||(r=o.params)),v(e,r,n.query)},g.prototype.setUrl=function(t,e){this.parseLocation(t,(function(t){t&&e(t)}))},g.prototype.parseLocation=function(t,e){var o,n,r=t.indexOf("?");r>=0?(o=t.slice(0,r),n=t.slice(r+1)):o=t;var a=this,u=o.split("/"),s=u.length,c=function(t,e){var n,r=0;t:for(;n=t[r++];){var p=n.path;if(n.params){var h=p.split("/");if(s===h.length){for(var l={},d=0;d<s;d++)if(f.string.startsWith(h[d],":"))l[h[d].substr(":".length)]=i(f,u[d]);else if(h[d]!==u[d])continue t;return void e(n,l)}}else{if(n.load&&f.string.startsWith(o,p)){var v=function(t){a.remove(n),c(a.add(t.default||t,n.parent),e)},m=n.load(v);return void(m&&m.then(v))}if(p===o)return void e(n)}}e()};c(a.routes,(function(o,r){if(o){var a={url:t,path:o.path};if(r&&(a.params=r),n){var u=function(t,e){var o;return t.array.each(e.split("&"),(function(e){var n=e.split("="),r=t.string.trim(n[0]),a=n[1];r&&(o||(o={}),a=i(t,a),t.string.endsWith(r,"[]")?(r=t.string.slice(r,0,-"[]".length),t.array.push(o[r]||(o[r]=[]),a)):o[r]=a)})),o}(f,n);u&&(a.query=u)}e(a)}else e()}))},g.prototype.diffRoute=function(t,e,o,n,r,i){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(f.object.copy(t.parent),e?e.parent:void 0,o,n,t,e||i);else{if(n===t){var a;if(e)for(;e;)a=e.context,e=e.parent;else i&&(a=i.context);a&&(n.context=a)}o(t,n)}},g.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,r=t.context,i=t.component;if(t===e)if(n){if((r=n.context).forceUpdate(m(n,o,n.component)),r=r.$routeView){var a={},u="RouteComponent"+ ++l;a.RouteComponent=u,r.component(u,i),r.forceUpdate(a)}}else{r&&r.destroy();var s={$router:this,$route:t},c=f.object.extend({el:this.el,props:m(t,o,i),extensions:s},i);c.events=c.events?f.object.extend(c.events,h):h,t.context=new f(c)}else if(r&&(r.$vnode?(r.$route=t,r.forceUpdate(m(t,o,i))):t.context=void 0,t.child)){t=t.child;continue}break}},g.prototype.setRoute=function(t){var e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(f.is.func(n)&&(n=n(t)),n))e.push(n);else{var r=f.object.copy(o),i=e.route,a=e.location,u=function(){e.diffRoute(r,i,(function(o,n){e.hook(r,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",!0,(function(){e.route=r,e.location=t,e.patchRoute(o,n)}))}))};e.hooks.setLocation(t,a),i&&a&&t.path!==a.path?e.hook(i,"beforeRouteLeave","beforeLeave",!0,u):u()}};var x={path:"/404",component:{template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,k,$){return m("div",void 0,(function(){r('This is a default 404 page, please set "route404" for your own 404 page.')}),!0)}}},b={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,k,$){return y("router-view")}},R={bind:function(t,e,o){var n=(o.context.$root||o.context).$router,r=o.data[e.key]=function(t){var o=e.value,r=e.getter,i=o;o&&r&&f.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):f.dom.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):f.dom.off(t,"click",n)}},k={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,k,$){return y(t("RouteComponent",!0))},beforeCreate:function(t){var e=t.context,o=e.$route.child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++l;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$context.$routeView=void 0}};t.Router=g,t.install=function(t){(f=t).directive({push:R,replace:R,go:R}),f.component("router-view",k),(h={})["beforeCreate.hook"]=function(t,e){if(e){var o=e,n=o.context;if(n&&n.$options.beforeCreate===k.beforeCreate){var r=(n=n.$context).$router,i=n.$route.child;i&&(o.extensions={$router:r,$route:i},r.location&&(o.props=m(i,r.location,o)))}}},h["afterMount.hook"]=function(t){y(t.target,"afterRouteEnter","afterEnter",!0)},h["afterUpdate.hook"]=function(t){y(t.target,"afterRouteUpdate","afterUpdate",!0)},h["afterDestroy.hook"]=function(t){y(t.target,"afterRouteLeave","afterLeave")}},t.version="1.0.0-alpha.55",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=yox-router.min.js.map
