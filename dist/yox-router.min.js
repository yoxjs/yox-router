!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("yox")):"function"==typeof define&&define.amd?define(["exports","yox"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).YoxRouter={},t.Yox)}(this,(function(t,e){"use strict";var o=window,n=o.location,r=o.history,a=void 0,i=!0,u=!1,s="null",p=":",c="/",f="[]",h=function(){};function l(t){var o;return e.is.numeric(t)?o=+t:e.is.string(t)&&(o="true"===t?i:"false"===t?u:t===s?null:decodeURIComponent(t)),o}function d(t){return e.is.string(t)?encodeURIComponent(t):e.is.number(t)||e.is.boolean(t)?t.toString():null===t?s:void 0}h.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},h.prototype.clear=function(){return this.list=[],this},h.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},h.prototype.next=function(t,e,o){var n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()};var v="popstate",m="pushState"in r;function y(t,e){try{r.replaceState({},"",t),e()}catch(e){n.replace(t)}}var g=Object.freeze({__proto__:null,isSupported:m,start:function(t){e.dom.on(o,v,t),t()},stop:function(t){e.dom.off(o,v,t)},push:function(t,e){r.pushState({},"",t.url),e()},replace:function(t,e){y(t.url,e)},go:function(t){r.go(t)},current:function(){return n.pathname+n.search},replaceState:y}),x="#!",b="hashchange";var R=Object.freeze({__proto__:null,start:function(t){e.dom.on(o,b,t),t()},stop:function(t){e.dom.off(o,b,t)},push:function(t,e){n.hash=x+t.url},replace:function(t,e){var o=n.protocol+"//"+n.host+n.pathname+x+t.url;m?y(o,e):n.replace(o)},go:function(t){r.go(t)},current:function(){var t=n.href,e=t.indexOf(x);return e>0?t.substr(e+x.length):c}}),$=function(t,e,o,n,r,a,i,u,s,p,c,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,L,j,_,W,S,P,O,q,E,T,V,z,D,I,M,Y,A,B,F){F.push({context:P,isPure:!0,isStatic:!0,operator:L,tag:"div",text:'This is a default 404 page, please set "route404" for your own 404 page.',type:3})},C=function(t,e,o,n,r,a,i,u,s,p,c,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,L,j,_,W,S,P,O,q,E,T,V,z,D,I,M,Y,A,B,F){F.push({context:P,isComponent:!0,operator:j,tag:"router-view",type:4})},U=function(t,e,o,n,r,a,i,u,s,p,c,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,L,j,_,W,S,P,O,q,E,T,V,z,D,I,M,Y,A,B,F){F.push({context:P,isComponent:!0,operator:j,tag:y(Y,"RouteComponent",A.RouteComponent).value,type:4})},k=0,w="RouteComponent",L="click";function j(t,o){return e.string.startsWith(t,c)||(o?e.string.endsWith(o,c)||(o+=c):o=c,t=o+t),t!==c&&e.string.endsWith(t,c)&&(t=e.string.slice(t,0,-c.length)),t}function _(t,o,n){if(/\/\:\w+/.test(t)){var r=[];e.array.each(t.split(c),(function(t){r.push(e.string.startsWith(t,p)&&o?o[t.substr(p.length)]:t)})),t=r.join(c)}if(n){var a=function(t){var o=[],n=function(n){var r=t[n];if(e.is.array(r))e.array.each(r,(function(t){var r=d(t);e.is.string(r)&&o.push(n+f+"="+r)}));else{var a=d(r);e.is.string(a)&&o.push(n+"="+a)}};for(var r in t)n(r);return o.join("&")}(n);a&&(t+="?"+a)}return t}function W(t,o,n){var r={},i=n.propTypes;if(i){var u=o.query,s=t.params,p=o.params;if(s&&p){u=u?e.object.copy(u):{};for(var c=0,f=s.length;c<f;c++)u[s[c]]=p[s[c]]}if(u)for(var h in i){var l=u[h];l!==a&&(r[h]=l)}}return r}function S(t,e,o,n){var r=t.$route;if(r&&(r.context=n?t:a,function(t){var e=t.child;return!e||!e.context}(r))){var i=t.$router;if(e&&o&&i.hook(r,e,o,u),n){var s=i.pending;s&&(s.onComplete(),i.pending=a)}}}var P=function(t){var o=this,n=t.el,r=t.route404||O;o.options=t,o.el=e.is.string(n)?e.dom.find(n):n,o.mode="history"===t.mode&&m?g:R,o.handler=function(){o.parseLocation(o.mode.current(),(function(t){t?o.setRoute(t):o.push(o.route404)}))},o.routes=[],o.name2Path={},o.path2Route={},o.hooks=new h,e.array.each(t.routes,(function(t){o.add(t)})),o.route404=o.add(r)[0]};P.prototype.add=function(t,o){var n=this,r=[],a=[],i=[],u=function(t){var o=t.name,s=t.component,f=t.children,h=t.load,l=e.array.last(a),d=e.array.last(i),v=j(t.path,l),m={path:v,route:t},y=[];e.array.each(v.split(c),(function(t){e.string.startsWith(t,p)&&y.push(t.substr(p.length))})),y.length&&(m.params=y),o&&(m.name=o),h?m.load=h:m.component=s||q,d&&(m.parent=d),f?(a.push(v),i.push(m),e.array.each(f,u),i.pop(),a.pop()):(r.push(m),n.routes.push(m),o&&(n.name2Path[o]=v),n.path2Route[v]=m)};return o&&(a.push(o.path),i.push(o)),u(t),r},P.prototype.remove=function(t){var o=this;e.array.remove(o.routes,t),t.name&&delete o.name2Path[t.name],delete o.path2Route[t.path]},P.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.push(t,e.handler)}))},P.prototype.replace=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.replace(t,e.handler)}))},P.prototype.go=function(t){this.mode.go(t)},P.prototype.start=function(){this.mode.start(this.handler)},P.prototype.stop=function(){this.mode.stop(this.handler)},P.prototype.hook=function(t,o,n,r,i){var s=this,p=s.location,c=s.hooks,f=s.pending,h=t.context,l=function(){h&&e.lifeCycle.fire(h,o,{from:c.from,to:c.to}),i&&i()},d=function(t){t===a?c.next(r,d,l):(f&&(f.onAbort(),s.pending=a),t===u?p&&s.push(p):s.push(t))};c.clear().add(t.component[o],h).add(t.route[n],t.route).add(s.options[n],s),d()},P.prototype.toUrl=function(t){if(e.is.string(t))return j(t);var o,n=this.location,r=t,a=r.params;return r.name?o=this.name2Path[r.name]:r.path?o=j(r.path):n&&(o=n.path,a||(a=n.params)),_(o,a,r.query)},P.prototype.setUrl=function(t,e){this.parseLocation(t,(function(t){t&&e(t)}))},P.prototype.parseLocation=function(t,o){var n,r,a=t.indexOf("?");a>=0?(n=t.slice(0,a),r=t.slice(a+1)):n=t;var s=this,h=s.options,d=s.routes,v=s.location,m=n.split(c),y=m.length,g=function(o,n){var a={url:t,path:o.path};if(n&&(a.params=n),r){var i=function(t){var o;return e.array.each(t.split("&"),(function(t){var n=t.split("="),r=e.string.trim(n[0]),a=n[1];r&&(o||(o={}),a=l(a),e.string.endsWith(r,f)?(r=e.string.slice(r,0,-f.length),e.array.push(o[r]||(o[r]=[]),a)):o[r]=a)})),o}(r);i&&(a.query=i)}return a},x=function(t,o){var r=t.path;if(t.params){var a=r.split(c);if(y===a.length){for(var f={},d=0;d<y;d++)if(e.string.startsWith(a[d],p))f[a[d].substr(p.length)]=l(m[d]);else if(a[d]!==m[d])return;return o(g(t,f))}}else{if(t.load&&e.string.startsWith(n,r)){if(t.loading)return i;var x=h.beforeLoad,R=h.afterLoad,$=function(r){s.remove(t);var a=r.default||r;e.is.func(a)&&(a=a());var i=s.add(a,t.parent);t.loading=u,v===s.location?b(i,(function(t){return R&&R.call(s,n,t),o(t)})):R&&R.call(s,n)};t.loading=i,x&&x.call(s,n);var C=t.load($);return C&&C.then($),i}if(r===n)return o(g(t))}},b=function(t,e){for(var o=0,n=t.length;o<n;o++)if(x(t[o],e))return;e()};b(d,(function(t){return o(t),i}))},P.prototype.diffRoute=function(t,o,n,r,i,u){if(i&&(t.child=i,i.parent=t),o?o.component!==t.component?r=t:t.context=o.context:r=t,t.parent)this.diffRoute(e.object.copy(t.parent),o?o.parent:a,n,r,t,o||u);else{if(r===t){var s;if(o)for(;o;)s=o.context,o=o.parent;else u&&(s=u.context);s&&(r.context=s)}n(t,r)}},P.prototype.patchRoute=function(t,o){for(var n=this,r=n.location;t;){var i=t.parent,u=t.context,s=t.component;if(t===o)if(i){if((u=i.context).forceUpdate(W(i,r,i.component)),u=u.$routeView){var p={},c=w+ ++k;p.RouteComponent=c,u.component(c,s),u.forceUpdate(p)}}else u&&u.destroy(),t.context=new e(e.object.extend({el:n.el,props:W(t,r,s),extensions:{$router:n,$route:t}},s));else if(u&&(u.$vnode?(u.$route=t,u.forceUpdate(W(t,r,s))):t.context=a,t.child)){t=t.child;continue}break}},P.prototype.setRoute=function(t){var o=this,n=o.path2Route[t.path],r=n.route.redirect;if(r&&(e.is.func(r)&&(r=r(t)),r))o.push(r);else{var a=e.object.copy(n),u=o.route,s=o.location,p=function(){o.diffRoute(a,u,(function(e,n){o.hook(a,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",i,(function(){o.route=a,o.location=t,o.patchRoute(e,n)}))}))};o.hooks.setLocation(t,s),u&&s&&t.path!==s.path?o.hook(u,"beforeRouteLeave","beforeLeave",i,p):p()}};var O={path:"/404",component:{template:$}},q={template:C},E={bind:function(t,o,n){var r=(n.context.$root||n.context).$router,a=n.data[o.key]=function(t){var n=o.value,a=o.getter,i=n;n&&a&&e.string.has(n,"{")&&(i=a()),r[o.name](i)};n.isComponent?t.on(L,a):e.dom.on(t,L,a)},unbind:function(t,o,n){var r=n.data[o.key];n.isComponent?t.off(L,r):e.dom.off(t,L,r)}},T={template:U,beforeCreate:function(t){var e=t.context,o=e.$route.child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},a=w+ ++k;n.RouteComponent=a,r[a]=o.component}},beforeDestroy:function(){this.$context.$routeView=a}};e.lifeCycle.on("beforeCreate",(function(t,e){var o=e.options,n=o.context;if(n&&n.$options.beforeCreate===T.beforeCreate){var r=(n=n.$context).$router,a=n.$route.child;a&&(o.extensions={$router:r,$route:a},r.location&&(o.props=W(a,r.location,o)))}})).on("afterMount",(function(t){S(t,"afterRouteEnter","afterEnter",i)})).on("afterUpdate",(function(t){S(t,"afterRouteUpdate","afterUpdate",i)})).on("afterDestroy",(function(t){S(t,"afterRouteLeave","afterLeave")}));t.Router=P,t.install=function(t){t.directive({push:E,replace:E,go:E}),t.component("router-view",T)},t.version="1.0.0-alpha.152",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=yox-router.min.js.map
