!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e=window,o=e.location,n=e.history,r=void 0,i=null,a=!0,u=!1,s="null",c="true",p="false",f=":",h="/",l="?",d="&",v="=",m="[]",y="afterEnter",g="afterUpdate",x="afterLeave",b="afterRouteEnter",R="afterRouteUpdate",$="afterRouteLeave",U=function(){};function k(t,e){var o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===c?a:e===p?u:e===s?i:decodeURIComponent(e)),o}function C(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===i?s:void 0}U.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},U.prototype.clear=function(){return this.list=[],this},U.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},U.prototype.next=function(t,e,o){var n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()};var j="popstate",w="pushState"in n;function L(t,e){try{n.replaceState({},"",t),e()}catch(e){o.replace(t)}}var W=Object.freeze({isSupported:w,start:function(t,o){t.on(e,j,o),o()},stop:function(t,o){t.off(e,j,o)},push:function(t,e){n.pushState({},"",t.url),e()},replace:function(t,e){L(t.url,e)},go:function(t){n.go(t)},current:function(){return o.pathname+o.search},replaceState:L}),S="#!",O="hashchange";var P=Object.freeze({start:function(t,o){t.on(e,O,o),o()},stop:function(t,o){t.off(e,O,o)},push:function(t,e){o.hash=S+t.url},replace:function(t,e){var n=o.protocol+"//"+o.host+o.pathname+S+t.url;w?L(n,e):o.replace(n)},go:function(t){n.go(t)},current:function(){var t=o.href,e=t.indexOf(S);return e>0?t.substr(e+S.length):h}});var E,q,V=0,z=".hook";function D(t,e){return E.string.startsWith(t,h)||(e?E.string.endsWith(e,h)||(e+=h):e=h,t=e+t),t!==h&&E.string.endsWith(t,h)&&(t=E.string.slice(t,0,-h.length)),t}function I(t,e,o){if(/\/\:\w+/.test(t)){var n=[];E.array.each(t.split(h),function(t){n.push(E.string.startsWith(t,f)&&e?e[t.substr(f.length)]:t)}),t=n.join(h)}if(o){var r=function(t,e){var o=[],n=function(n){var r=e[n];if(t.is.array(r))t.array.each(r,function(e){var r=C(t,e);t.is.string(r)&&o.push(n+m+v+r)});else{var i=C(t,r);t.is.string(i)&&o.push(n+v+i)}};for(var r in e)n(r);return o.join(d)}(E,o);r&&(t+=l+r)}return t}function M(t,e,o){var n={},i=o.propTypes;if(i){var a=e.query,u=t.params,s=e.params;if(u&&s){a=a?E.object.copy(a):{};for(var c=0,p=u.length;c<p;c++)a[u[c]]=s[u[c]]}if(a)for(var f in i){var h=a[f];h!==r&&(n[f]=h)}}return n}function T(t,e,o,n){var i=t.$route;if(i&&(i.context=n?t:r,function(t){var e=t.child;return!e||!e.context}(i))){var a=t.$router;if(e&&o&&a.hook(i,e,o,u),n){var s=a.pending;s&&(s.onComplete(),a.pending=r)}}}var _=function(t){var e=this,o=t.el,n=t.route404||A;e.options=t,e.el=E.is.string(o)?E.dom.find(o):o,e.mode="history"===t.mode&&w?W:P,e.handler=function(){e.parseLocation(e.mode.current(),function(t){t?e.setRoute(t):e.push(e.route404)})},e.routes=[],e.name2Path={},e.path2Route={},e.hooks=new U,E.array.each(t.routes,function(t){e.add(t)}),e.route404=e.add(n)[0]};_.prototype.add=function(t,e){var o=this,n=[],r=[],i=[],a=function(t){var e=t.name,u=t.component,s=t.children,c=t.load,p=E.array.last(r),l=E.array.last(i),d=D(t.path,p),v={path:d,route:t},m=[];E.array.each(d.split(h),function(t){E.string.startsWith(t,f)&&m.push(t.substr(f.length))}),m.length&&(v.params=m),e&&(v.name=e),c?v.load=c:v.component=u||Y,l&&(v.parent=l),s?(r.push(d),i.push(v),E.array.each(s,a),i.pop(),r.pop()):(n.push(v),o.routes.push(v),e&&(o.name2Path[e]=d),o.path2Route[d]=v)};return e&&(r.push(e.path),i.push(e)),a(t),n},_.prototype.remove=function(t){E.array.remove(this.routes,t),t.name&&delete this.name2Path[t.name],delete this.path2Route[t.path]},_.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),function(t){o.current()!==t.url&&o.push(t,e.handler)})},_.prototype.replace=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),function(t){o.current()!==t.url&&o.replace(t,e.handler)})},_.prototype.go=function(t){this.mode.go(t)},_.prototype.start=function(){this.mode.start(E.dom,this.handler)},_.prototype.stop=function(){this.mode.stop(E.dom,this.handler)},_.prototype.hook=function(t,e,o,n,i){var a=this,s=a.location,c=a.hooks,p=a.pending,f=t.context,h=function(){f&&f.fire(e+z,{from:c.from,to:c.to}),i&&i()},l=function(t){t===r?c.next(n,l,h):(p&&(p.onAbort(),a.pending=r),t===u?s&&a.push(s):a.push(t))};c.clear().add(t.component[e],f).add(t.route[o],t.route).add(a.options[o],a),l()},_.prototype.toUrl=function(t){if(E.is.string(t))return D(t);var e,o=this.location,n=t,r=n.params;return n.name?e=this.name2Path[n.name]:n.path?e=D(n.path):o&&(e=o.path,r||(r=o.params)),I(e,r,n.query)},_.prototype.setUrl=function(t,e){this.parseLocation(t,function(t){t&&e(t)})},_.prototype.parseLocation=function(t,e){var o,n,r=t.indexOf(l);r>=0?(o=t.slice(0,r),n=t.slice(r+1)):o=t;var i=this,a=o.split(h),u=a.length,s=function(t,e){var n,r=0;t:for(;n=t[r++];){var c=n.path;if(n.params){var p=c.split(h);if(u===p.length){for(var l={},d=0;d<u;d++)if(E.string.startsWith(p[d],f))l[p[d].substr(f.length)]=k(E,a[d]);else if(p[d]!==a[d])continue t;return void e(n,l)}}else{if(n.load&&E.string.startsWith(o,c)){var v=function(t){i.remove(n),s(i.add(t.default||t,n.parent),e)},m=n.load(v);return void(m&&m.then(v))}if(c===o)return void e(n)}}e()};s(i.routes,function(o,r){if(o){var i={url:t,path:o.path};if(r&&(i.params=r),n){var a=function(t,e){var o;return t.array.each(e.split(d),function(e){var n=e.split(v),r=t.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=k(t,i),t.string.endsWith(r,m)?(r=t.string.slice(r,0,-m.length),t.array.push(o[r]||(o[r]=[]),i)):o[r]=i)}),o}(E,n);a&&(i.query=a)}e(i)}else e()})},_.prototype.diffRoute=function(t,e,o,n,i,a){if(i&&(t.child=i,i.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(E.object.copy(t.parent),e?e.parent:r,o,n,t,e||a);else{if(n===t){var u;if(e)for(;e;)u=e.context,e=e.parent;else a&&(u=a.context);u&&(n.context=u)}o(t,n)}},_.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,i=t.context,a=t.component;if(t===e)if(n){if((i=n.context).forceUpdate(M(n,o,n.component)),i=i.$routeView){var u={},s="RouteComponent"+ ++V;u.RouteComponent=s,i.component(s,a),i.forceUpdate(u)}}else{i&&i.destroy();var c={$router:this,$route:t},p=E.object.extend({el:this.el,props:M(t,o,a),extensions:c},a);p.events=p.events?E.object.extend(p.events,q):q,t.context=new E(p)}else if(i&&(i.$vnode?(i.$route=t,i.forceUpdate(M(t,o,a))):t.context=r,t.child)){t=t.child;continue}break}},_.prototype.setRoute=function(t){var e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(E.is.func(n)&&(n=n(t)),n))e.push(n);else{var r=E.object.copy(o),i=e.route,u=e.location,s=function(){e.diffRoute(r,i,function(o,n){e.hook(r,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",a,function(){e.route=r,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,u),i&&u&&t.path!==u.path?e.hook(i,"beforeRouteLeave","beforeLeave",a,s):s()}};var A={path:"/404",component:{template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,U){return m("div",void 0,function(){r('This is a default 404 page, please set "route404" for your own 404 page.')},!0)}}},Y={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,U){return y("router-view")}},B={bind:function(t,e,o){var n=(o.context.$root||o.context).$router,r=o.data[e.key]=function(t){var o=e.value,r=e.getter,i=o;o&&r&&E.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):E.dom.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):E.dom.off(t,"click",n)}},F={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,U){var k=void 0;return y(k,k,k,k,k,"RouteComponent")},beforeCreate:function(t){var e=t.context,o=e.$route.child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++V;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$context.$routeView=r}};t.Router=_,t.install=function(t){(E=t).directive({push:B,replace:B,go:B}),E.component("router-view",F),(q={})["beforeCreate"+z]=function(t,e){if(e){var o=e,n=o.context;if(n&&n.$options.beforeCreate===F.beforeCreate){var r=(n=n.$context).$router,i=n.$route.child;i&&(o.extensions={$router:r,$route:i},r.location&&(o.props=M(i,r.location,o)))}}},q["afterMount"+z]=function(t){T(t.target,b,y,a)},q["afterUpdate"+z]=function(t){T(t.target,R,g,a)},q["afterDestroy"+z]=function(t){T(t.target,$,x)}},t.version="1.0.0-alpha.52",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
