!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).YoxRouter={})}(this,function(t){"use strict";var n,e,o,r=void 0,i="#!",s=":",a="/",u="&",h="=",c="[]",p="",f="*";function l(t){var e;return n.is.numeric(t)?e=+t:n.is.string(t)&&(e="true"===t||"false"!==t&&("null"===t?null:"undefined"===t?r:decodeURIComponent(t))),e}function m(t,e){var o=[t];return n.is.string(e)?o.push(encodeURIComponent(e)):n.is.number(e)||n.is.boolean(e)?o.push(e.toString()):null===e?o.push("null"):e===r&&o.push("undefined"),o.join(h)}function g(t,e){var o,r,i=e.indexOf("?");i>=0?(o=e.substring(0,i),r=e.substring(i+1)):o=e;var p={realpath:o},f=function(t,e){var o,r=e.split(a),i=r.length;return n.array.each(t,function(t){var e=t.path.split(a);if(i===e.length){for(var u=0;u<i;u++)if(!n.string.startsWith(e[u],s)&&e[u]!==r[u])return;return o=t,!1}}),o}(t,o);if(f){p.route=f;var m=function(t,e){var o,r=t.split(a),i=e.split(a);return r.length===i.length&&n.array.each(i,function(t,e){n.string.startsWith(t,s)&&(o||(o={}),o[t.substr(s.length)]=l(r[e]))}),o}(o,f.path);if(m&&(p.params=m),r){var g=function(t){var e;return n.array.each(t.split(u),function(t){var o=t.split(h),r=n.string.trim(o[0]),i=o[1];r&&(e||(e={}),i=l(i),n.string.endsWith(r,c)?(r=n.string.slice(r,0,-c.length),n.array.push(e[r]||(e[r]=[]),i)):e[r]=i)}),e}(r);g&&(p.query=g)}}return p}function v(t,e,o){var r,h=[],p="";if(n.array.each(t.split(a),function(t){h.push(n.string.startsWith(t,s)?e[t.substr(s.length)]:t)}),r=h.join(a),o){var f=function(t){var e=[];return n.object.each(t,function(t,o){n.is.array(t)?n.array.each(t,function(t){e.push(m(o+c,t))}):e.push(m(o,t))}),e.join(u)}(o);f&&(p="?"+f)}return i+r+p}var d=function(){function t(t){this.name=t,this.list=[]}return t.prototype.append=function(t,e){var o=this.name,r=this.list;return t&&n.is.func(t[o])&&r.push({fn:t[o],ctx:e}),this},t.prototype.run=function(t,n,e,o){var r=this.list,i=function(s){if(null==s){var a=r.shift();a?a.fn.call(a.ctx,t,n,i):e&&e()}else o&&o(s)};i()},t}(),y=function(){function t(t){var e,o,r=this;r.routes=t.routes,r.name2Path={},r.onHashChange=function(){var e=location.hash;e=n.string.startsWith(e,i)?e.substr(i.length):"";var o=g(t.routes,e),s=o.route||(e?r.route404:r.routeDefault);r.setRoute({component:s.component,path:s.path,params:o.params,query:o.query},s)},n.array.each(t.routes,function(t){t.name&&(r.name2Path[t.name]=t.path),t.path===f?e=t:t.path===p&&(o=t)}),r.route404=e,r.routeDefault=o}return t.prototype.go=function(t){if(n.is.string(t))location.hash=v(t);else if(n.is.object(t))if(n.object.has(t,"component")){var e=t,o=e.component,r=e.props;this.setRoute({component:o,props:r})}else if(n.object.has(t,"name")){var i=t,s=i.name,a=i.params,u=i.query,h=this.name2Path[s];location.hash=v(h,a,u)}},t.prototype.setRoute=function(t,o){var i=this,s=i.currentRoute,a=t.params,u=t.query,h=t.component,c=t.props,p=i.currentComponent||(i.currentComponent={name:h}),f=function(t){!1===t?s&&n.is.string(s.path)&&(location.hash=v(s.path,s.params,s.query)):i.go(t)},l=function(n,e,r){new d(n).append(p.options,p.root).append(o,o).append(i,i).run(t,s,e,r)},m=function(e){p.options=e,l("beforeEnter",function(){(a||u)&&(c={},a&&n.object.extend(c,a),u&&n.object.extend(c,u)),p.root=new n(n.object.extend({el:i.el,props:c,extensions:{$router:i,$route:t}},e)),i.currentRoute=t,l("afterEnter")},f)},g=function(t){l("beforeLeave",function(){p.root&&(p.root.destroy(),p.root=r),l("afterLeave"),m(t)},f)};p.name!==h&&(p.name=h),e.component(h,function(t){h===p.name&&(p.root?p.options===t?l("refreshing",function(){g(t)},f):g(t):m(t))})},t.prototype.start=function(t){if(n.is.string(t)){var e=o.find(t);e&&(this.el=e)}else this.el=t;o.on(window,"hashchange",this.onHashChange),this.onHashChange()},t.prototype.stop=function(){this.el=r,o.off(window,"hashchange",this.onHashChange)},t}();t.Router=y,t.install=function(t){n=t,e=new t,o=t.dom},t.register=function(t,n){e.component(t,n)},t.version="0.30.0",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
