!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e=window,o=e.location,n=e.history,r=":",i="/",a="?",s="&",u="=",c="[]",p="afterEnter",f="afterUpdate",h="afterLeave",l="afterRouteEnter",d="afterRouteUpdate",v="afterRouteLeave",m=!0,y=!1,g=null,b=void 0,x="true",R="false",k="null",C=function(){},U=(Object.freeze({}),Object.freeze([]),function(){function t(){}return t.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},t.prototype.clear=function(){return this.list=[],this},t.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},t.prototype.next=function(t,e,o){var n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()},t}());function j(t,e){var o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===x?m:e===R?y:e===k?g:decodeURIComponent(e)),o}function $(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===g?k:void 0}var w="#!",L="hashchange";var W=Object.freeze({start:function(t,o){t.on(e,L,o),o()},stop:function(t,o){t.off(e,L,o)},push:function(t,e){o.hash=w+t.url},go:function(t){n.go(t)},current:function(){var t=o.href,e=t.indexOf(w);return e>0?t.substr(e+w.length):i}}),O="popstate",H="pushState"in n;var P,q,z=Object.freeze({isSupported:H,start:function(t,o){t.on(e,O,o),o()},stop:function(t,o){t.off(e,O,o)},push:function(t,e){n.pushState({},"",t.url),e()},go:function(t){n.go(t)},current:function(){return o.pathname+o.search}}),E=0,S="$router",V="$route";function A(t,e){return P.string.startsWith(t,i)||(e?P.string.endsWith(e,i)||(e+=i):e=i,t=e+t),t!==i&&P.string.endsWith(t,i)&&(t=P.string.slice(t,0,-i.length)),t}function D(t,e,o){if(/\/\:\w+/.test(t)){var n=[];P.array.each(t.split(i),function(t){n.push(P.string.startsWith(t,r)&&e?e[t.substr(r.length)]:t)}),t=n.join(i)}if(o){var p=function(t,e){var o=[],n=function(n){var r=e[n];if(t.is.array(r))t.array.each(r,function(e){var r=$(t,e);t.is.string(r)&&o.push(n+c+u+r)});else{var i=$(t,r);t.is.string(i)&&o.push(n+u+i)}};for(var r in e)n(r);return o.join(s)}(P,o);p&&(t+=a+p)}return t}function I(t,e){if(P.is.string(t))return A(t);var o=t,n=o.name;return D(n?e[n]:A(o.path),o.params,o.query)}function M(t,e,o){var n={},r=o.propTypes;if(r){var i=e.query,a=t.params,s=e.params;if(a&&s){i=i?P.object.copy(i):{};for(var u=0,c=a.length;u<c;u++)i[a[u]]=s[a[u]]}if(i)for(var p in r){var f=i[p];f!==b&&(n[p]=f)}}return n}function T(t,e,o,n){var r=t[V];if(r&&(r.context=n?t:b,function(t){var e=t.child;return!e||!e.context}(r))){var i=t[S];if(e&&o&&i.hook(r,e,o),n){var a=i.pending;a&&(a.onComplete(),i.pending=b)}}}var _=function(){function t(t){var e=this,o=t.el,n=t.route404||Y;e.options=t,e.el=P.is.string(o)?P.dom.find(o):o,e.mode="history"===t.mode&&H?z:W,e.handler=function(){var t=e.mode.current(),o=e.pending;if(o){var n=o.location;if(n.url===t)return e.setHistory(n,o.cursor),void e.setRoute(n);e.pending=b}e.parseLocation(t,function(t){t?(e.setHistory(t),e.setRoute(t)):e.push(e.route404)})},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new U,P.array.each(t.routes,function(t){e.add(t)}),e.route404=e.add(n)[0]}return t.prototype.add=function(t){var e=this,o=[],n=[],a=[],s=function(t){var u=t.name,c=t.component,p=t.children,f=t.load,h=P.array.last(n),l=P.array.last(a),d=A(t.path,h),v={path:d,route:t},m=[];P.array.each(d.split(i),function(t){P.string.startsWith(t,r)&&m.push(t.substr(r.length))}),m.length&&(v.params=m),u&&(v.name=u),c?v.component=c:f&&(v.load=f),l&&(v.parent=l),p?(n.push(d),a.push(v),P.array.each(p,s),a.pop(),n.pop()):(o.push(v),e.routes.push(v),u&&(e.name2Path[u]=d),e.path2Route[d]=v)};return s(t),o},t.prototype.remove=function(t){P.array.remove(this.routes,t),t.name&&delete this.name2Path[t.name],delete this.path2Route[t.path]},t.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(I(t,e.name2Path),C,C,function(t,n){e.pending=n,o.current()!==t.url?o.push(t,e.handler):e.setRoute(t)})},t.prototype.replace=function(t){var e=this;e.setUrl(I(t,e.name2Path),function(){e.replaceHistory(e.location)},C,function(t,o){e.pending=o,e.setRoute(t)})},t.prototype.go=function(t){var e=this,o=e.mode,n=e.cursor+t,r=e.history[n];r&&e.setUrl(D(r.path,r.params,r.query),C,C,function(r,i){i.cursor=n,e.pending=i,o.current()!==r.url?o.go(t):(e.setHistory(r,n),e.setRoute(r))})},t.prototype.start=function(){this.mode.start(P.dom,this.handler)},t.prototype.stop=function(){this.mode.stop(P.dom,this.handler)},t.prototype.hook=function(t,e,o,n,r){var i=this,a=i.location,s=i.hooks,u=i.pending;s.clear().add(t.component[e],t.context).add(t.route[o],t.route).add(i.options[o],i);var c=function(t){t===b?s.next(c,n,r):(u&&(u.onAbort(),i.pending=b),t===y?a&&i.push(a):i.push(t))};c()},t.prototype.setHistory=function(t,e){var o=this.history,n=this.cursor;P.is.number(e)||o[e=n+1]&&(o.length=e),o[e]=t,this.cursor=e},t.prototype.replaceHistory=function(t){var e=this.history,o=this.cursor;e[o]&&(e[o]=t)},t.prototype.setUrl=function(t,e,o,n){this.parseLocation(t,function(t){t&&n(t,{location:t,onComplete:e,onAbort:o})})},t.prototype.parseLocation=function(t,e){var o,n,p=t.indexOf(a);p>=0?(o=t.slice(0,p),n=t.slice(p+1)):o=t;var f=this,h=o.split(i),l=h.length,d=function(t,e){var n,a=0;t:for(;n=t[a++];){var s=n.path;if(n.params){var u=s.split(i);if(l===u.length){for(var c={},p=0;p<l;p++)if(P.string.startsWith(u[p],r))c[u[p].substr(r.length)]=j(P,h[p]);else if(u[p]!==h[p])continue t;return void e(n,c)}}else{if(n.load&&P.string.startsWith(o,s)){var v=function(t){f.remove(n),d(f.add(t.default||t),e)},m=n.load(v);return void(m&&m.then(v))}if(s===o)return void e(n)}}e()};d(f.routes,function(o,r){if(o){var i={url:t,path:o.path};if(r&&(i.params=r),n){var a=function(t,e){var o;return t.array.each(e.split(s),function(e){var n=e.split(u),r=t.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=j(t,i),t.string.endsWith(r,c)?(r=t.string.slice(r,0,-c.length),t.array.push(o[r]||(o[r]=[]),i)):o[r]=i)}),o}(P,n);a&&(i.query=a)}e(i)}else e()})},t.prototype.diffRoute=function(t,e,o,n,r,i){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(P.object.copy(t.parent),e?e.parent:b,o,n,t,e||i);else{if(n===t){var a=void 0;if(e)for(;e;)a=e.context,e=e.parent;else i&&(a=i.context);a&&(n.context=a)}o(t,n)}},t.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,r=t.context,i=t.component;if(t===e)if(n){if((r=n.context).forceUpdate(M(n,o,n.component)),r=r.$routeView){var a={},s="RouteComponent"+ ++E;a.RouteComponent=s,r.component(s,i),r.forceUpdate(a)}}else{r&&r.destroy();var u={};u[S]=this,u[V]=t;var c=P.object.extend({el:this.el,props:M(t,o,i),extensions:u},i);c.events=c.events?P.object.extend(c.events,q):q,t.context=new P(c)}else if(r&&(r.$vnode?(r[V]=t,r.forceUpdate(M(t,o,i))):t.context=b,t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t){var e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(P.is.func(n)&&(n=n(t)),n))e.push(n);else{var r=P.object.copy(o),i=e.route,a=e.location,s=function(){e.diffRoute(r,i,function(o,n){e.hook(r,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",m,function(){e.route=r,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,a),i&&a&&t.path!==a.path?e.hook(i,"beforeRouteLeave","beforeLeave",m,s):s()}},t}(),Y={path:"/404",component:{template:'<div>This is a default 404 page, please set "route404" for your own 404 page.</div>'}},B={bind:function(t,e,o){var n=(o.context.$root||o.context)[S],r=o.data[e.key]=function(t){var o=e.value,r=e.getter,i=o;o&&r&&P.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):P.dom.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):P.dom.off(t,"click",n)}},F={template:"<$RouteComponent/>",beforeCreate:function(t){var e=t.context,o=e[V].child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++E;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$context.$routeView=b}};t.Router=_,t.install=function(t){P=t,t.directive({push:B,replace:B,go:B}),t.component("router-view",F),q={"beforeCreate.hook":function(t,e){if(e){var o=e,n=o.context;if(n&&n.$options.beforeCreate===F.beforeCreate){var r=(n=n.$context)[S],i=n[V].child;if(i){var a=o.extensions={};a[S]=r,a[V]=i,r.location&&(o.props=M(i,r.location,o))}}}},"afterMount.hook":function(t){T(t.target,l,p,m)},"afterUpdate.hook":function(t){T(t.target,d,f,m)},"afterDestroy.hook":function(t){T(t.target,v,h)}}},t.version="1.0.0-alpha26",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
