!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e="afterRouteEnter",o="afterRouteUpdate",n="afterRouteLeave",r=!0,i=!1,a=null,s=void 0,u="true",c="false",p="null",f="undefined",h=function(){},l=(Object.freeze({}),Object.freeze([]),""),d=function(){function t(){}return t.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},t.prototype.clear=function(){return this.list=[],this},t.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},t.prototype.next=function(t,e,o){var n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()},t}(),v="/",y="&",m="=",g="[]",b="afterEnter",R="afterUpdate",x="afterLeave";function C(t,e){var o;return t.is.numeric(e)?o=+e:t.is.string(e)&&(o=e===u?r:e===c?i:e===p?a:e===f?s:decodeURIComponent(e)),o}function L(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===a?p:f}var k=window,U=k.location,j="#!",$="hashchange";var w,H,W=0,P="$router",q="$route";function O(t,e){return w.string.startsWith(t,v)||(e?w.string.endsWith(e,v)||(e+=v):e=v,t=e+t),t!==v&&w.string.endsWith(t,v)&&(t=w.string.slice(t,0,-v.length)),t}function E(t,e){var o={path:l};if(w.is.string(t))o.path=O(t);else{var n=t,r=n.name;o.path=r?e[r]:O(n.path),n.params&&(o.params=n.params),n.query&&(o.query=n.query)}return o}function D(t,e,o){var n={},r=o.propTypes;if(r){var i=e.query,a=t.params,s=e.params;if(a&&s){i=i?w.object.copy(i):{};for(var u=0,c=a.length;u<c;u++)i[a[u]]=s[a[u]]}if(i)for(var p in r)n[p]=w.checkProp(p,i[p],r[p])}return n}function M(t,e,o,n,r){e&&e(t);var i=t[q];if(i&&(i.context=r?t:s,function(t){var e=t.child;return!e||!e.context}(i))){var a=t[P];if(o&&n&&a.hook(i,o,n),r){var u=a.pending;u&&(u.onComplete(),a.pending=s)}}}var V=function(){function t(t){var e,o=this,n=t.el,r=t.route404;o.el=w.is.string(n)?H.find(n):n,o.handler=(e=function(t){var e=o.pending;if(e){var n=e.location;if(n.url===t)return o.setHistory(n,e.cursor),void o.setRoute(n);o.pending=s}o.parseLocation(t,function(t){t?(o.setHistory(t),o.setRoute(t)):o.push(o.route404)})},function(){var t=U.href,o=t.indexOf(j),n=v;o>0&&(n=t.substr(o+j.length)),e(n)}),o.routes=[],o.name2Path={},o.path2Route={},o.history=[],o.cursor=-1,o.hooks=new d,w.array.each(t.routes,function(t){o.add(t)}),o.route404=o.add(r)[0]}return t.prototype.add=function(t){var e=this,o=[],n=[],r=[],i=function(t){var a=t.name,s=t.component,u=t.children,c=t.load,p=w.array.last(n),f=w.array.last(r),h=O(t.path,p),l={path:h,route:t},d=[];w.array.each(h.split(v),function(t){w.string.startsWith(t,":")&&d.push(t.substr(":".length))}),d.length&&(l.params=d),a&&(l.name=a),s?l.component=s:c&&(l.load=c),f&&(l.parent=f),u?(n.push(h),r.push(l),w.array.each(u,i),r.pop(),n.pop()):(o.push(l),e.routes.push(l),a&&(e.name2Path[a]=h),e.path2Route[h]=l)};return i(t),o},t.prototype.remove=function(t){w.array.remove(this.routes,t),t.name&&delete this.name2Path[t.name],delete this.path2Route[t.path]},t.prototype.push=function(t){var e=this;e.setLocation(E(t,e.name2Path),s,h,h,function(t){e.setHash(t)})},t.prototype.replace=function(t){var e=this;e.setLocation(E(t,e.name2Path),s,function(){e.replaceHistory(e.location)},h,function(t){e.setRoute(t)})},t.prototype.go=function(t){var e=this,o=e.cursor+t,n=e.history[o];n&&e.setLocation(n,o,h,h,function(t){e.setHash(t)})},t.prototype.start=function(){!function(t,e){t.on(k,$,e),e()}(H,this.handler)},t.prototype.stop=function(){!function(t,e){t.off(k,$,e)}(H,this.handler)},t.prototype.hook=function(t,e,o,n,r){var a=this,u=a.location,c=a.hooks,p=a.pending;c.clear().add(t.component[e],t.context).add(t.route[o],t.route).add(a[o],a);var f=function(t){t===s?c.next(f,n,r):(p&&(p.onAbort(),a.pending=s),t===i?u&&a.push(u):a.push(t))};f()},t.prototype.setHistory=function(t,e){var o=this.history,n=this.cursor;w.is.number(e)||o[e=n+1]&&(o.length=e),o[e]=t,this.cursor=e},t.prototype.replaceHistory=function(t){var e=this.history,o=this.cursor;e[o]&&(e[o]=t)},t.prototype.setHash=function(t){(function(t){var e=j+t.url;if(U.hash!==e)return U.hash=e,r})(t)||this.setRoute(t)},t.prototype.setLocation=function(t,e,o,n,r){var i=this,a=i.stringifyLocation(t),u=i.location,c=u?i.stringifyLocation(u):s;i.parseLocation(a,function(t){t||(t={url:a=i.route404.path,path:a}),a!==c&&(i.pending={cursor:e,location:t,onComplete:o,onAbort:n},r(t))})},t.prototype.parseLocation=function(t,e){var o,n,r=t.indexOf("?");r>=0?(o=t.slice(0,r),n=t.slice(r+1)):o=t;var i=this,a=o.split(v),s=a.length,u=function(t,e){var n,r=0;t:for(;n=t[r++];){var c=n.path;if(n.params){var p=c.split(v);if(s===p.length){for(var f={},h=0;h<s;h++)if(w.string.startsWith(p[h],":"))f[p[h].substr(":".length)]=C(w,a[h]);else if(p[h]!==a[h])continue t;return void e(n,f)}}else{if(n.load&&w.string.startsWith(o,c))return void n.load(function(t){i.remove(n),u(i.add(t),e)});if(c===o)return void e(n)}}e()};u(i.routes,function(o,r){if(o){var i={url:t,path:o.path};if(r&&(i.params=r),n){var a=function(t,e){var o;return t.array.each(e.split(y),function(e){var n=e.split(m),r=t.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=C(t,i),t.string.endsWith(r,g)?(r=t.string.slice(r,0,-g.length),t.array.push(o[r]||(o[r]=[]),i)):o[r]=i)}),o}(w,n);a&&(i.query=a)}e(i)}else e()})},t.prototype.stringifyLocation=function(t){var e=t.path,o=t.params,n=t.query,r=[];w.array.each(e.split(v),function(t){r.push(w.string.startsWith(t,":")&&o?o[t.substr(":".length)]:t)});var i=r.join(v);if(n){var a=function(t,e){var o=[],n=function(n){var r=e[n];t.is.array(r)?t.array.each(r,function(e){o.push(n+g+m+L(t,e))}):o.push(n+m+L(t,r))};for(var r in e)n(r);return o.join(y)}(w,n);a&&(i+="?"+a)}return i},t.prototype.diffRoute=function(t,e,o,n,r,i){if(r&&(t.child=r,r.parent=t),e?e.component!==t.component?n=t:t.context=e.context:n=t,t.parent)this.diffRoute(w.object.copy(t.parent),e?e.parent:s,o,n,t,e||i);else{if(n===t){var a=void 0;if(e)for(;e;)a=e.context,e=e.parent;else i&&(a=i.context);a&&(n.context=a)}o(t,n)}},t.prototype.patchRoute=function(t,e){for(var o=this.location;t;){var n=t.parent,r=t.context,i=t.component;if(t===e)if(n){if((r=n.context).forceUpdate(D(n,o,n.component)),r=r.$routeView){var a={},u="RouteComponent"+ ++W;a.RouteComponent=u,r.component(u,i),r.forceUpdate(a)}}else{r&&r.destroy();var c={};c[P]=this,c[q]=t,t.context=new w(w.object.extend({el:this.el,props:D(t,o,i),extensions:c},i))}else if(r&&(r.$vnode?(r[q]=t,r.forceUpdate(D(t,o,i))):t.context=s,t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t){var e=this,o=e.path2Route[t.path],n=o.route.redirect;if(n&&(w.is.func(n)&&(n=n(t)),n))e.push(n);else{var i=w.object.copy(o),a=e.route,s=e.location,u=function(){e.diffRoute(i,a,function(o,n){e.hook(i,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",r,function(){e.route=i,e.location=t,e.patchRoute(o,n)})})};e.hooks.setLocation(t,s),a&&s&&t.path!==s.path?e.hook(a,"beforeRouteLeave","beforeLeave",r,u):u()}},t}(),z={bind:function(t,e,o){var n=(o.context.$root||o.context)[P],r=o.data[e.key]=function(t){var o=e.value,r=e.getter,i=o;o&&r&&w.string.has(o,"{")&&(i=r()),n[e.name](i)};o.isComponent?t.on("click",r):H.on(t,"click",r)},unbind:function(t,e,o){var n=o.data[e.key];o.isComponent?t.off("click",n):H.off(t,"click",n)}},A={template:"<$RouteComponent/>",beforeCreate:function(t){var e=t.parent,o=e[q].child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++W;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$parent.$routeView=s}};t.Router=V,t.install=function(t){w=t,H=t.dom,w.directive({push:z,replace:z,go:z}),w.component("router-view",A);var i=w.beforeCreate,a=w.afterMount,s=w.afterUpdate,u=w.afterDestroy;w.beforeCreate=function(t){i&&i(t);var e=t.parent;if(e&&t.beforeCreate!==A.beforeCreate&&(e=e.$parent)){var o=e[P],n=e[q].child;if(o&&n){var r=t.extensions={};r[P]=o,r[q]=n,o.location&&(t.props=D(n,o.location,t))}}},w.afterMount=function(t){M(t,a,e,b,r)},w.afterUpdate=function(t){M(t,s,o,R,r)},w.afterDestroy=function(t){M(t,u,n,x)}},t.version="1.0.0-alpha8",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
