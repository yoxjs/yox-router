!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("yox")):"function"==typeof define&&define.amd?define(["exports","yox"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).YoxRouter={},t.Yox)}(this,(function(t,e){"use strict";var o=window,n=o.location,r=o.history,i=function(){};function a(t){var o;return e.is.numeric(t)?o=+t:e.is.string(t)&&(o="true"===t||"false"!==t&&("null"===t?null:decodeURIComponent(t))),o}function u(t){return e.is.string(t)?encodeURIComponent(t):e.is.number(t)||e.is.boolean(t)?t.toString():null===t?"null":void 0}i.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},i.prototype.clear=function(){return this.list=[],this},i.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},i.prototype.next=function(t,e,o){var n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()};var s="pushState"in r;function c(t,e){try{r.replaceState({},"",t),e()}catch(e){n.replace(t)}}var p=Object.freeze({__proto__:null,isSupported:s,start:function(t){e.dom.on(o,"popstate",t),t()},stop:function(t){e.dom.off(o,"popstate",t)},push:function(t,e){r.pushState({},"",t.url),e()},replace:function(t,e){c(t.url,e)},go:function(t){r.go(t)},current:function(){return n.pathname+n.search},replaceState:c});var f=Object.freeze({__proto__:null,start:function(t){e.dom.on(o,"hashchange",t),t()},stop:function(t){e.dom.off(o,"hashchange",t)},push:function(t,e){n.hash="#!"+t.url},replace:function(t,e){var o=n.protocol+"//"+n.host+n.pathname+"#!"+t.url;s?c(o,e):n.replace(o)},go:function(t){r.go(t)},current:function(){var t=n.href,e=t.indexOf("#!");return e>0?t.substr(e+"#!".length):"/"}});var h=0;function l(t,o){return e.string.startsWith(t,"/")||(o?e.string.endsWith(o,"/")||(o+="/"):o="/",t=o+t),"/"!==t&&e.string.endsWith(t,"/")&&(t=e.string.slice(t,0,-"/".length)),t}function d(t,o,n){if(/\/\:\w+/.test(t)){var r=[];e.array.each(t.split("/"),(function(t){r.push(e.string.startsWith(t,":")&&o?o[t.substr(":".length)]:t)})),t=r.join("/")}if(n){var i=function(t){var o=[],n=function(n){var r=t[n];if(e.is.array(r))e.array.each(r,(function(t){var r=u(t);e.is.string(r)&&o.push(n+"[]="+r)}));else{var i=u(r);e.is.string(i)&&o.push(n+"="+i)}};for(var r in t)n(r);return o.join("&")}(n);i&&(t+="?"+i)}return t}function v(t,o,n){var r={},i=n.propTypes;if(i){var a=o.query,u=t.params,s=o.params;if(u&&s){a=a?e.object.copy(a):{};for(var c=0,p=u.length;c<p;c++)a[u[c]]=s[u[c]]}if(a)for(var f in i){var h=a[f];void 0!==h&&(r[f]=h)}}return r}function m(t,e,o,n){var r=t.$route;if(r&&(r.context=n?t:void 0,function(t){var e=t.child;return!e||!e.context}(r))){var i=t.$router;if(e&&o&&i.hook(r,e,o,!1),n){var a=i.pending;a&&(a.onComplete(),i.pending=void 0)}}}var y=function(t){var o=this,n=t.el,r=t.route404||g;o.options=t,o.el=e.is.string(n)?e.dom.find(n):n,o.mode="history"===t.mode&&s?p:f,o.handler=function(){o.parseLocation(o.mode.current(),(function(t){t?o.setRoute(t):o.push(o.route404)}))},o.routes=[],o.name2Path={},o.path2Route={},o.hooks=new i,e.array.each(t.routes,(function(t){o.add(t)})),o.route404=o.add(r)[0]};y.prototype.add=function(t,o){var n=this,r=[],i=[],a=[],u=function(t){var o=t.name,s=t.component,c=t.children,p=t.load,f=e.array.last(i),h=e.array.last(a),d=l(t.path,f),v={path:d,route:t},m=[];e.array.each(d.split("/"),(function(t){e.string.startsWith(t,":")&&m.push(t.substr(":".length))})),m.length&&(v.params=m),o&&(v.name=o),p?v.load=p:v.component=s||x,h&&(v.parent=h),c?(i.push(d),a.push(v),e.array.each(c,u),a.pop(),i.pop()):(r.push(v),n.routes.push(v),o&&(n.name2Path[o]=d),n.path2Route[d]=v)};return o&&(i.push(o.path),a.push(o)),u(t),r},y.prototype.remove=function(t){e.array.remove(this.routes,t),t.name&&delete this.name2Path[t.name],delete this.path2Route[t.path]},y.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.push(t,e.handler)}))},y.prototype.replace=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.replace(t,e.handler)}))},y.prototype.go=function(t){this.mode.go(t)},y.prototype.start=function(){this.mode.start(this.handler)},y.prototype.stop=function(){this.mode.stop(this.handler)},y.prototype.hook=function(t,o,n,r,i){var a=this,u=a.location,s=a.hooks,c=a.pending,p=t.context,f=function(){p&&e.lifeCycle.fire(p,o,{from:s.from,to:s.to}),i&&i()},h=function(t){void 0===t?s.next(r,h,f):(c&&(c.onAbort(),a.pending=void 0),!1===t?u&&a.push(u):a.push(t))};s.clear().add(t.component[o],p).add(t.route[n],t.route).add(a.options[n],a),h()},y.prototype.toUrl=function(t){if(e.is.string(t))return l(t);var o,n=this.location,r=t,i=r.params;return r.name?o=this.name2Path[r.name]:r.path?o=l(r.path):n&&(o=n.path,i||(i=n.params)),d(o,i,r.query)},y.prototype.setUrl=function(t,e){this.parseLocation(t,(function(t){t&&e(t)}))},y.prototype.parseLocation=function(t,o){var n,r,i=t.indexOf("?");i>=0?(n=t.slice(0,i),r=t.slice(i+1)):n=t;var u=this,s=n.split("/"),c=s.length,p=function(t,o){var r,i=0;t:for(;r=t[i++];){var f=r.path;if(r.params){var h=f.split("/");if(c===h.length){for(var l={},d=0;d<c;d++)if(e.string.startsWith(h[d],":"))l[h[d].substr(":".length)]=a(s[d]);else if(h[d]!==s[d])continue t;return void o(r,l)}}else{if(r.load&&e.string.startsWith(n,f)){var v=function(t){u.remove(r);var n=t.default||t;e.is.func(n)&&(n=n()),p(u.add(n,r.parent),o)},m=r.load(v);return void(m&&m.then(v))}if(f===n)return void o(r)}}o()};p(u.routes,(function(n,i){if(n){var u={url:t,path:n.path};if(i&&(u.params=i),r){var s=function(t){var o;return e.array.each(t.split("&"),(function(t){var n=t.split("="),r=e.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=a(i),e.string.endsWith(r,"[]")?(r=e.string.slice(r,0,-"[]".length),e.array.push(o[r]||(o[r]=[]),i)):o[r]=i)})),o}(r);s&&(u.query=s)}o(u)}else o()}))},y.prototype.diffRoute=function(t,o,n,r,i,a){if(i&&(t.child=i,i.parent=t),o?o.component!==t.component?r=t:t.context=o.context:r=t,t.parent)this.diffRoute(e.object.copy(t.parent),o?o.parent:void 0,n,r,t,o||a);else{if(r===t){var u;if(o)for(;o;)u=o.context,o=o.parent;else a&&(u=a.context);u&&(r.context=u)}n(t,r)}},y.prototype.patchRoute=function(t,o){for(var n=this.location;t;){var r=t.parent,i=t.context,a=t.component;if(t===o)if(r){if((i=r.context).forceUpdate(v(r,n,r.component)),i=i.$routeView){var u={},s="RouteComponent"+ ++h;u.RouteComponent=s,i.component(s,a),i.forceUpdate(u)}}else i&&i.destroy(),t.context=new e(e.object.extend({el:this.el,props:v(t,n,a),extensions:{$router:this,$route:t}},a));else if(i&&(i.$vnode?(i.$route=t,i.forceUpdate(v(t,n,a))):t.context=void 0,t.child)){t=t.child;continue}break}},y.prototype.setRoute=function(t){var o=this,n=o.path2Route[t.path],r=n.route.redirect;if(r&&(e.is.func(r)&&(r=r(t)),r))o.push(r);else{var i=e.object.copy(n),a=o.route,u=o.location,s=function(){o.diffRoute(i,a,(function(e,n){o.hook(i,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",!0,(function(){o.route=i,o.location=t,o.patchRoute(e,n)}))}))};o.hooks.setLocation(t,u),a&&u&&t.path!==u.path?o.hook(a,"beforeRouteLeave","beforeLeave",!0,s):s()}};var g={path:"/404",component:{template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,j,_){return t({tag:"div",text:'This is a default 404 page, please set "route404" for your own 404 page.',isStatic:!0})}}},x={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,j,_){return e({tag:"router-view",isComponent:!0})}},b={bind:function(t,o,n){var r=(n.context.$root||n.context).$router,i=n.data[o.key]=function(t){var n=o.value,i=o.getter,a=n;n&&i&&e.string.has(n,"{")&&(a=i()),r[o.name](a)};n.isComponent?t.on("click",i):e.dom.on(t,"click",i)},unbind:function(t,o,n){var r=n.data[o.key];n.isComponent?t.off("click",r):e.dom.off(t,"click",r)}},R={template:function(t,e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,y,g,x,b,R,$,C,U,k,w,j,_){return e({tag:U((function(t){return t.length-1}),["RouteComponent"],!0).value,isComponent:!0})},beforeCreate:function(t){var e=t.context,o=e.$route.child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i="RouteComponent"+ ++h;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$context.$routeView=void 0}};e.lifeCycle.on("beforeCreate",(function(t,e){var o=e.options,n=o.context;if(n&&n.$options.beforeCreate===R.beforeCreate){var r=(n=n.$context).$router,i=n.$route.child;i&&(o.extensions={$router:r,$route:i},r.location&&(o.props=v(i,r.location,o)))}})).on("afterMount",(function(t){m(t,"afterRouteEnter","afterEnter",!0)})).on("afterUpdate",(function(t){m(t,"afterRouteUpdate","afterUpdate",!0)})).on("afterDestroy",(function(t){m(t,"afterRouteLeave","afterLeave")}));t.Router=y,t.install=function(t){t.directive({push:b,replace:b,go:b}),t.component("router-view",R)},t.version="1.0.0-alpha.107",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=yox-router.min.js.map
