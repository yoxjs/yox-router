!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("yox")):"function"==typeof define&&define.amd?define(["exports","yox"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).YoxRouter={},t.Yox)}(this,(function(t,e){"use strict";var o=window,n=o.location,r=o.history,i=void 0,a=!0,u=!1,s="null",c=":",p="/",f="[]",h=function(){};function l(t){var o;return e.is.numeric(t)?o=+t:e.is.string(t)&&(o="true"===t?a:"false"===t?u:t===s?null:decodeURIComponent(t)),o}function d(t){return e.is.string(t)?encodeURIComponent(t):e.is.number(t)||e.is.boolean(t)?t.toString():null===t?s:void 0}h.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},h.prototype.clear=function(){return this.list=[],this},h.prototype.add=function(t,e){var o=this.list;return t&&o.push({fn:t,ctx:e}),this},h.prototype.next=function(t,e,o){var n=this.list.shift();n?t?n.fn.call(n.ctx,this.to,this.from,e):(n.fn.call(n.ctx,this.to,this.from),e()):o()};var v="popstate",m="pushState"in r;function g(t,e){try{r.replaceState({},"",t),e()}catch(e){n.replace(t)}}var y=Object.freeze({__proto__:null,isSupported:m,start:function(t){e.dom.on(o,v,t),t()},stop:function(t){e.dom.off(o,v,t)},push:function(t,e){r.pushState({},"",t.url),e()},replace:function(t,e){g(t.url,e)},go:function(t){r.go(t)},current:function(){return n.pathname+n.search},replaceState:g}),x="#!",b="hashchange";var R=Object.freeze({__proto__:null,start:function(t){e.dom.on(o,b,t),t()},stop:function(t){e.dom.off(o,b,t)},push:function(t,e){n.hash=x+t.url},replace:function(t,e){var o=n.protocol+"//"+n.host+n.pathname+x+t.url;m?g(o,e):n.replace(o)},go:function(t){r.go(t)},current:function(){var t=n.href,e=t.indexOf(x);return e>0?t.substr(e+x.length):p}});var $=0,C="RouteComponent",U="click";function k(t,o){return e.string.startsWith(t,p)||(o?e.string.endsWith(o,p)||(o+=p):o=p,t=o+t),t!==p&&e.string.endsWith(t,p)&&(t=e.string.slice(t,0,-p.length)),t}function w(t,o,n){if(/\/\:\w+/.test(t)){var r=[];e.array.each(t.split(p),(function(t){r.push(e.string.startsWith(t,c)&&o?o[t.substr(c.length)]:t)})),t=r.join(p)}if(n){var i=function(t){var o=[],n=function(n){var r=t[n];if(e.is.array(r))e.array.each(r,(function(t){var r=d(t);e.is.string(r)&&o.push(n+f+"="+r)}));else{var i=d(r);e.is.string(i)&&o.push(n+"="+i)}};for(var r in t)n(r);return o.join("&")}(n);i&&(t+="?"+i)}return t}function j(t,o,n){var r={},a=n.propTypes;if(a){var u=o.query,s=t.params,c=o.params;if(s&&c){u=u?e.object.copy(u):{};for(var p=0,f=s.length;p<f;p++)u[s[p]]=c[s[p]]}if(u)for(var h in a){var l=u[h];l!==i&&(r[h]=l)}}return r}function _(t,e,o,n){var r=t.$route;if(r&&(r.context=n?t:i,function(t){var e=t.child;return!e||!e.context}(r))){var a=t.$router;if(e&&o&&a.hook(r,e,o,u),n){var s=a.pending;s&&(s.onComplete(),a.pending=i)}}}var L=function(t){var o=this,n=t.el,r=t.route404||W;o.options=t,o.el=e.is.string(n)?e.dom.find(n):n,o.mode="history"===t.mode&&m?y:R,o.handler=function(){o.parseLocation(o.mode.current(),(function(t){t?o.setRoute(t):o.push(o.route404)}))},o.routes=[],o.name2Path={},o.path2Route={},o.hooks=new h,e.array.each(t.routes,(function(t){o.add(t)})),o.route404=o.add(r)[0]};L.prototype.add=function(t,o){var n=this,r=[],i=[],a=[],u=function(t){var o=t.name,s=t.component,f=t.children,h=t.load,l=e.array.last(i),d=e.array.last(a),v=k(t.path,l),m={path:v,route:t},g=[];e.array.each(v.split(p),(function(t){e.string.startsWith(t,c)&&g.push(t.substr(c.length))})),g.length&&(m.params=g),o&&(m.name=o),h?m.load=h:m.component=s||S,d&&(m.parent=d),f?(i.push(v),a.push(m),e.array.each(f,u),a.pop(),i.pop()):(r.push(m),n.routes.push(m),o&&(n.name2Path[o]=v),n.path2Route[v]=m)};return o&&(i.push(o.path),a.push(o)),u(t),r},L.prototype.remove=function(t){var o=this;e.array.remove(o.routes,t),t.name&&delete o.name2Path[t.name],delete o.path2Route[t.path]},L.prototype.push=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.push(t,e.handler)}))},L.prototype.replace=function(t){var e=this,o=e.mode;e.setUrl(e.toUrl(t),(function(t){o.current()!==t.url&&o.replace(t,e.handler)}))},L.prototype.go=function(t){this.mode.go(t)},L.prototype.start=function(){this.mode.start(this.handler)},L.prototype.stop=function(){this.mode.stop(this.handler)},L.prototype.hook=function(t,o,n,r,a){var s=this,c=s.location,p=s.hooks,f=s.pending,h=t.context,l=function(){h&&e.lifeCycle.fire(h,o,{from:p.from,to:p.to}),a&&a()},d=function(t){t===i?p.next(r,d,l):(f&&(f.onAbort(),s.pending=i),t===u?c&&s.push(c):s.push(t))};p.clear().add(t.component[o],h).add(t.route[n],t.route).add(s.options[n],s),d()},L.prototype.toUrl=function(t){if(e.is.string(t))return k(t);var o,n=this.location,r=t,i=r.params;return r.name?o=this.name2Path[r.name]:r.path?o=k(r.path):n&&(o=n.path,i||(i=n.params)),w(o,i,r.query)},L.prototype.setUrl=function(t,e){this.parseLocation(t,(function(t){t&&e(t)}))},L.prototype.parseLocation=function(t,o){var n,r,i=t.indexOf("?");i>=0?(n=t.slice(0,i),r=t.slice(i+1)):n=t;var a=this,u=n.split(p),s=u.length,h=function(t,o){var r,i=0;t:for(;r=t[i++];){var f=r.path;if(r.params){var d=f.split(p);if(s===d.length){for(var v={},m=0;m<s;m++)if(e.string.startsWith(d[m],c))v[d[m].substr(c.length)]=l(u[m]);else if(d[m]!==u[m])continue t;return void o(r,v)}}else{if(r.load&&e.string.startsWith(n,f)){var g=function(t){a.remove(r);var n=t.default||t;e.is.func(n)&&(n=n()),h(a.add(n,r.parent),o)},y=r.load(g);return void(y&&y.then(g))}if(f===n)return void o(r)}}o()};h(a.routes,(function(n,i){if(n){var a={url:t,path:n.path};if(i&&(a.params=i),r){var u=function(t){var o;return e.array.each(t.split("&"),(function(t){var n=t.split("="),r=e.string.trim(n[0]),i=n[1];r&&(o||(o={}),i=l(i),e.string.endsWith(r,f)?(r=e.string.slice(r,0,-f.length),e.array.push(o[r]||(o[r]=[]),i)):o[r]=i)})),o}(r);u&&(a.query=u)}o(a)}else o()}))},L.prototype.diffRoute=function(t,o,n,r,a,u){if(a&&(t.child=a,a.parent=t),o?o.component!==t.component?r=t:t.context=o.context:r=t,t.parent)this.diffRoute(e.object.copy(t.parent),o?o.parent:i,n,r,t,o||u);else{if(r===t){var s;if(o)for(;o;)s=o.context,o=o.parent;else u&&(s=u.context);s&&(r.context=s)}n(t,r)}},L.prototype.patchRoute=function(t,o){for(var n=this,r=n.location;t;){var a=t.parent,u=t.context,s=t.component;if(t===o)if(a){if((u=a.context).forceUpdate(j(a,r,a.component)),u=u.$routeView){var c={},p=C+ ++$;c.RouteComponent=p,u.component(p,s),u.forceUpdate(c)}}else u&&u.destroy(),t.context=new e(e.object.extend({el:n.el,props:j(t,r,s),extensions:{$router:n,$route:t}},s));else if(u&&(u.$vnode?(u.$route=t,u.forceUpdate(j(t,r,s))):t.context=i,t.child)){t=t.child;continue}break}},L.prototype.setRoute=function(t){var o=this,n=o.path2Route[t.path],r=n.route.redirect;if(r&&(e.is.func(r)&&(r=r(t)),r))o.push(r);else{var i=e.object.copy(n),u=o.route,s=o.location,c=function(){o.diffRoute(i,u,(function(e,n){o.hook(i,n?"beforeRouteEnter":"beforeRouteUpdate",n?"beforeEnter":"beforeUpdate",a,(function(){o.route=i,o.location=t,o.patchRoute(e,n)}))}))};o.hooks.setLocation(t,s),u&&s&&t.path!==s.path?o.hook(u,"beforeRouteLeave","beforeLeave",a,c):c()}};var W={path:"/404",component:{template:function(t){var e={isStatic:!0,tag:"div",text:'This is a default 404 page, please set "route404" for your own 404 page.'};return function(t,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,g,y,x,b,R,$,C,U,k,w,j,_,L,W,S,O,P,q,E,T){E[E.length]=e}}}},S={template:function(t){return function(e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,g,y,x,b,R,$,C,U,k,w,j,_,L,W,S,O,P,q,E,T){E[E.length]=T[T.length]={context:t,isComponent:true,tag:"router-view"}}}},O={bind:function(t,o,n){var r=(n.context.$root||n.context).$router,i=n.data[o.key]=function(t){var n=o.value,i=o.getter,a=n;n&&i&&e.string.has(n,"{")&&(a=i()),r[o.name](a)};n.isComponent?t.on(U,i):e.dom.on(t,U,i)},unbind:function(t,o,n){var r=n.data[o.key];n.isComponent?t.off(U,r):e.dom.off(t,U,r)}},P={template:function(t){return function(e,o,n,r,i,a,u,s,c,p,f,h,l,d,v,m,g,y,x,b,R,$,C,U,k,w,j,_,L,W,S,O,P,q,E,T){E[E.length]=T[T.length]={context:t,isComponent:true,tag:v("RouteComponent",P.RouteComponent).value}}},beforeCreate:function(t){var e=t.context,o=e.$route.child;if(o){e.$routeView=this;var n=t.props={},r=t.components={},i=C+ ++$;n.RouteComponent=i,r[i]=o.component}},beforeDestroy:function(){this.$context.$routeView=i}};e.lifeCycle.on("beforeCreate",(function(t,e){var o=e.options,n=o.context;if(n&&n.$options.beforeCreate===P.beforeCreate){var r=(n=n.$context).$router,i=n.$route.child;i&&(o.extensions={$router:r,$route:i},r.location&&(o.props=j(i,r.location,o)))}})).on("afterMount",(function(t){_(t,"afterRouteEnter","afterEnter",a)})).on("afterUpdate",(function(t){_(t,"afterRouteUpdate","afterUpdate",a)})).on("afterDestroy",(function(t){_(t,"afterRouteLeave","afterLeave")}));t.Router=L,t.install=function(t){t.directive({push:O,replace:O,go:O}),t.component("router-view",P)},t.version="1.0.0-alpha.117",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=yox-router.min.js.map
