!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).YoxRouter={})}(this,function(t){"use strict";var e=!0,o=!1,n=null,r=void 0,a="true",i="false",s="null",u="undefined",c=function(){},p=(Object.freeze({}),Object.freeze([]),""),f=function(){function t(){}return t.prototype.setLocation=function(t,e){return this.to=t,this.from=e,this},t.prototype.setName=function(t){return this.name=t,this.list=[],this},t.prototype.add=function(t,e){var o=this.name,n=this.list;return t&&t[o]&&n.push({fn:t[o],ctx:e}),this},t.prototype.next=function(t,e,o){var n=this.list.shift();n?e?n.fn.call(n.ctx,this.to,this.from,t):(n.fn.call(n.ctx,this.to,this.from),t()):o&&o()},t}(),h="#!",l=":",d="/",v="?",y="afterEnter",g="afterLeave";function m(t,c){var p;return t.is.numeric(c)?p=+c:t.is.string(c)&&(p=c===a?e:c===i?o:c===s?n:c===u?r:decodeURIComponent(c)),p}function b(t,e){return t.is.string(e)?encodeURIComponent(e):t.is.number(e)||t.is.boolean(e)?e.toString():e===n?s:u}var x,R,C,w="&",k="=",j="[]";function $(t,e,n){var r,a,i=n.indexOf(v);i>=0?(r=n.slice(0,i),a=n.slice(i+1)):r=n;var s=function(t,e,n){var r,a=n.split(d),i=a.length;return t.array.each(e,function(e){if(e.params){var s=e.path.split(d);if(i===s.length){for(var u=0;u<i;u++)if(!t.string.startsWith(s[u],l)&&s[u]!==a[u])return;return r=e,o}}else if(e.path===n)return r=e,o}),r}(t,e,r);if(s){var u={path:s.path};if(s.params){var c=function(t,e,o){var n,r=e.split(d),a=o.split(d);return r.length===a.length&&t.array.each(a,function(e,o){t.string.startsWith(e,l)&&(n||(n={}),n[e.substr(l.length)]=m(t,r[o]))}),n}(t,r,s.path);c&&(u.params=c)}if(a){var p=function(t,e){var o;return t.array.each(e.split(w),function(e){var n=e.split(k),r=t.string.trim(n[0]),a=n[1];r&&(o||(o={}),a=m(t,a),t.string.endsWith(r,j)?(r=t.string.slice(r,0,-j.length),t.array.push(o[r]||(o[r]=[]),a)):o[r]=a)}),o}(t,a);p&&(u.query=p)}return u}}function W(t,e){var o=e.path,n=e.params,r=e.query,a=[];t.array.each(o.split(d),function(e){a.push(t.string.startsWith(e,l)&&n?n[e.substr(l.length)]:e)});var i=a.join(d);if(r){var s=function(t,e){var o=[],n=function(n){var r=e[n];t.is.array(r)?t.array.each(r,function(e){o.push(n+j+k+b(t,e))}):o.push(n+k+b(t,r))};for(var r in e)n(r);return o.join(w)}(t,r);s&&(i+=v+s)}return i}var q=window.location,P="$router",O="$route";function U(t,e){return x.string.endsWith(t,d)&&(t=x.string.slice(t,0,-1)),x.string.startsWith(t,d)||(t?t=x.string.falsy(e)?d+t:e+d+t:e&&(t=e)),t}function V(t,e){var o={path:p};if(x.is.string(t))o.path=U(t);else{var n=t,r=n.name;o.path=r?e[r]:U(n.path),n.params&&(o.params=n.params),n.query&&(o.query=n.query)}return o}function H(t,e,o){var n={},r=o.propTypes;if(r){var a=e.query,i=t.params,s=e.params;if(i&&s){a=a?x.object.copy(a):{};for(var u=0,c=void 0;c=i[u];u++)a[c]=s[c]}if(a)for(var c in r)n[c]=x.checkProp(c,a[c],r[c])}return n}var L=function(){function t(t){var e=this,o=t.route404;e.el=t.el,e.onChange=function(){var t=q.hash,o=e.loading,n=e.routes,a=e.route404;if(o){if(o.hash===t)return void e.setRoute(o.location,o.route);e.loading=r}t=0===t.indexOf(h)?t.substr(h.length):"";var i=$(x,n,t);i?e.setRoute(i,e.path2Route[i.path]):e.replace(a)},e.routes=[],e.name2Path={},e.path2Route={},e.history=[],e.cursor=-1,e.hooks=new f,e.add(t.routes),e.add([o]),e.route404=x.array.last(e.routes)}return t.prototype.add=function(t){var e=this,o=[],n=[],a=function(t){var r=t.name,i=t.path,s=t.component,u=t.children,c=o[o.length-1],p=n[n.length-1],f={path:i=U(i,c),component:s,route:t},h=[];x.array.each(i.split(d),function(t){x.string.startsWith(t,l)&&h.push(t.substr(l.length))}),h.length&&(f.params=h),p&&(f.parent=p),u?(o.push(i),n.push(f),x.array.each(u,a),n.pop(),o.pop()):(e.routes.push(f),r&&(e.name2Path[r]=i),e.path2Route[i]=f)};x.array.each(t,a),o=n=r},t.prototype.push=function(t){var e=this,o=V(t,e.name2Path);e.setHash(o,function(){var t=e.history,n=e.cursor+1;t[n]&&(t.length=n),t[n]=o,e.cursor=n},c)},t.prototype.replace=function(t){var e=this,o=V(t,e.name2Path);e.setHash(o,function(){var t=e.history,n=e.cursor;t[n]&&(t[n]=o)},c)},t.prototype.go=function(t){var e=this,o=e.cursor+t,n=e.history[o];n&&e.setHash(n,function(){e.cursor=o},c)},t.prototype.start=function(){C.on(window,"hashchange",this.onChange),this.onChange()},t.prototype.stop=function(){C.off(window,"hashchange",this.onChange)},t.prototype.guard=function(t,e,n,a){var i=t.child;if(!i||!i.context){var s=this,u=s.location,c=s.hooks,p=s.loading,f=c.to,h=c.from;if(h&&h.path===f.path)a&&a();else{c.setName(e).add(t.options,t.context).add(t.route,t.route).add(s,s);var l=function(t){t===r?c.next(l,n,a):(p&&(p.onAbort(),s.loading=r),t===o?u&&s.replace(u):s.push(t))};l()}}},t.prototype.setHash=function(t,e,o){var n,r=this.path2Route[t.path];n=r?W(x,t):(r=this.route404).path,(n=h+n)!==q.hash&&(this.loading={location:t,route:r,hash:n,onComplete:e,onAbort:o},q.hash=n)},t.prototype.diffRoute=function(t,e,o,n,a){var i=this;R.loadComponent(t.component,function(s){t.options=s,a&&(t.child=a,a.parent=t),e?e.options!==s?n=t:t.context=e.context:n=t,t.parent?i.diffRoute(x.object.copy(t.parent),e?e.parent:r,o,n,t):o(t,n)})},t.prototype.updateRoute=function(t,o){for(var n=this.location;e;){var r=t.parent,a=t.context,i=t.component,s=t.options;if(t===o)if(r){if((a=r.context).forceUpdate(H(r,n,r.options)),a=a.$routeView){var u={};u.RouteComponent=i,a.component(i,s),a.forceUpdate(u)}}else{a&&a.destroy();var c={};c[P]=this,c[O]=t,t.context=new x(x.object.extend({el:this.el,props:H(t,n,s),extensions:c},s))}else if(a&&(a[O]=t,a.forceUpdate(H(t,n,s)),a.$routeView&&t.child)){t=t.child;continue}break}},t.prototype.setRoute=function(t,o){var n=this,r=x.object.copy(o),a=n.route,i=function(){n.diffRoute(r,a,function(o,a){n.guard(r,"beforeEnter",e,function(){n.route=r,n.location=t,n.updateRoute(o,a)})})};n.hooks.setLocation(t,n.location),a?n.guard(a,"beforeLeave",e,i):i()},t}(),D={bind:function(t,e,o){var r=(o.context.$root||o.context)[P],a=function(t){var o=e.getter&&e.getter();r.push(o!=n?o:e.value)};o.isComponent?(t.on("click",a),o.data[e.key]=function(){t.off("click",a)}):(C.on(t,"click",a),o.data[e.key]=function(){C.off(t,"click",a)})},unbind:function(t,e,o){o.data[e.key]()}},M={template:"<$RouteComponent/>",beforeCreate:function(t){var e=t.parent,o=e[O].child;if(o){e.$routeView=this;var n={},r={};n.RouteComponent=o.component,r[o.component]=o.options,t.props=n,t.components=r}},beforeDestroy:function(){this.$parent.$routeView=r}};t.Router=L,t.install=function(t){x=t,R=new t,C=t.dom,x.directive("href",D),x.component({RouterView:M,"router-view":M});var e=x.beforeCreate,o=x.afterMount,n=x.afterDestroy;x.beforeCreate=function(t){e&&e(t);var o=t.parent;if(o&&t.beforeCreate!==M.beforeCreate&&(o=o.$parent)){var n=o[P],r=o[O].child;if(n&&r){var a=t.extensions={};a[P]=n,a[O]=r,n.location&&(t.props=H(r,n.location,t))}}},x.afterMount=function(t){o&&o(t);var e=t[O];if(e){var n=t[P];e.context=t,n.guard(e,y);var a=n.loading;a&&(a.onComplete(),n.loading=r)}},x.afterDestroy=function(t){n&&n(t);var e=t[O];if(e){var o=t[P];e.context=r,o.guard(e,g)}}},t.register=function(t,e){R.component(t,e)},t.version="0.30.0",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yox-router.min.js.map
